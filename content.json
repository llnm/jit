{"meta":{"title":"DAEYEON JIT","subtitle":"Journey Into Tech.","description":"ì»´í“¨í„° ê¸°ìˆ  ë¶„ì•¼ë¥¼ ì—°êµ¬í•˜ë©° ê·¸ ê³¼ì •ì—ì„œ ì–»ì€ ê²ƒë“¤ì„ ê³µìœ í•©ë‹ˆë‹¤. í˜„ì¬ëŠ” ì›¹ ê´€ë ¨ ê¸°ìˆ , íŠ¹íˆ Node.js ê°™ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ëŸ°íƒ€ì„ì— ê´€ì‹¬ì´ ë§ìŠµë‹ˆë‹¤.","author":"Daeyeon Jeong","url":"https://llnm.github.io","root":"/"},"pages":[{"title":"About","date":"2023-06-23T06:50:56.000Z","updated":"2023-11-29T13:01:56.524Z","comments":false,"path":"about/index.html","permalink":"https://llnm.github.io/about/index.html","excerpt":"","text":"Greetings, ReadersI&#39;m Daeyeon Jeong, the creator of this blog. Within these pages, I explore various technical domains and share my discoveries along the way. Currently, I&#39;m delving into web-related technologies, with a specific focus on JavaScript runtimes like Node.js. What I Enjoy Away from TechğŸ“š Getting Lost in Novels: I have a strong penchant for reading novels. Escaping into a world different from reality is truly captivating. Reading can be a solitary hobby, yet that solitude is enchanting. ğŸ¹ Exploring the World of Drinks: I&#39;m also quite intrigued by the world of alcoholic beverages. I enjoy learning about the intricate flavors of Korean spirits, whisky, wine, and more. The diverse tastes and fascinating histories behind these drinks capture my attention these days."}],"posts":[{"title":"WebAssembly ê¸°ìˆ  ë™í–¥","slug":"article-2023-11-27-wasm","date":"2023-11-26T15:30:20.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-11-27-wasm/","link":"","permalink":"https://llnm.github.io/article/2023-11-27-wasm/","excerpt":"","text":"WebAssembly (WASM)ì›¹ì–´ì…ˆë¸”ë¦¬(WebAssembly ë˜ëŠ” Wasm)ëŠ” ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì™€ ë§ì€ ì‹¤í–‰ í™˜ê²½ ì‚¬ì´ì˜ ì¤‘ê°„ ê³„ì¸µìœ¼ë¡œ, 30ì—¬ ê°€ì§€ ì´ìƒì˜ ì–¸ì–´ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ .wasm íŒŒì¼ë¡œ ì»´íŒŒì¼í•œ ë‹¤ìŒ ë¸Œë¼ìš°ì €ë‚˜ ë‹¤ë¥¸ ì‹¤í–‰ í™˜ê²½ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. ì›ë˜ ì›¹ì—ì„œ ì½”ë“œ ì‹¤í–‰ ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ê°œë°œë˜ì—ˆì§€ë§Œ ì´ì œëŠ” ë¸Œë¼ìš°ì € ì´ì™¸ì˜ ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œë„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. WebAssemblyëŠ” ë°œí‘œëœ ì‹œì ì— ë¹„í•´ ë„ë¦¬ ì‚¬ìš©ë˜ì§€ ì•Šì•˜ëŠ”ë°, ìš°ì„  ì–¸ì–´ ê°„ ìƒí˜¸ í˜¸í™˜ì„±, ë¶€ì¡±í•œ ê°œë°œì ê²½í—˜ì´ ë¬¸ì œê°€ ìˆì—ˆë‹¤. ë˜í•œ WebAssemblyë¼ëŠ” ì´ë¦„ ìì²´ê°€ ì›¹ì´ë‚˜ ì–´ì…ˆë¸”ë¦¬ì— êµ­í•œë˜ì§€ ì•ŠëŠ”ë°, Webì´ë€ í‚¤ì›Œë“œë¥¼ ì“°ë©´ì„œ ì˜ëª»ëœ ì¸ìƒì„ ì£¼ì—ˆë‹¤. ì´ì— â€™19ë…„ ëª¨ì§ˆë¼, ë ˆë“œí–‡, ì¸í…”, Fastly. ë“±ì˜ íšŒì‚¬ë“¤ì´ ì»¤ë®¤ë‹ˆí‹°ë¥¼ (Bytecode Alliance) êµ¬ì¶•í•˜ì˜€ê³ , ë¸Œë¼ìš°ì €ë¥¼ ë²—ì–´ë‚œ ì›¹ì–´ì…ˆë¸”ë¦¬ ëŸ°íƒ€ì„ì— ëŒ€í•œ í‘œì¤€ê³¼ ë„êµ¬ë¥¼ ê°œë°œì„ ì‹œì‘í•˜ì˜€ë‹¤. í˜„ì¬ WASI (WebAssembly System Interface)ë¥¼ êµ¬í˜„í•œ WASM ëŸ°íƒ€ì„ì„ ì œê³µí•˜ê³  ìˆë‹¤. íŠ¹ì§• ì´ì‹ì„± (Portable) - í•œë²ˆ ë¹Œë“œí•˜ë©´ ì—¬ëŸ¬ í”Œë«í¼ì—ì„œ í™œìš©ê°€ëŠ¥ ë²”ìš©ì„± (Universal) - ë§ì€ ì–¸ì–´ê°€ WASMìœ¼ë¡œ ì»´íŒŒì¼ ê°€ëŠ¥ ë¹ ë¥¸ ì‹œì‘ ì‹œê°„ - Dockerë³´ë‹¤ 10~100x ë¹ ë¥¸ ì‹œì‘ì‹œê°„ ì•ˆì „ì„± (Secure) - ë©”ëª¨ë¦¬ ìƒŒë“œë°•ì‹±, ê¸°ëŠ¥ ì œí•œ ì„±ëŠ¥ - ë„¤ì´í‹°ë¸Œì— ê°€ê¹Œìš´ ì„±ëŠ¥ (1.5ë°° ëŠë¦¼), JavaScript ë³´ë‹¤ëŠ” í•­ìƒ ë¹ ë¦„ ì ìš© ì˜ˆì›¹ì–´ì…ˆë¸”ë¦¬ì˜ ì ìš© ë²”ìœ„ëŠ” ì»¨í…Œì´ë„ˆí™”, í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ, ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… í”Œë«í¼ ë“± ê¸°ìˆ  ì˜ì—­ì—ì„œì˜ í™œë°œí•œ í™œìš©ëœë‹¤. ë˜í•œ, ë³´ì•ˆ ì¸¡ë©´ì—ì„œë„ ìƒŒë“œë°•ìŠ¤í™”ëœ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì•ˆì „í•œ ì‹¤í–‰, ì œí•œëœ ê¶Œí•œ ì‹œìŠ¤í…œ, ê·¸ë¦¬ê³  ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²©ë¦¬ ëŠ¥ë ¥ ë“±ì´ í¬í•¨ëœë‹¤. WASM ì ìš© ë²”ìœ„ ì°¸ê³ : https://harshal.sheth.io/2022/01/31/webassembly.html WASI (WebAssembly System Interface)WASI(WebAssembly System Interface)ëŠ” ì›¹ ì–´ì…ˆë¸”ë¦¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œê³¼ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. ì´ë¥¼ í†µí•´ ì›¹ ì–´ì…ˆë¸”ë¦¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ íŒŒì¼ ì‹œìŠ¤í…œ, ë„¤íŠ¸ì›Œí‚¹ ë“±ì˜ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ë„ë¡ ë˜ì—ˆë‹¤. WASIê°€ ë“±ì¥í•˜ê¸° ì´ì „ì—ëŠ” Emscriptenì´ ì‚¬ìš©ë˜ì—ˆìœ¼ë©° ìì²´ì ìœ¼ë¡œ JavaScript layerì™€ WASM layerë¡œ êµ¬ì„±í•´ ë¸Œë¼ìš°ì €ì™€ í†µì‹ í•´ì„œ ì‹œìŠ¤í…œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì˜€ë‹¤. de-facto í‘œì¤€ìœ¼ë¡œ ë‹¤ë¤„ì§€ë‚˜ ì†ë„ë‚˜, Private API ì‚¬ìš©ë“±ì˜ ë¬¸ì œê°€ ìˆë‹¤. (https://hacks.mozilla.org/2019/03/standardizing-wasi-a-webassembly-system-interface/) WASI ì‚¬ìš© ëª¨ë“ˆê³¼ Node.js ëª¨ë“ˆ ë¹„êµ Portability: WASM ëª¨ë“ˆì€ Write one time, Use everywhereì´ ê³ ë ¤ë˜ì—ˆë‹¤. Node.js Native ëª¨ë“ˆì´ í™˜ê²½ë§ˆë‹¤ node-gypë¥¼ í†µí•´ ë¹Œë“¤ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì— ë¹„í•´ í•œë²ˆ ë¹Œë“œëœ í˜•íƒœë¡œ ê·¸ëŒ€ë¡œ ë°°í¬ê°€ ê°€ëŠ¥í•˜ë‹¤. Security: Capability-based security ì „ëµì„ ì‚¬ìš©í•œë‹¤. &quot;ê¶Œí•œì´ í”„ë¡œê·¸ë¨ ë‹¨ìœ„ê°€ ì•„ë‹ˆë¼ ëª¨ë“ˆ ë‹¨ìœ„&quot;ë¡œ ì´ë£¨ì–´ì§€ê³ , ëª¨ë“ˆ ë‹¨ìœ„ë¡œ ì „íŒŒë  ë•Œ ê¶Œí•œì— ëŒ€í•œ ìˆ˜ì •ë„ ê°€ëŠ¥í•˜ë‹¤. Node.jsì—ì„œë„ Permission ëª¨ë¸ì´ êµ¬ì¶•ë˜ê³  ìˆì§€ë§Œ, ëŸ°íƒ€ì„ ë‹¨ìœ„ì˜ ë³´ì•ˆì„ ì œê³µí•˜ê³  ëª¨ë“ˆ ë‹¨ìœ„ì˜ ì œì–´ëŠ” ë¶ˆê°€í•˜ë‹¤. (ê´€ë ¨ëœ Node.js í•´í‚¹ì‚¬ë¡€: electron-native-notify NPM ëª¨ë“ˆì˜ ZipSlip) Capability-based security ì „ëµì—ì„œ ê°ê°ì˜ ê°œì²´(ì‚¬ìš©ì, í”„ë¡œì„¸ìŠ¤, ëª¨ë“ˆ ë“±)ëŠ” ìì‹ ì´ í•„ìš”ë¡œ í•˜ëŠ” íŠ¹ì •í•œ ëŠ¥ë ¥ì„ ê°€ì§€ê³  ìˆì–´ì•¼ë§Œ íŠ¹ì • ëŠ¥ë ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŒŒì¼ì— ì•¡ì„¸ìŠ¤í•´ì•¼ í•˜ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°, í•´ë‹¹ í•¨ìˆ˜ëŠ” íŒŒì¼ì— ëŒ€í•œ ì ì ˆí•œ ê¶Œí•œì´ ë¶€ì—¬ëœ ëŠ¥ë ¥ì„ ê°€ì§„ ê°ì²´ì—ê²Œë§Œ ì‹¤í–‰ë˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í†µí•´ ê¶Œí•œì´ í•„ìš”í•œ ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ë° í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ë¶€ì—¬í•  ìˆ˜ ìˆê²Œ ë˜ë©°, ë³´ì•ˆì„ ê°•í™”í•  ìˆ˜ ìˆë‹¤. 3rd party NPM ëª¨ë“ˆ Vulnerabilityë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— Node.js ëŸ°íƒ€ì„ì€ ì‹¤ì œ Production ì—ì„œ ì‚¬ìš©ë˜ê¸°ê¸° ì–´ë µë‹¤. ì´ì— ë¹„í•´ WASM ëª¨ë“ˆì€ WASI ì¸í„°í˜ì´ìŠ¤ê°€ Sandboxingì„ ê³ ë ¤í•˜ì—¬ ì„¤ê³„ë˜ì–´ìˆë‹¤. í‘œì¤€í™”í˜„ì¬ WASIì˜ ëª¨ë“  APIëŠ” Proposal ë‹¨ê³„ (Phase 2) ì´ë‹¤. ì•„ì§ ì‹¤í—˜ì  ìƒíƒœì—ê³  ì¸í„°í˜ì´ìŠ¤ê°€ ë³€ê²½ì´ ê°€ëŠ¥í•¨ì„ ì˜ë¯¸í•œë‹¤. ìì„¸í•œ í˜„í™©ì€ https://github.com/WebAssembly/WASI/blob/main/Proposals.md ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤. WASM Runtime í˜„í™©ë¸Œë¼ìš°ì € ì™¸ë¶€ì—ì„œ WASMì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” Runtimeì€ ë‹¤ìŒê³¼ ê°™ë‹¤. Bytecode Alliance, Standalone Runtime wasmtime: WSAM Standalone Runtime, wasi-core, (Standard compliant), ë¸Œë¼ìš°ì €ìš© WASI Polyfill, WAMR (WebAssembly Micro Runtime): Binary size 85K (interpreter) and 50K (AOT) and low memory usage QuickJS ê¸°ë°˜ JS ì¸í„°í˜ì´ìŠ¤ ì œê³µ Wasmer (https://medium.com/wasmer/wasmer-1-0-3f86ca18c043) WASMedge (https://wasmedge.org) CJS NPM ëª¨ë“ˆì€ rollup.jsì„ í†µí•´ ë²ˆë“¤ë§í•˜ì—¬ ì‚¬ìš©, https://wasmedge.org/book/en/write_wasm/js/tensorflow.html Cloudflare Workerd (https://github.com/cloudflare/workerd) Workers ì„œë¹„ìŠ¤ì˜ Core, ë¶„ì‚° ì»´í“¨íŒ… Microservice ìš´ìš©ì— íŠ¹í™” Node.js WASI: application&#39;s sandbox directory structure, stdio&#x2F;out&#x2F;stderr ì œê³µ (Experimental) https://webassembly.org/roadmap/ Web Container WASMìœ¼ë¡œ Node.js ê°œë°œí™˜ê²½ì„ ì•„ì— ì œê³µ. JSë¥¼ ì§ì ‘ ëŒë¦¼. Node 14. ì§€ì› https://github.com/stackblitz/webcontainer-core Blazor Flutter ê°™ì€ ì›¹ F&#x2F;W, C# ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±, ë¸Œë¼ìš°ì €ì—ì„œëŠ” WASMì„ ì´ìš© Containerizationì„œë²„ ì–´í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ì— ìš©ì´í•œ Dockerì— ë¹„í•´ WASMì€ ì½œë“œ ìŠ¤íƒ€íŠ¸ â€‹â€‹ì‹œê°„ì´ 10~100ë°° ë¹ ë¥´ë©° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì ê³  ë›°ì–´ë‚œ ë³´ì•ˆ ëª¨ë¸ì„ ì±„ìš©í•˜ê³  ìˆë‹¤. ì»¨í…Œì´ë„ˆê°€ ì•„ë‹Œ WASM ëª¨ë“ˆì´ ì—°ì‚° ë° ë°°í¬ì˜ ìµœì†Œ ë‹¨ìœ„ê°€ ë  ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë‚˜, í•œë²ˆì— Dockerë¥¼ ì™„ì „íˆ ëŒ€ì²´í•˜ì§€ëŠ” ì•Šê³  ê¸°ì¡´ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì‹œìŠ¤í…œì— í†µí•©ë˜ëŠ” í˜•íƒœë¡œ ì§„í–‰ë  ê²ƒì´ë¼ ì˜ˆì¸¡ëœë‹¤. ì´ëŸ¬í•œ íë¦„ê³¼ ë³„ê°œì˜ Containerization ê¸°ìˆ ì€ ì•„ë˜ì™€ ê°™ë‹¤. Lightweight VirtualizationLightweight Virtualizationì€ ì „í†µì ì¸ ê°€ìƒí™” ê¸°ìˆ ê³¼ëŠ” ë‹¤ë¥´ê²Œ ë” ê°€ë²¼ìš´ ë°©ì‹ìœ¼ë¡œ ê°€ìƒí™”ë¥¼ êµ¬í˜„í•˜ëŠ” ê¸°ìˆ ì„ ë§í•œë‹¤. ë” ì ì€ ì˜¤ë²„í—¤ë“œì™€ ë¹ ë¥¸ ë¶€íŒ… ì‹œê°„ì„ ì œê³µí•˜ë©´ì„œë„ ê²©ë¦¬ì™€ ë³´ì•ˆì„ ìœ ì§€í•œë‹¤. AWS Firecrackerê°€ ì´ëŸ¬í•œ Lightweight Virtualization ê¸°ìˆ ì˜ í•œ ì˜ˆë¡œ, ë©€í‹° í…Œë„Œì‹œ í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ë„ë¡ ë˜ì–´ìˆë‹¤. KVM(Kernel-based Virtual Machine)ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, ì»¤ë„ ê¸°ëŠ¥ì„ ìµœì†Œí™”í•˜ì—¬ ê²½ëŸ‰í™”ëœ ê°€ìƒí™”ë¥¼ ì œê³µí•œë‹¤. ì°¸ê³ ìë£Œ: https://www.koyeb.com/blog/lightweight-virtualization-the-container-ecosystem-and-firecracker-microvms-for-serverless JavaScript ContainerJavaScript ContainerëŠ” Node.jsì˜ í•œê³„ì™€ í•¨ê»˜ ë“±ì¥í•œ ìƒˆë¡œìš´ ê°œë…ìœ¼ë¡œ, ë¸Œë¼ìš°ì € API ë””ìì¸ ê°œë…ì„ ê³µìœ í•¨ìœ¼ë¡œì¨ ì›¹ ê°œë°œìë“¤ì´ JavaScript ëŸ°íƒ€ì„ì„ ì‚¬ìš©í•  ë•Œ ë°°ì›Œì•¼ í•  ê°œë…ì„ ì¤„ì¼ ìˆ˜ ìˆëŠ” ì¥ì ì„ ê°–ëŠ”ë‹¤. ë˜, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ë³´ë‹¤ëŠ” ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš© ì‹œê°„ì´ ì¤‘ìš”í•œ Serverless í™˜ê²½ì—ì„œ ë¹ ë¥¸ ì¬êµ¬ë™ ì‹œê°„ì„ ì œê³µí•˜ì—¬ ë¹„ìš©ì„ ì ˆê°í•  ìˆ˜ ìˆë‹¤. ê¸°ì¡´ì˜ Microservice ì•„í‚¤í…ì²˜ë¥¼ ë” ì‘ì€ ë‹¨ìœ„ì˜ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¦¬í•˜ëŠ” ìƒˆë¡œìš´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì•„í‚¤í…ì²˜ êµ¬ì¶•ì´ ê°€ëŠ¥í•˜ë‹¤. (Linux Containerë¥¼ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê³ ì„±ëŠ¥ ë° ê²½ëŸ‰ì„ ìš”êµ¬í•˜ëŠ” ì¼ë¶€ ë¶„ì•¼ì—ì„œ ê´‘ë²”ìœ„í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì ìš© ì˜ˆìƒ) ì˜ˆ: CloudFlare Worker (JS Container &#x2F; Worker, v8::Isolate) Node.js ê°€ ê°œë³„ ì¥ì¹˜ì˜ ì•± ì œì‘ì„ ìœ„í•´ ë§Œë“¤ì–´ì¡Œë‹¤ë©´ WorkerëŠ” CloudFlare íŠ¹í™” ë¶„ì‚° ë„¤íŠ¸ì› ì»´í“¨íŒ…ì„ ìœ„í•´ ë§Œë“¤ì–´ì§ https://developers.cloudflare.com/workers ì˜ˆ: Deno deploy (JS Container) Web Platform APIs ê¸°ë°˜, í”„ë¡œê·¸ë˜ë¨¸ê°€ ì•Œì•„ì•¼ í•  ê°œë…ë“¤ì„ ìµœì†Œí™” + Single Executable, No NPM, TypeScript, CLI https://deno.land https://tinyclouds.org/javascript_containers References https://webassembly.org https://bytecodealliance.org Pay attention to WebAssembly NodeJS Native Module vs WASM","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"JavaScript Objectì˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬","slug":"article-2023-11-26-js-object-lifetime","date":"2023-11-25T15:30:20.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-11-26-js-object-lifetime/","link":"","permalink":"https://llnm.github.io/article/2023-11-26-js-object-lifetime/","excerpt":"","text":"Node.js Core ì—ì„œ JavaScript ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œê¸° ìœ„í•´ì„œëŠ” V8 APIë¥¼ í†µí•´ ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬í•˜ëŠ” ì»¨ì…‰ì„ ì´í•´í•  í•„ìš”ê°€ ìˆë‹¤. ëª¨ë“  JavaScript ê°’ì€ V8 APIë¥¼ í†µí•´ ì†Œìœ„ í•¸ë“¤ì´ë¼ëŠ” ê²ƒì„ í†µí•´ ì•¡ì„¸ìŠ¤ëœë‹¤. ì´ í•¸ë“¤ì€ ë©”ëª¨ë¦¬ ê´€ì ì—ì„œ Localê³¼ Globalì´ë€ íƒ€ì…ìœ¼ë¡œ ë‚˜ë‰œë‹¤. ë©”ëª¨ë¦¬ ê´€ë¦¬ íƒ€ì…v8::Localv8::Local ì´ë€ JavaScirpt ê°’ì´ ë‹¤ë¤„ì§€ëŠ” í˜„ì¬ì˜ Local Block ì˜ì—­ (Stack) ì—ì„œë§Œ ìœ íš¨í•œ í•¸ë“¤ì„ ì˜ë¯¸í•œë‹¤. Local Blockì„ ë²—ì–´ë‚˜ë©´ ê°’ì€ ìœ íš¨í•˜ì§€ ì•Šê²Œ ëœë‹¤. ê°’ì´ Referencing ë˜ê³  ìˆëŠ”ì§€ì— ë”°ë¼ GC (Gabage Collector)ë¥¼ ìˆ˜í–‰í•˜ëŠ” JavaScript ì—”ì§„ ì¸¡ë©´ì—ì„œ ë©”ëª¨ë¦¬ ê´€ë¦¬ëŠ” ì¤‘ìš”í•œë°, ê¸°ë³¸ì ìœ¼ë¡œ C++ ì—ì„œ ëª¨ë“  JavaScript ê°’ì— ëŒ€í•´ì„œ Local í•¸ë“¤ë¡œì„œ ê´€ë¦¬í•¨ìœ¼ë¡œì„œ ë©”ëª¨ë¦¬ì˜ leakì„ ë°©ì§€í•œë‹¤. ì¦‰ ì„ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•  ë©”ëª¨ë¦¬ëŠ” ëª¨ë‘ Local í•¸ë“¤ë¡œì„œ ì§ê´€ì ìœ¼ë¡œ ë‹¤ë¤„ì§„ë‹¤. v8::Local ì€ JavaScript í•¸ë“¤ì´ ì–´ë–¤ ë©”ëª¨ë¦¬ ì˜ì—­ì—ì„œ ê´€ë¦¬ë˜ì•¼í•˜ëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” Referenceì¼ ë¿ Local ë©”ëª¨ë¦¬ ìƒì„±ì„ ì˜ë¯¸í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. Local í•¸ë“¤ì„ ìƒì„±í•˜ê¸° ìœ„í•´ì„  Stack ì˜ì—­ì— v8::HandleScope ë˜ëŠ” v8::EscapableHandleScope ê°ì²´ë¥¼ ìƒì„±í•´ì•¼í•œë‹¤. ìƒì„±ëœ ì´í›„ Local::New APIë¥¼ ì‚¬ìš©í•˜ë©´ ì‹¤ì œ Local ë©”ëª¨ë¦¬ì— ì ì¬ëœ JavaScript ê°’ì„ ìƒì„±í•  ìˆ˜ ìˆê³  ë§ˆì§€ë§‰ìœ¼ë¡œ ìƒì„±í•œ Scope ê°ì²´ì— ë©”ëª¨ë¦¬ ì˜ì—­ì´ ì¡íˆê²Œ ëœë‹¤. ê·¸ëŸ¬ë‚˜ Node.js ì—ì„œ ë°”ì¸ë”© í•¨ìˆ˜ ë‚´ë¶€ì— ìˆëŠ” ê²½ìš°ëŠ” Handleì˜ ë²”ìœ„ê°€ í•¨ìˆ˜ ì™¸ë¶€ì— ì´ë¯¸ ì¡´ì¬í•˜ë¯€ë¡œ ë³„ë„ë¡œ ë§Œë“¤ í•„ìš”ê°€ ì—†ë‹¤. v8::EscapableHandleScopeëŠ” Scope ë‚´ì—ì„œ ìƒì„±ëœ v8::Localì„ Scope ì™¸ë¶€ë¡œ ë„˜ê¸°ê³ ìí• ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. v8::EscapableHandleScope ê°ì²´ì˜ Escape APIë¡œ ìƒì„±í•œ v8::Local ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë„˜ê¸°ë©´ í•´ë‹¹ ì˜ì—­ ì™¸ë¶€ì˜ ë©”ëª¨ë¦¬ Scopeë¡œ ì „ë‹¬ëœë‹¤. v8::GlobalíŠ¹ì • Scopeë‚´ì—ì„œë§Œ ìœ ìš”í•œ v8::Localê³¼ ë‹¤ë¥´ê²Œ ë‹¤ë¥´ v8::Global ë¡œ ê´€ë¦¬ë˜ëŠ” í•¸ë“¤ì€ Scopeì™€ ê´€ê³„ì—†ì´ ìœ ì§€ë˜ë©° GC ëŒ€ìƒì´ ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤. ì •í™•íˆ ë§í•˜ë©´ Global í•¸ë“¤ì˜ Strong ìƒíƒœì—ì„œ GC ë˜ì§€ ì•ŠëŠ”ë‹¤. Global í•¸ë“¤ì€ Weak ìƒíƒœë¡œ ë³€ê²½í•  ìˆ˜ ìˆìœ¼ë©°, Weak ìƒíƒœê°€ ë˜ì—ˆì„ ë•Œ GC ë©”ì¹´ë‹ˆì¦˜ì— ì˜í•´ ë©”ëª¨ë¦¬ê°€ ë¦´ë¦¬ì¦ˆ ë  ìˆ˜ ìˆë‹¤. ê·¸ëŸ°ë°, ê·¸ëƒ¥ ë¦´ë¦¬ì¦ˆ ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ GC ë©”ì¹´ë‹ˆì¦˜ì— ì˜í•´ ë©”ëª¨ë¦¬ ë¦´ë¦¬ì¦ˆ ë˜ê¸° ì§ì „ì— ë“±ë¡ëœ Callbackì„ í†µí•´ í†µë³´ë°›ëŠ”ë‹¤. ê·¸ ì‹œì ì—ì„œ ë‹¤ì‹œ Strongìœ¼ë¡œ ë³€ê²½í• ì§€ Weakë¥¼ ìœ ì§€í•˜ì—¬ ë¦´ë¦¬ì¦ˆë¥¼ í• ì§€ ê²°ì •ì´ ê°€ëŠ¥í•˜ë‹¤. 1234567void function(v8::Isolate* isolate, v8::Local&lt;v8::Object&gt; obj) &#123; ... // Globalì˜ Reset() í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ Local ì˜ì—­ì— ìˆëŠ” obj í•¸ë“¤ì„ Globalë¡œ ì´ë™ì‹œí‚¨ë‹¤. // ì´ë™ì´ ë˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ Strong ìƒíƒœë¡œ í•¸ë“¤ì„ ê´€ë¦¬í•œë‹¤. v8::Global&lt;v8::Object&gt; reference = reference.Reset(isolate, obj); ...&#125; ìƒëª…ì£¼ê¸° ê´€ë¦¬JavaScript ì—”ì§„ì€ Gabage Collectorë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ ì–´ë–¤ ê°ì²´ë„ Referencingí•˜ì§€ ì•ŠëŠ” ê°ì²´ì— ëŒ€í•´ ì œê±°í•œë‹¤. ì‚¬ìš©ìê°€ JavaScript ê°ì²´ë¥¼ Referencing í•˜ì§€ ì•Šë”ë¼ë„ CoreëŠ” í•„ìš”ì— ë”°ë¼ íŠ¹ì • JavaScript ê°ì²´ê°€ ì—”ì§„ì— ì˜í•´ ì œê±°ë˜ëŠ” ê²ƒì„ ë°©ì§€í•´ì•¼í•œë‹¤. ê·¸ë ‡ê²Œ í•˜ê¸° ìœ„í•´ì„œ JavaScript Objectì˜ InternalField ì— C++ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥í•˜ê³ , JavaScript Objectì— ëŒ€í•œ ë©”ëª¨ë¦¬ ì˜ì—­ì„ Localì—ì„œ Globalë¡œ ë³€ê²½í•œë‹¤. ì´ ë™ì‘ì€ Node.jsì—ì„œ ê°ì²´ì™€ ë°”ì¸ë”©ë˜ëŠ” ëª¨ë“  Classì˜ ë¶€ëª¨ Classì¸ BaseObject ì˜ ìƒì„±ìì—ì„œ ìˆ˜í–‰ëœë‹¤. v8::Global&lt;v8::Object&gt; íƒ€ì… ë³€ìˆ˜ persistent_handle_ì— Local ê°ì²´ë¥¼ ë“±ë¡í•¨ìœ¼ë¡œì„œ ìƒê¸° Codeì—ì„œ Resetì„ í˜¸ì¶œí•œê²ƒê³¼ ê°™ì´ Global ë©”ëª¨ë¦¬ ì˜ì—­ìœ¼ë¡œ JavaScript ê°’ì„ ì´ë™ì‹œí‚¨ë‹¤. Weak ìƒíƒœë¡œ ë³€ê²½v8::Globalì˜ SetWeak APIëŠ” í˜„ì¬ Strongìœ¼ë¡œ ê´€ë¦¬ë˜ê³  ìˆëŠ” ë©”ëª¨ë¦¬ë¥¼ Weak ìƒíƒœë¡œ ë³€ê²½í•¨ìœ¼ë¡œì„œ GC ì‹œ ë©”ëª¨ë¦¬ë¥¼ ë¦´ë¦¬ì¦ˆ í•  ìˆ˜ ìˆê²Œ í•œë‹¤. 12345678910111213141516171819202122232425void BaseObject::MakeWeak() &#123; .... persistent_handle_.SetWeak( this, // (a) Callbackìœ¼ë¡œ ì „ë‹¬í•  í¬ì¸í„° [](const WeakCallbackInfo&lt;BaseObject&gt;&amp; data) &#123; // (a) ì—ì„œ ì „ë‹¬í•œ BaseObject í¬ì¸í„°ë¥¼ parameterë¡œì„œ íšë“í•œë‹¤. BaseObject* obj = data.GetParameter(); /* ~BaseObjectì—ì„œ internal fieldë¥¼ clean up í•˜ëŠ” ë¶€ë¶„ì´ ìˆëŠ”ë° GCì— ì˜í•´ ì‚­ì œëœ ê²½ìš°ëŠ” êµ³ì´ í•´ë‹¹ ë™ì‘ì„ í•˜ì§€ ì•Šë„ë¡ í•œë‹¤. */ obj-&gt;persistent_handle_.Reset(); // BaseObject ì¸ìŠ¤í„´ìŠ¤ê°€ ì—°ê²°ë˜ì–´ìˆë˜ JavaScript ê°ì²´ëŠ” ì´ì œ ì‚­ì œë˜ë‹ˆ, ì´ // BaseObjectë„ ì‚­ì œë˜ì–´ì•¼í•œë‹¤. OnGCCollect í•¨ìˆ˜ì—ì„œëŠ” delete thisë¥¼ ìˆ˜í–‰í•œë‹¤. obj-&gt;OnGCCollect(); &#125;, // (b) Callbackì— ì „ë‹¬ ê°€ëŠ¥í•œ íƒ€ì…ì€ kParameter ì™€ kInternalFields ì´ë©° // kInternalFields íƒ€ì…ì€, ì§€ì •ëœ internal fieldì˜ ì²« ë‘ fieldë¥¼ ì „ë‹¬í•œë‹¤. WeakCallbackType::kParameter);&#125; ìƒê¸° ì½”ë“œëŠ” BaseObjectì˜ MakeWeakí•¨ìˆ˜ì˜ ì¼ë¶€ì´ë‹¤. SetWeakë¥¼ í†µí•´ GC ë°œìƒì‹œì ì— ì½œë°±ì„ ë“±ë¡í•˜ê³  Strong ì—ì„œ Weak í•¸ë“¤ë¡œ ë³€ê²½í•œë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ê°€ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ë˜ê¸° ì „ì— ë“±ë¡ëœ ì½œë°±ì´ í˜¸ì¶œëœë‹¤. BaseObject::OnGCCollect()ë¥¼ í˜¸ì¶œí•˜ë©´ BaseObject ì¸ìŠ¤í„´ìŠ¤ê°€ ì‚­ì œëœë‹¤. SetWeak ë“±ë¡ëœ í›„ BaseObject::ClearWeak()ë¥¼ í˜¸ì¶œí•˜ì—¬ Strongìƒíƒœë¡œ ë‹¤ì‹œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ í•´ë‹¹ ì„œë¸Œí´ë˜ìŠ¤ê°€ ì´ë²¤íŠ¸ ë£¨í”„ ë“±ì—ì„œ ì°¸ì¡°ë˜ì§€ ì•ŠëŠ” í•œ, HandleWrap ë° ReqWrap í´ë˜ìŠ¤ì˜ ê²½ìš°ì²˜ëŸ¼ í•´ë‹¹ ì„œë¸Œí´ë˜ìŠ¤ì˜ ìƒì„±ìì—ì„œ MakeWeak()ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ í•©ë¦¬ì ì…ë‹ˆë‹¤. Smart Pointer for BaseObjectBaseObjectPtrBaseObjectì˜ ì„œë¸Œí´ë˜ìŠ¤ Tì˜ ê°ì²´ë¥¼ Shared Pointerë¡œì„œ ë³´ìœ í•œë‹¤. ì¦‰, ì´ í¬ì¸í„°ë¥¼ ê°€ì§€ê³  ìˆëŠ”ë™ì•ˆì€ BaseObjectëŠ” Strong ì°¸ì¡°ë¥¼ ìœ ì§€í•œë‹¤. BaseObjectëŠ” JavaScript ê°ì²´ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ë”°ë¥´ë‚˜ Detach()ê°€ í˜¸ì¶œëœë‹¤ë©´ BaseObjectë¥¼ JavaScript ê°ì²´ì˜ ìƒëª…ì£¼ê¸°ë¡œ ë¶€í„° ë¶„ë¦¬í•´ë‚¼ìˆ˜ ìˆë‹¤. ì´ ê²½ìš° BaseObjectPtr ë¥¼ ì°¸ì¡°í•˜ëŠ” ë§ˆì§€ë§‰ í¬ì¸í„°ê°€ ì œê±°ë˜ë©´ BaseObjectëŠ” ë¦´ë¦¬ì¦ˆëœë‹¤. BaseObjectWeakPtrBaseObjectì˜ ì„œë¸Œí´ë˜ìŠ¤ Tì˜ ê°ì²´ë¥¼ Weak Pointerë¡œì„œ ë³´ìœ í•œë‹¤. Garbage Collectionì´ ë°œìƒí•´ BaseObjectê°€ ì œê±°ë˜ë©´ std::weak_ptr&lt;T&gt;ì™€ ìœ ì‚¬í•˜ê²Œ weak_ptr.get()ì˜ ê°’ìœ¼ë¡œ nullptrê°€ ë°˜í™˜ëœë‹¤. v8: State transition diagram1FREE -&gt; NORMAL &lt;-&gt; WEAK -&gt; PENDING -&gt; NEAR_DEATH -&gt; &#123; NORMAL, WEAK, FREE &#125;","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"Node.js C++ Core Concept","slug":"article-2023-11-24-memory-management","date":"2023-11-23T15:30:20.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-11-24-memory-management/","link":"","permalink":"https://llnm.github.io/article/2023-11-24-memory-management/","excerpt":"","text":"JavaScriptì™€ C++ ê°„ì˜ íš¨ìœ¨ì ì¸ ì—°ê²°ì€ Node.jsì—ì„œ ì¤‘ìš”í•œ ë¬¸ì œ ì¤‘ í•˜ë‚˜ì´ë‹¤. ì´ëŸ¬í•œ ì—°ê²°ì„ ê°€ëŠ¥í•˜ê¸° ìœ„í•´ Node.js Coreì—ì„œëŠ” ê¸°ë³¸ C++ í´ë˜ìŠ¤ë¡œ BaseObject ì‚¬ìš©í•œë‹¤. BaseObjectëŠ” JavaScript ê°ì²´ì™€ C++ ê°ì²´ë¥¼ í•¨ê»˜ ë¬¶ëŠ” ì£¼ìš” ì¶”ìƒí™” ìˆ˜ë‹¨ìœ¼ë¡œ, ì´ë¥¼ í†µí•´ ë©”ëª¨ë¦¬ ê´€ë¦¬ì™€ ë”ë¶ˆì–´ ê°ì²´ì˜ ìˆ˜ëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. BaseObjectNode.jsì—ì„œ JavaScript ê°ì²´ì™€ ì—°ê´€ëœ ëŒ€ë¶€ë¶„ì˜ í´ë˜ìŠ¤ëŠ” BaseObject ì˜ subclassì´ë‹¤. BaseObjectì˜ ìƒìœ„ í´ë˜ìŠ¤ëŠ” MemoryRainerì¸ë°, V8 Heap snapshot builderì—ì„œ ë©”ëª¨ë¦¬ ì¶”ì ì„ ìœ„í•´ C++ í´ë˜ìŠ¤ì— Annotationì„ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” Helper í´ë˜ìŠ¤ë¼ê³  í•œë‹¤. ë©”ëª¨ë¦¬ ë¦­ì— ëŒ€í•œ ë””ë²„ê¹… ìš©ë„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ëª¨ë“  BaseObjectëŠ” í•˜ë‚˜ì˜ Realmê³¼ í•˜ë‚˜ì˜ v8::Object ì™€ ì—°ê´€ëœë‹¤. v8::Object í´ë˜ìŠ¤ëŠ” JavaScrip Objectë¥¼ ëœ»í•œë‹¤. ì´ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì—ëŠ” internal fieldë¼ê³  í•˜ëŠ” ê³µê°„ì„ í• ë‹¹í•  ìˆ˜ ìˆë‹¤. ì´ ê³µê°„ì— BaseObjectì˜ ë‚˜ í•˜ìœ„ Classì˜ í¬ì¸í„°ë¥¼ ì—°ê²°í•¨ìœ¼ë¡œì„œ JavaScript Object ì™€ C++ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°”ì¸ë”©í•œë‹¤. Internal Fieldì— ë°˜ë“œì‹œ BaseObjectì˜ ì„œë¸Œí´ë˜ìŠ¤ë§Œ ë“±ë¡í•´ì•¼í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. InternalFieldì— ì–¼ë§ˆë‚˜ ë§ì€ ì •ë³´ë¥¼ ë„£ì„ì§€ëŠ” V8 APIì˜ SetInternalFieldCount() ë¥¼ í†µí•´ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. base_object.cclink2122232425262728BaseObject::BaseObject(Realm* realm, Local&lt;Object&gt; object) : persistent_handle_(realm-&gt;isolate(), object), realm_(realm) &#123; CHECK_EQ(false, object.IsEmpty()); CHECK_GE(object-&gt;InternalFieldCount(), BaseObject::kInternalFieldCount); SetInternalFields(realm-&gt;isolate_data(), object, static_cast&lt;void*&gt;(this)); realm-&gt;AddCleanupHook(DeleteMe, static_cast&lt;void*&gt;(this)); realm-&gt;modify_base_object_count(1);&#125; ìƒê¸° BaseObject ìƒì„±ì í•¨ìˆ˜ì—ì„œ í™•ì¸ í•  ìˆ˜ ìˆë“¯ì´ SetInternalFields ë¥¼ ì´ìš©í•´ Local ë©”ëª¨ë¦¬ ì˜ì—­ì˜ objectì— BaseObject ì¸ìŠ¤í„´ìŠ¤ ìì‹  (this) ë¥¼ ì„¤ì •í•œë‹¤. Accessing BaseObjectC++ë ˆë²¨ì—ì„œ JavaScript Objectë¡œ ë¶€í„° BaseObjectì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ì–»ëŠ” ë°©ë²•ì€ Unwrap&lt;T&gt; ë¥¼ ì‚¬ìš©í•œë‹¤. ë³´í†µ JavaScript ê°ì²´ì˜ Function Callbackì˜ í˜¸ì¶œë˜ì—ˆì„ë•Œ arg.This() ë‚˜ arg.Holder() ë¡œ ë¶€í„° ì–»ì„ìˆ˜ ìˆë‹¤. (args.Holder()ëŠ” Node.js ë‚´ë¶€ì˜ ëª¨ë“  ì‚¬ìš© ì‚¬ë¡€ì—ì„œ args.This()ì™€ ë™ì¼). Unwrap&lt;T&gt;() ëŠ” ë°˜í™˜ë°›ëŠ” Pointerë¥¼ ë¯¸ë¦¬ Castingí•˜ë ¤ëŠ” ìš©ë„ì˜ Alias í•¨ìˆ˜ì´ë‹¤. ë‚´ë¶€ì ìœ¼ë¡œëŠ” BaseObject::FromJSObject ì— ì˜í•´ì„œ v8::Objectë¶€í„° ê¸° ì§€ì •í•œ internal fieldë¡œ ë¶€í„° Pointerë¥¼ ì–»ì–´ì˜¨ë‹¤. base_object.hlink246247248249250251#define ASSIGN_OR_RETURN_UNWRAP(ptr, obj, ...) \\ do &#123; \\ *ptr = static_cast&lt;typename std::remove_reference&lt;decltype(*ptr)&gt;::type&gt;( \\ BaseObject::FromJSObject(obj)); \\ if (*ptr == nullptr) return __VA_ARGS__; \\ &#125; while (0) AsyncWrapAsyncHookì€ ë¹„ë™ê¸° ìš”ì²­(init&#x2F;destory)ì˜ ìˆ˜ëª… ë° í•´ë‹¹ ì½œë°± í™œë™(Before&#x2F;After)ì„ ì¶”ì í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. ì´ë¥¼ ìœ„í•œ ì¶”ê°€ì ì¸ ì •ë³´ì™€ ë„êµ¬ë¥¼ ì œê³µí•˜ëŠ” BaseObjectì˜ ì„œë¸Œí´ë˜ìŠ¤ê°€ AsyncWrapì´ë‹¤. AsyncHookì—ì„œ ëª…ì‹œë˜ì—ˆë˜ ê²ƒê³¼ ê°™ì´ ì–´ë–¤ Core ëª¨ë“ˆì´ í•´ë‹¹ Asyncë™ì‘ì„ ìˆ˜í–‰í–ˆëŠ”ì§€ë¥¼ ì¶”ì í•˜ê¸° ìœ„í•œ unique idê°€ ìˆë‹¤. async_wrap.hlink3435363738394041424344#define NODE_ASYNC_NON_CRYPTO_PROVIDER_TYPES(V) \\ V(NONE) \\ V(DIRHANDLE) \\ V(DNSCHANNEL) \\ V(ELDHISTOGRAM) \\ V(FILEHANDLE) \\ V(FILEHANDLECLOSEREQ) \\ V(BLOBREADER) \\ V(FSEVENTWRAP) \\ V(FSREQCALLBACK) \\ V(FSREQPROMISE) \\ AsyncHookì„ ë„ì…í• ë•Œ ë¹„ë™ê¸° ì—°ì‚°ì— ëŒ€í•œ ë””ë²„ê¹…ì„ ì‰½ê²Œí•˜ê¸° ìœ„í•¨ì´ì—ˆì„ê²ƒ ê°™ë‹¤. (TODO: í–¥í›„ Historyë¥¼ ì°¾ìœ¼ë©´ ë‹¤ì‹œ ì—…ë°ì´íŠ¸ í•˜ê² ë‹¤.) ê·¸ëŸ¬ë‚˜, ìµœê·¼ FS ëª¨ë“ˆì— ëŒ€í•œ Async File Readë¥¼ ë¶„ì„í•´ë³´ë‹ˆ Tracingì„ ë‹¨ì¼ Operation ë‹¨ìœ„ë¡œ ì²˜ë¦¬ë  ìˆ˜ ìˆë„ë¡ ê³ ì •ë˜ì–´ìˆì–´ í†µí•©ëœ ë¹„ë™ê¸° ë™ì‘ì— ëŒ€í•œ Tracing ì²˜ë¦¬ë¥¼ ë§Œë“¤ê¸°ê°€ ì–´ë ¤ì› ë‹¤. ë˜, Node.js ì—ì„œëŠ” ê³µì‹ì ìœ¼ë¡œ AsyncHookì— ëŒ€í•œ ê¸°ëŠ¥ ì‚¬ìš©ì„ ê¶Œí•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ, í–¥í›„ ì–´ë–¤ ë°©í–¥ì´ë“  ê°œì„ ì´ í•„ìš”í•œ í´ë˜ìŠ¤ì´ë‹¤. AsyncWrap í´ë˜ìŠ¤ì—ì„œ ì¤‘ìš”í•œ í•¨ìˆ˜ëŠ” MakeCallbackì„ ë“¤ìˆ˜ ìˆë‹¤. Callbackì„ ë§Œë“¤ê¸° ìœ„í•œ í•¨ìˆ˜ëª… ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ ì´ë¦„ê³¼ëŠ” ë‹¤ë¥´ê²Œ ì‹¤ì œì˜ë¯¸ëŠ” C++ì—ì„œ JavaScript ìª½ìœ¼ë¡œ Callbackì„ ë¶€ë¥´ëŠ” ìš©ë„ë¥¼ í•œë‹¤. ì°¸ê³ ë¡œ ì´ëŸ¬í•œ JavaScriptì™€ C++ ì‚¬ì´ì˜ Context Switchingì´ ì¼ì–´ë‚˜ëŠ” ê²½ìš° Costê°€ ë§ì´ ë“¤ê¸° ë•Œë¬¸ì— ë˜ë„ë¡ ì ê²Œ ë¶€ë¥´ëŠ” ê²ƒì´ Performance ì¸¡ë©´ì—ì„œ ì¢‹ë‹¤. 123456789101112131415161718192021void StatWatcher::Callback(uv_fs_poll_t* handle, int status, const uv_stat_t* prev, const uv_stat_t* curr) &#123; // StatWatcher ëŠ” AsyncWrapì˜ ì„œë¸Œ í´ë˜ìŠ¤ StatWatcher* wrap = ContainerOf(&amp;StatWatcher::watcher_, handle); Environment* env = wrap-&gt;env(); // Integer::New ë¡œ í• ë‹¹ì„ í•˜ê¸° ë•Œë¬¸ì— HandleScopeë¥¼ ì¡ì•„ì¤€ë‹¤. HandleScope handle_scope(env-&gt;isolate()); Context::Scope context_scope(env-&gt;context()); ... // C++ì—ì„œ JavaScript ìª½ìœ¼ë¡œ ì „ë‹¬í•  argument Local&lt;Value&gt; argv[] = &#123; Integer::New(env-&gt;isolate(), status), arr &#125;; // wrap ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²°ëœ ê°ì²´ì— í”„ë¡œí¼í‹°ì¤‘ onchange ì— ë“±ë¡ëœ ì½œë°±ì„ í˜¸ì¶œ wrap-&gt;MakeCallback(env-&gt;onchange_string(), arraysize(argv), argv);&#125; Libuv Handlerslibuvì—ì„œ ì´ë²¤íŠ¸ ë£¨í”„ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” íƒ€ì…ì´ ìˆëŠ”ë° handleê³¼ requestì´ë‹¤. uv.hë¥¼ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ì •ì˜ëœ íƒ€ì…ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. uv.hlink217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247/* Handle types. */typedef struct uv_loop_s uv_loop_t;typedef struct uv_handle_s uv_handle_t;typedef struct uv_dir_s uv_dir_t;typedef struct uv_stream_s uv_stream_t;typedef struct uv_tcp_s uv_tcp_t;typedef struct uv_udp_s uv_udp_t;typedef struct uv_pipe_s uv_pipe_t;typedef struct uv_tty_s uv_tty_t;typedef struct uv_poll_s uv_poll_t;typedef struct uv_timer_s uv_timer_t;typedef struct uv_prepare_s uv_prepare_t;typedef struct uv_check_s uv_check_t;typedef struct uv_idle_s uv_idle_t;typedef struct uv_async_s uv_async_t;typedef struct uv_process_s uv_process_t;typedef struct uv_fs_event_s uv_fs_event_t;typedef struct uv_fs_poll_s uv_fs_poll_t;typedef struct uv_signal_s uv_signal_t;/* Request types. */typedef struct uv_req_s uv_req_t;typedef struct uv_getaddrinfo_s uv_getaddrinfo_t;typedef struct uv_getnameinfo_s uv_getnameinfo_t;typedef struct uv_shutdown_s uv_shutdown_t;typedef struct uv_write_s uv_write_t;typedef struct uv_connect_s uv_connect_t;typedef struct uv_udp_send_s uv_udp_send_t;typedef struct uv_fs_s uv_fs_t;typedef struct uv_work_s uv_work_t;typedef struct uv_random_s uv_random_t; Handleì€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°, íƒ€ì´ë¨¸, í˜¹ì€ ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ì™€ ê´€ë ¨ëœ ì´ë²¤íŠ¸ë¥¼ ì¶”ì í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤. ì´ë²¤íŠ¸ ë£¨í”„ê°€ ì´ëŸ¬í•œ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ê³  ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•¸ë“¤ì„ ë“±ë¡í•˜ê³  ê´€ë¦¬í•œë‹¤. RequestëŠ” ë¹„ë™ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ì™„ë£Œë˜ì—ˆì„ ë•Œ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤. íŒŒì¼ ì½ê¸°, ì“°ê¸°, í˜¹ì€ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ê³¼ ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•  ë•Œ requestë¥¼ ìƒì„±í•˜ì—¬ ì™„ë£Œë˜ì—ˆì„ ë•Œì˜ ì½œë°±ì„ ë“±ë¡í•œë‹¤. Libuv Handle Wrapper ClassHandleWrapHandleWrapì€ AsyncWrapì˜ ì„œë¸Œí´ë˜ìŠ¤ì´ë©° uv_handle_t ì™€ ê°™ì€ libuvì˜ í•¸ë“¤ì„ ê°ì‹¸ì„œ ê´€ë¦¬í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©ëœë‹¤. .ref(), .unref(),.hasRef(),.close() ë“±ì˜ í•¨ìˆ˜ê°€ ì œê³µë˜ëŠ”ë°, í•¨ìˆ˜ ë‚´ë¶€ì ìœ¼ë¡œ libuvì˜ uv_ref(), uv_unref() ì™€ ê°™ì€ APIë¥¼ í˜¸ì¶œí•œë‹¤. 1234567void HandleWrap::Ref(const FunctionCallbackInfo&lt;Value&gt;&amp; args) &#123; HandleWrap* wrap; ASSIGN_OR_RETURN_UNWRAP(&amp;wrap, args.Holder()); if (IsAlive(wrap)) uv_ref(wrap-&gt;GetHandle());&#125; ReqWrapReqWrap AsyncWrapì˜ ì„œë¸Œí´ë˜ìŠ¤ì´ë©° uv_req_t ì™€ ê°™ì€ libuvì˜ requestë¥¼ ì‰½ê²Œ ì²˜ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. ì˜ˆë¥¼ë“¤ë©´ íŒŒì¼ì„ ì½ëŠ” ë™ì‘ì„ uv_fs_t request í•¸ë“¤ì„ ì´ìš©í•˜ì—¬ ì „ë‹¬í• ë•Œ ìš”ì²­ëœ ë™ì‘ì´ ëë‚˜ë©´ ê²°ê³¼ Callbackì´ í˜¸ì¶œë˜ë„ë¡ ë“±ë¡í•œë‹¤. ReqWrap::Dispatch() ë©”ì„œë“œëŠ” ì´ëŸ¬í•œ ë™ì‘ì„ ì¼ê´€ëœ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œí•œë‹¤. req_wrap-inl.hlink137138139140141142143144145146147148149150151152153154155156157158159160161162163164165template &lt;typename T&gt;template &lt;typename LibuvFunction, typename... Args&gt;int ReqWrap&lt;T&gt;::Dispatch(LibuvFunction fn, Args... args) &#123; Dispatched(); // This expands as: // // int err = fn(env()-&gt;event_loop(), req(), arg1, arg2, Wrapper, arg3, ...) // ^ ^ ^ // | | | // \\-- Omitted if `fn` has no | | // first `uv_loop_t*` argument | | // | | // A function callback whose first argument | | // matches the libuv request type is replaced ---/ | // by the `Wrapper` method defined above | // | // Other (non-function) arguments are passed -----/ // through verbatim int err = CallLibuvFunction&lt;T, LibuvFunction&gt;::Call( fn, env()-&gt;event_loop(), req(), MakeLibuvRequestCallback&lt;T, Args&gt;::For(this, args)...); if (err &gt;= 0) &#123; ClearWeak(); env()-&gt;IncreaseWaitingRequestCounter(); &#125; return err;&#125;","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"Realm Class","slug":"article-2023-11-23-realm","date":"2023-11-22T15:30:20.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-11-23-realm/","link":"","permalink":"https://llnm.github.io/article/2023-11-23-realm/","excerpt":"","text":"2022ë…„ Node.js ì—ëŠ” Realm Classê°€ ì¶”ê°€ë˜ì—ˆë‹¤. Realmì€ ì£¼ë¡œ ì‹¤í–‰ í™˜ê²½ì„ ì •ì˜í•˜ê³  ì½”ë“œ ê°„ì˜ ê²©ë¦¬ì™€ ë¶„ë¦¬ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤. ê¸°ì¡´ Node.js VM ëª¨ë“ˆì´ ìˆìœ¼ë‚˜ Node.js ìì²´ ê¸°ëŠ¥ì´ê³  JavaScript Object Graphê°€ ë…¸ì¶œë  ê°€ëŠ¥ì„±ì´ ìˆë‹¤. ê·¸ì—ë¹„í•´ ìƒˆë¡­ê²Œ ë„ì…ëœ Realmì€ ë³´ì•ˆì¸¡ë©´ì—ì„œ ê°•í™”ëœ JavaScript ì‹¤í–‰í™˜ê²½ì„ ì œê³µí•œë‹¤. ECMAScript Realmì •ì˜ì™€ êµ¬ì„±ìš”ì†ŒECMAScript realmì€ ECMAScript ìŠ¤í™ìƒì˜ ê°œë…ì´ë‹¤. ì´ ìš©ì–´ëŠ” ì½”ë“œ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸, ì‹¤í–‰ í™˜ê²½ ë° ì—°ê´€ëœ ê°ì²´ì˜ ì§‘í•©ì„ ë‚˜íƒ€ë‚´ëŠ”ë°, ê°„ë‹¨íˆ ë§í•´ì„œ ì½”ë“œê°€ ì‹¤í–‰ë˜ê³  ë³€ìˆ˜, í•¨ìˆ˜, ê°ì²´ ë“±ì´ ì¡´ì¬í•˜ëŠ” ê³µê°„ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤. ë‹¤ìŒì€ Realmì˜ ì¢…ë¥˜ì´ë‹¤. Principal Realm: ê°ê°ì˜ ECMAScript ì‹¤í–‰ í™˜ê²½ì—ì„œ í•˜ë‚˜ì”©ë§Œ ì¡´ì¬í•˜ëŠ” íŠ¹ìˆ˜í•œ Realm. ì´ Realmì€ ì£¼ë¡œ ì½”ë“œ ì‹¤í–‰ì— ì‚¬ìš©ë˜ë©°, ì „ì—­ ê°ì²´ì™€ ìŠ¤ì½”í”„ë¥¼ í¬í•¨í•˜ëŠ” ì£¼ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì •ì˜í•œë‹¤. Synthetic Realm: JavaScript ì½”ë“œì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ê°€ìƒì˜ Realm. ì£¼ë¡œ ì½”ë“œ ë¶„ë¦¬ ë° ê²©ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©ëœë‹¤. ê° Synthetic Realmì€ ìì²´ì˜ ì „ì—­ ê°ì²´ì™€ ìŠ¤ì½”í”„ë¥¼ ê°–ê³  ìˆë‹¤. ëª¨ë“ˆ ì‹œìŠ¤í…œê³¼ ê´€ë ¨ì´ ìˆì–´, ëª¨ë“ˆ ê°„ì˜ ê²©ë¦¬ë¥¼ ìœ ì§€í•˜ê³  ì½”ë“œì˜ ë…ë¦½ì„±ì„ ì¦ê°€ì‹œí‚¤ëŠ” ë° ì‚¬ìš©ëœë‹¤. ECMAScript realmì€ êµ¬ì„± ì¤‘ ì¼ë¶€ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. Global Object: ê° realmì€ ì „ì—­ ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, ì´ ê°ì²´ëŠ” í•´ë‹¹ realmì— ì†í•œ ëª¨ë“  ì „ì—­ ë³€ìˆ˜ì™€ í•¨ìˆ˜ë¥¼ í¬í•¨í•¨. ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œëŠ” window, Node.jsì—ì„œëŠ” globalì´ ì „ì—­ ê°ì²´ì— í•´ë‹¹í•œë‹¤. Global Scope: ì „ì—­ ê°ì²´ì˜ ìŠ¤ì½”í”„ì— ì†í•˜ëŠ” ë³€ìˆ˜ì™€ í•¨ìˆ˜ëŠ” ì „ì—­ ìŠ¤ì½”í”„ì— ì¡´ì¬í•˜ë©° realm ì „ì²´ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë²”ìœ„ë¥¼ ì˜ë¯¸í•œë‹¤. Intrinsics: ê° realmì€ íŠ¹ì •í•œ ë¹ŒíŠ¸ì¸ ê°ì²´ì™€ í•¨ìˆ˜ë¥¼ ê°–ëŠ”ë‹¤. Objectë‚˜ Arrayì™€ ê°™ì€ ê°ì²´ ìƒì„±ìë“¤ì´ ì—¬ê¸°ì— ì†í•œë‹¤. Declarative Environment Records: ë³€ìˆ˜ ì„ ì–¸ ë“±ê³¼ ê°™ì€ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ê°ì²´. Object Environment Records: ì „ì—­ ê°ì²´ ë“±ê³¼ ê°™ì€ ê°ì²´ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ìœ ì§€í•˜ëŠ” ê°ì²´ êµ¬ì„±ìš”ì†Œì— ê´€í•œ ë” ìƒì„¸í•œ ë‚´ìš©ì€ ì•„ë˜ ë§í¬ë¥¼ ì°¸ì¡°í•œë‹¤. ECMAScriptÂ® 2024 Language Specification (tc39.es) Realm ClassNode.js ì—ì„œ Realm í´ë˜ìŠ¤ëŠ” íŠ¹ì • ECMAScript ì˜ì—­ê³¼ ì—°ê´€ëœ JavaScript ê°ì²´ ë° í•¨ìˆ˜ ì§‘í•©ì„ ìœ„í•œ ì»¨í…Œì´ë„ˆì´ë‹¤. ê° ECMAScript ì˜ì—­ì—ëŠ” Global Objectì™€ Intrinsics ì§‘í•©ì´ ìˆë‹¤. ECMAScript ì˜ì—­ì—ëŠ” [[HostDefined]] í•„ë“œê°€ ìˆìœ¼ë©°, ì´ í•„ë“œëŠ” Node.js ì˜ì—­ ê°ì²´ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ëª¨ë“  Realm ì¸ìŠ¤í„´ìŠ¤ëŠ” Contextì—ì„œ ìƒì„±ëœë‹¤. Node.js ë‚´ì—ì„œ Realm ì€ ë³¸ ê°œë…ê³¼ ê°™ì´ principal realm ê³¼ synthetic realmìœ¼ë¡œ ìƒì„±ë  ìˆ˜ ìˆë‹¤. principal realmëŠ” Node::Environmentì˜ main Contextì—ì„œ ìƒì„±ëœë‹¤. synthetic realmì€ ShadowRealmì˜ Context (JavaScript APIì— ì˜í•´ ìƒì„±ë¨) ì— ëŒ€í•´ ìƒì„±ëœë‹¤. vm.Contextì—ëŠ” Realm instanceë¥¼ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤. ShadowRealmì„ ì´ìš©í•œ IsolationNode.js ê°€ ë„ì…í•œ ë‚´ìš©ì€ Synthetic Realmì„ ì´ìš©í•œ ê°ì²´ ì°¸ì¡° (Object Graph) ì˜ ê²©ë¦¬ë¥¼ ë³´ì¥í•˜ëŠ” ê²ƒì´ë‹¤. ì•„ë˜ì˜ ì˜ˆë¥¼ ë“¤ë©´ (1) ì—ì„œ vmì—ì„œ ìƒì„±ëœ í•¨ìˆ˜ê°€ ì™¸ë¶€ì˜ ê°ì²´ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ë° ì´ëŸ¬í•œ ì°¸ì¡°ë¥¼ Synthetic Realmì„ í†µí•´ ê²©ë¦¬ì‹œí‚¬ ìˆ˜ ìˆë‹¤. 1234let ctx = vm.createContext();let fn = vm.runInContext(&#x27;...&#x27;, ctx);fn(&#123;&#125;); // &lt;= (1) vmì—ì„œ ìƒì„±ëœ í•¨ìˆ˜ê°€ ì™¸ë¶€ `Object`ì— ì•¡ì„¸ìŠ¤í•˜ì—¬ ë©”ì„œë“œì— ì ‘ê·¼í• ìˆ˜ ìˆë‹¤. ShadowRealm tc39&#x2F;proposal-shadowrealm: ECMAScript Proposal, specs, and reference implementation for Realms (github.com) Synthetic Realmì„ ìƒì„±í•˜ê¸° ìœ„í•´ Node.jsëŠ” TC39 3ë‹¨ê³„ ì œì•ˆìƒíƒœì¸ ShadowRealm ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤. ShadowRealmì€ ì„œë¡œ ë‹¤ë¥¸ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ê°„ì˜ ê°ì²´ ê·¸ë˜í”„ ê²©ë¦¬ë¥¼ ë³´ì¥í•˜ê³ , ìƒˆë¡œìš´ ë¹ŒíŠ¸ì¸ì„ ë„ì…í•˜ì—¬ ë³„ê°œì˜ ê¸€ë¡œë²Œ í™˜ê²½ì„ ì œê³µí•œë‹¤. ë˜í•œ ShadowRealmì€ ì‚¬ìš©í•˜ëŠ” ëª¨ë“ˆ ê·¸ë˜í”„ê°€ ì™¸ë¶€ ì˜ì—­ìœ¼ë¡œë¶€í„° ê²©ë¦¬ë˜ë„ë¡ ë³´ì¥í•œë‹¤. ShadowRealmì€ ëª¨ë“  ì£¼ìš” ì˜ì—­ (main thread í™˜ê²½ &#x2F; worker thread í™˜ê²½), ë‹¤ë¥¸ ShadowRealm ë° vm.Contextì—ì„œ ìƒì„±í•  ìˆ˜ ìˆë‹¤. VMê³¼ ë¹„êµí•˜ë©´ ShadowRealmì€ URL, TextEncoders ë“±ê³¼ ê°™ì´ Node.js ì—ì„œ ê³µí†µì¸ APIê°€ ë‚´ì¥ë˜ì–´ ìˆë‹¤. ë”°ë¼ì„œ ë” ì‰½ê²Œ ì¼ë°˜ì ì¸ JavaScript ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. Node.js ì—ì„œ Realmì„ ê³„ì¸µì ìœ¼ë¡œ êµ¬ì¡°í•œ ë””ìì¸ì„ ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤. Environment (Main thread ë‚˜ Worker threads, ECMAScript agentë¥¼ ë‚˜íƒ€ë‚¸ë‹¤) worker_contexts: worker ê°€ ê°ì²´ë¥¼ ì²˜ë¦¬í•œë‹¤. handle objects. principal_realm: principal realm (v8::Context) ê³¼ ê´€ë ¨ëœ ë°ì´í„° synthetic_realms: Synthetic realms. time origin. Realm (realm record, principal realm, ShadowRealm, vm.Context): context: ì‹¤í–‰ context. principal realmì„ ë‚˜íƒ€ë‚´ëŠ” í”Œë˜ê·¸ module map. Per-context persistent handles. â€¦ principal realmê³¼ synthetic realm ê°„ ê³µí†µì¸ ë°ì´í„° ê° Realmì€ ì—¬ëŸ¬ ê°œì˜ synthetic realm ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤. Realmì˜ ë„ì…ìœ¼ë¡œ Node::EnvironmentëŠ” ì´ë²¤íŠ¸ ë£¨í”„, Inspector ë“± ì—¬ëŸ¬ Realmì—ì„œ ê³µìœ í•  ìˆ˜ ìˆëŠ” ê¸°íƒ€ ì—¬ëŸ¬ ê°€ì§€ë¥¼ ì†Œìœ í•˜ëŠ” Thread&#x2F;Execution environment&#x2F;ECMAScript ì—ì´ì „íŠ¸ì˜ ë ˆì½”ë“œë¡œ í•´ì„í•  ìˆ˜ ìˆë‹¤. Bootstrapping ìˆœì„œnode::Environment Principal realm ì„¤ì • InitializeContext internal&#x2F;per_context&#x2F;primordials internal&#x2F;per_context&#x2F;domexception internal&#x2F;per_context&#x2F;messageport Environment::RunBootstrapping internal&#x2F;bootstrap&#x2F;loaders internal&#x2F;bootstrap&#x2F;node node global extensions and the process object ì„¤ì • internal&#x2F;bootstrap&#x2F;browser web API global extensions ì„¤ì • internal&#x2F;bootstrap&#x2F;switches&#x2F;{is_main_thread, is_not_main_thread} internal&#x2F;bootstrap&#x2F;switches&#x2F;{does_own_process_state, does_not_own_process_state} LoadEnvironment internal&#x2F;main&#x2F;* internal&#x2F;bootstrap&#x2F;pre_execution SyntheticEnvironmentì˜ ê²½ìš°, (1) ë° (2) ë‹¨ê³„ëŠ” node::Environmentì˜ principal realm ì™€ ìœ ì‚¬í•˜ë‹¤. (2)ì—ì„œ ê¸€ë¡œë²Œì„ internal&#x2F;bootstrap&#x2F;switchesë¡œ ì´ˆê¸°í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ node::Environmentì˜ principal realmê³¼ Synthetic Realmì— ëŒ€í•´ ë¶„í• í•´ì•¼ í•œë‹¤. (Synthetic Realmì—ì„œ íŠ¹ì • ê¸€ë¡œë²Œì„ ë…¸ì¶œí•˜ì§€ ì•ŠëŠ” ê²ƒê³¼ ê°™ì€ ë°©ì‹) global ì„¤ì • global: internal&#x2F;bootstrap&#x2F;node setupGlobalProxy process: internal&#x2F;bootstrap&#x2F;node Buffer: internal&#x2F;bootstrap&#x2F;node Web interfaces: internal&#x2F;bootstrap&#x2F;browser References https://weizmangal.com/2022/10/28/what-is-a-realm-in-js/ https://developer.salesforce.com/blogs/2022/04/introducing-shadowrealm https://github.com/nodejs/node/pull/44179","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"Server JavaScript Runtime ê¸°ìˆ  ë™í–¥","slug":"article-2023-11-22-javascript-runtime","date":"2023-11-21T15:13:00.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-11-22-javascript-runtime/","link":"","permalink":"https://llnm.github.io/article/2023-11-22-javascript-runtime/","excerpt":"","text":"ë¸Œë¼ìš°ì € ì™¸ë¶€ì—ì„œ JavaScriptë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” Node.jsê°€ ë“±ì¥í•œ ì´í›„ ì‚°ì—…ì „ë°˜ì—ì„œ ë‹¤ì–‘í•˜ê²Œ í™œìš©ë˜ë©° De-facto í‘œì¤€ìœ¼ë¡œ ìë¦¬ì¡ì•˜ë‹¤. í˜„ì¬ëŠ” Node.jsì˜ ê²°ì ì„ ë³´ì™„í•˜ê±°ë‚˜, ê° íšŒì‚¬ì— ìµœì í™” ëœ ìì²´ ì†”ë£¨ì…˜ìœ¼ë¡œ ëŒ€ì²´í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ JavaScript ëŸ°íƒ€ì„ì´ íŒŒí¸í™”ë˜ê³  ìˆìœ¼ë©°, ê°œë°œìë“¤ì—ê²Œ í†µí•©ëœ ê°œë°œ APIì„ ì œê³µí•˜ê¸° ìœ„í•œ ê° ëŸ°íƒ€ì„ ê°„ ìƒí˜¸ìš´ìš©ì„±ì— ëŒ€í•´ ë…¼ì˜ ì¤‘ì´ë‹¤. ì‹ ê·œ Server&#x2F;Edge JavaScript Runtimeì˜ ì£¼ìš” ê¸°ëŠ¥ì‹ ê·œ Runtimeë“¤ì€ ê°ê° ì°¨ë³„ë˜ëŠ” ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆìœ¼ë©° Node.js ëŒ€ë¹„ í¬ê²Œ ë³´ì•ˆ, ì„±ëŠ¥, ëª¨ë“ˆ ë³µì¡ì„± ê°œì„ , í–¥ìƒëœ DX ì œê³µ ë“±ì„ ì£¼ìš” ëª©í‘œë¡œ í•˜ê³  ìˆë‹¤. DenoëŠ” ë³´ì•ˆ ì¸¡ë©´ì—ì„œ Node.jsê°€ ì‹œìŠ¤í…œ ìì›ì˜ ì‚¬ìš©ì— ëŒ€í•´ ì–´ë– í•œ ì œí•œë„ ë‘ê³  ìˆì§€ ì•ŠëŠ” ê²ƒì— ë¹„í•´, ì‚¬ìš©ìê°€ ì‚¬ìš©í•˜ëŠ” ì™¸ë¶€ ëª¨ë“ˆì— ëŒ€í•´ì„œ íˆ¬ëª…í•˜ê²Œ ê³µì§€í•˜ê³  ì œí•œí•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. Bunì€ Network&#x2F;DB í…Œì´ë¸” ë¡œë”©ë“±ì˜ ì„±ëŠ¥ì— ìˆì–´ì„œ ìœ ì˜ë¯¸í•œ ì°¨ì´ë¥¼ ì œê³µí•˜ë©°, WorkerdëŠ” ì—¬ëŸ¬ ì•±ì„ í•˜ë‚˜ì˜ Runtimeì—ì„œ ì‹¤í–‰í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë° Cold Start ì†ë„ë¥¼ í–¥ìƒì‹œí‚¨ë‹¤. Core APIì— ì—¬ëŸ¬ ê¸°ëŠ¥ì´ í¬í•¨ë˜ëŠ” ê²ƒì„ ì§€ì–‘í•œ Node.jsì— ë¹„í•´, ì‹ ê·œ Runtimeì—ì„œëŠ” ëª¨ë˜ JavaScript ì•± ê°œë°œì‹œ ë¹ˆë²ˆí•˜ê²Œ ì‚¬ìš©ë˜ëŠ” í•„ìš”í•œ ê¸°ëŠ¥ (ì˜ˆ: Transpiler, Package manager, Bundler, Test Runner ê¸°ëŠ¥ë“±)ì„ Core ê¸°ëŠ¥ìœ¼ë¡œ í¬í•¨ì‹œì¼œ DXë¥¼ í–¥ìƒì‹œí‚¤ê³  ìˆë‹¤. ê³µí†µì ì¸ íŠ¹ì§•ì€ ê° Runtimeì˜ Core APIì˜ ë””ìì¸ì„ Web Platform APIì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ì˜€ë‹¤ê³ , ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì œê³µí•˜ë©´ì„œ ë§ì€ Ecoë¥¼ í™•ë³´í•˜ê³  ìˆëŠ” Node.js Core APIì˜ í˜¸í™˜ì„±ì„ ë³´ì™„í•œë‹¤ëŠ” ì ì´ë‹¤. ê·¸ë¦¬ê³ , Node.js ë˜í•œ ì´ëŸ¬í•œ ì‹ ê·œ Runtimeì˜ ì˜í–¥ìœ¼ë¡œ ë³´ì•ˆ, ì„±ëŠ¥, DX í–¥ìƒë“±ì— ì ì§„ì ìœ¼ë¡œ ë³´ì™„í•´ê°€ëŠ” ì¤‘ì´ë‹¤. Denoland - Deno (https://deno.com/) V8 ì—”ì§„ ê¸°ë°˜, Rustë¡œ Core ì‘ì„±, TypeScript ì§€ì›, Web Platform API í˜¸í™˜ì„± ì œê³µ FileSystem, Network, Script Execution ë“±ì— ëŒ€í•œ Permissions Model ì œê³µ NPMê³¼ ê°™ì€ ì¤‘ì•™ì§‘ì¤‘í˜• ëª¨ë“ˆ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ Oven - Bun (https://bun.sh/) JavaScriptCore ì—”ì§„, Zig ì–¸ì–´ë¡œ Core ì‘ì„±, TypeScript ì§€ì›, Web Platform API í˜¸í™˜ì„± ì œê³µ Cold Start ì‹œê°„, Network&#x2F;DB Request ì²˜ë¦¬ ì‹œê°„ ë“± ì„±ëŠ¥ì— ìµœì í™” FFI(foreign function interface) ê¸°ëŠ¥, ë‚´ì¥ SQLite3 ì§€ì› All-in-one DX ì œê³µ (Package Manager, Bundler, Test Runnerë“±ì´ Runtimeì— í¬í•¨ë¨) Cloudflare - Workerd (https://github.com/cloudflare/workerd) V8 ì—”ì§„ ê¸°ë°˜, Webassembly, Web Platform API í˜¸í™˜ì„± ì œê³µ ì œê³µ V8 Isolation ê¸°ëŠ¥ì„ ì´ìš©í•œ ìƒŒë“œë°•ì‹± í™˜ê²½ì„ ì œê³µì´ íŠ¹ì§• - í•˜ë‚˜ì˜ Runtimeì—ì„œ ì—¬ëŸ¬ê°œì˜ Appì„ ìˆ˜í–‰í•  ìˆ˜ìˆëŠ” ë…ë¦½ì  ê³µê°„ì„ ì œê³µ VM ë˜ëŠ” Container ëŒ€ë¹„ ì‚¬ìš© Cold Start ì‹œê°„, CPU ì‚¬ìš©ì‹œê°„ ë° ì‚¬ìš© ë©”ëª¨ë¦¬ ì ˆê° ê·¸ ë°–ì˜ Server&#x2F;Edge JavaScript Runtime Alibaba Cloud - EdgeRoutine Vercel - Edge Runtime Fastly - Compute@Edge Lagon - Lagon Runtime JavaScript Runtime ê°„ ìƒí˜¸ ìš´ìš©ì„± Node.jsë¡œ ì‹œì‘ëœ Server&#x2F;Edge í–¥ Runtimeì´ ë‹¤ì–‘í•œ í˜•íƒœë¡œ íŒŒí¸í™” ë˜ë©´ì„œ ê°œë°œìëŠ” Unified Appì„ ê°œë°œì´ ì–´ë ¤ì›Œì¡Œë‹¤. ì´ë¡œ ì¸í•´ ì—¬ëŸ¬ Runtime êµ¬ë¶„ì—†ì´ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” API ì œê³µì— ëŒ€í•œ í•„ìš”ì„±ì´ ì œê¸°ë˜ì—ˆë‹¤. ì´ì‹ì„± ë†’ì€ ì½”ë“œë¥¼ ì‘ì„±ì— ëŒ€í•œ ê° ì„œë²„ìª½ JS Runtimeì˜ ì‚¬ìš©ì í”¼ë“œë°±ì— ë”°ë¥´ë©´ ê³µí†µ APIì— ë””ìì¸ì— ëŒ€í•´ Web-first ì ‘ê·¼ë²•ì´ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤ëŠ” ê²°ê³¼ê°€ ìˆì—ˆë‹¤. Web í”Œë«í¼ì´ë€ ê°€ì¥ í¬ê³  ì¤‘ìš”í•œ APIì™€ ì§€ì‹ì— ë°”íƒ•ì„ ë‘ë©´ íŠ¹ì • í”Œë«í¼ì´ë‚˜ Runtimeë³„ ìƒˆë¡œìš´ APIë‚˜ ê¸°ëŠ¥ì„ ë°°ìš°ì§€ ì•Šê³  ë³´ë‹¤ ë³´í¸ì ìœ¼ë¡œ í†µìš©ë˜ëŠ” APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  íŒë‹¨ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤. í•œí¸, Web Platform APIê°€ ë¸Œë¼ìš°ì €ì˜ íŠ¹ì • ìš”êµ¬ì‚¬í•­ë§Œì„ ê³ ë ¤í•´ ì„¤ê³„ë˜ì–´ìˆì–´ ë¸Œë¼ìš°ì €ê°€ ì•„ë‹Œ í™˜ê²½ì— ì‰½ê²Œ ìµœì í™”ê°€ ì–´ë µê±°ë‚˜ ë™ì‘ì´ ë¯¸ì„¸í•˜ê²Œ ë‹¤ë¥¸ ì ì´ ìˆì—ˆë‹¤. ì´ëŸ¬í•œ ì°¨ì´ë“¤ì´ ë°œê²¬ë¨ì— ë”°ë¼ ì¼ê´€ì„±ìˆëŠ” API ë¥¼ ë™ì‘ì„ êµ¬í˜„í•˜ê¸° ì–´ë µê²Œ ë˜ì—ˆë‹¤. ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, Node.js, Deno, Cloudflare, Vercel, Shopifyë“±ì—ì„œ í™œë™í•˜ëŠ” ì—”ì§€ë‹ˆì–´ ì£¼ì¶•ìœ¼ë¡œ 2022ë…„ Web-interoperable Runtimes Community Group (WinterCG) ê°€ ì¡°ì§ë˜ì—ˆë‹¤. ë¸Œë¼ìš°ì €ë¥¼ í¬í•¨í•œ JavaScript Runtimeì˜ êµ¬í˜„ì´ ì–´ë–»ê²Œ ë‹¤ë¥´ë©° ìƒí˜¸ ìš´ì˜ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ë¶€ë¶„ì„ í† ë¡ í•˜ê³  WHATWG, W3Cì— í•„ìš”í•œ ë¶€ë¶„ì„ ì œì•ˆí•˜ê³  ìˆë‹¤. í˜„ì¬ JavaScript ëŸ°íƒ€ì„ í™˜ê²½ì—ì„œ ì§€ì›ì„ ê¶Œì¥í•˜ëŠ” ìµœì†Œ API ì§‘í•©ì´ ì œì•ˆë˜ì–´ ìˆë‹¤. WinterCGì— ìˆœì‘í•œ JavaScriptë¥¼ ë§Œë“¤ì‹œ, ì´ëŸ¬í•œ Web Platform API ê¸°ë°˜ìœ¼ë¡œ Appì„ êµ¬ì„±í•˜ë©´ ë¸Œë¼ìš°ì €, Server, Edgeí™˜ê²½ì˜ êµ¬ë³„ì—†ì´ JavaScript ëŸ°íƒ€ì„ ê°„ Portabilityë¥¼ ë³´ì¥ë°›ê²Œ ëœë‹¤. InsightNode.jsì˜ ì„±ìˆ™ë„ì™€ ìƒíƒœê³„ ê·œëª¨ëŠ” ì—¬ì „íˆ í° ì¥ì ì´ë‹¤. ê·¸ëŸ¬ë‚˜, Node.jsê°€ JavaScriptë¥¼ ë¸Œë¼ìš°ì € ì™¸ë¶€ë¡œ ê°€ì ¸ì˜¨ ê²ƒê³¼ ê°™ì´, ëª¨ë˜ ì›¹ ê¸°ìˆ ì„ Server ë˜ëŠ” Edge ê¸°ê¸° í–¥ JavaScript ëŸ°íƒ€ì„ì— ì´ì‹í•´ ìƒíƒœê³„ë¥¼ êµ¬ì¶•í•˜ë ¤ëŠ” ë™í–¥ì´ ìˆë‹¤. ì´ëŸ¬í•œ íë¦„ì„ ë°˜ì˜í•´ ê°œë°œìë¥¼ ì§€ì›í•˜ê³  ê¸°ê¸°ì— ìµœì í™”ëœ JavaScript ëŸ°íƒ€ì„ ì œê³µì„ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"structuredClone in native","slug":"article-2023-10-28-structure-clone-native","date":"2023-10-27T15:13:00.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-10-28-structure-clone-native/","link":"","permalink":"https://llnm.github.io/article/2023-10-28-structure-clone-native/","excerpt":"","text":"structuredCloneì€ ê°ì²´ë¥¼ deep copy í•˜ëŠ” API ì´ë‹¤. ë§Œì•½ structuredClone ê°€ Node.jsì˜ JavaScript ì˜ì—­ì— êµ¬í˜„ë˜ì–´ìˆë‹¤ë©´ Native ì˜ì—­ìœ¼ë¡œ êµ¬í˜„ë¶€ë¥¼ ì´ë™ì‹œí‚¬ë•Œ ìœ ì˜ë¯¸í•œ ì„±ëŠ¥í–¥ìƒì´ ìˆì„ ê²ƒì´ë‹¤. src: implement structuredClone ì€ ê·¸ëŸ°ë©´ì—ì„œ í¥ë¯¸ë¡œìš´ ë‚´ìš©ì¼ ê²ƒì´ë¼ ìƒê°í•˜ê³  ë¦¬ë·°í•´ë³´ì•˜ë‹¤. ê¸°ì¡´ êµ¬í˜„Web Platform APIì¸ structuredCloneì€ ì›ë˜ global ì˜ì—­ì— ë…¸ì¶œë˜ì–´ìˆì§€ ì•Šì€ APIì˜€ë‹¤. Deep Copyë¥¼ JavaScript ì—ì„œ ì œê³µí•˜ì§€ ì•Šì§€ë§Œ, Web Spec. ì¸ MessageChannel ì´ë‚˜ IndexedDB ê°™ì€ ê¸°ëŠ¥ì„ ìœ„í•´ì„  Objectì˜ ì§ë ¬í™”&#x2F;ì—­ì§ë ¬í™” ê¸°ëŠ¥ì€ í•„ìš”í•  ìˆ˜ ë°–ì— ì—†ì—ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ Web Workerì—ì„œ í•œ Threadì—ì„œ ë‹¤ë¥¸ Threadë¡œ ì „ë‹¬í•˜ëŠ” ê²ƒì€ ì„œë¡œ ë‹¤ë¥¸ JavaScript Contextë¡œ ë°ì´í„°ë¥¼ ë„˜ê¸°ëŠ” ì¼ì´ê¸° ë•Œë¬¸ì— Deep Copy ê¸°ëŠ¥ì´ í•„ìš”í•˜ë‹¤. Node.js ì—ëŠ” structuredClone API ì•ì„œ MessageChannelì´ êµ¬í˜„ë˜ì–´ ìˆì—ˆëŠ”ë° ì´ë¥¼ í™œìš©í•œ hack ì„ ì´ìš©í•˜ë©´ structuredCloneì˜ ê²°ê³¼ì™€ ê°™ì€ Deep Copyë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆë‹¤. ê·¸ë˜ì„œ ê¸°ì¡´ì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆì—ˆë‹¤. structured_clone.jslink13141516171819202122232425function structuredClone(value, options = undefined) &#123; if (arguments.length === 0) &#123; throw new ERR_MISSING_ARGS(&#x27;value&#x27;); &#125; // TODO: Improve this with a more efficient solution that avoids // instantiating a MessageChannel channel ??= new MessageChannel(); channel.port1.unref(); channel.port2.unref(); channel.port1.postMessage(value, options?.transfer); return receiveMessageOnPort(channel.port2).message;&#125; ì•„ì´ë””ì–´ëŠ” MessageChannelì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  í•´ë‹¹ channelë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•¨ìœ¼ë¡œì„œ ê·¸ ê³¼ì •ì—ì„œ ìˆ˜í–‰ë˜ëŠ” structuredCloned ì„ ì´ìš©í•˜ëŠ” ê²ƒì´ë‹¤. MessageChannel ë‚´ë¶€MessageChannel::postMessage(value[,&#123; transfer &#125;]) ë‚´ë¶€ êµ¬í˜„ì—ì„œ structuredCloneì˜ êµ¬í˜„ì€ ì•„ë˜ì™€ ê°™ì€ ë‘ê°œì˜ Stepì„ í†µí•´ êµ¬í˜„ëœë‹¤. Step 1. clone í•˜ê±°ë‚˜ transfer í•´ì•¼í•  ê°ì²´ë¥¼ ë¦¬ìŠ¤íŠ¸ì—… í•œë‹¤. Step 2. ì§ë ¬í™”&#x2F;ì—­ì§ë ¬í™” ê³¼ì •ì„ ìˆ˜í–‰í•œë‹¤. ê¸°ì¡´ êµ¬í˜„ì˜ TODOë¡œ ê¸°ìˆ ë˜ì–´ìˆë“¯ì´ ì› ì €ì ì—­ì‹œ structuredCloneì„ ìœ„í•´ MessageChannelì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê·¸ë ‡ê²Œ íš¨ìœ¨ì ì¸ ë°©ë²•ì€ ì•„ë‹ˆë¼ëŠ” ê²ƒì„ ê¸°ìˆ í•´ ë‘ì—ˆë‹¤. PR AuthorëŠ” MessageChannel::postMessage()ì—ì„œ ìƒê¸° Step 1 ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ë¶€ë¶„ì„ ì§ì ‘ JavaScript ì˜ì—­ì—ì„œ í˜¸ì¶œí•˜ë©´ MessageChannelì„ ì´ìš©í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì„ ê²ƒì´ë¼ ìƒê°í–ˆë‹¤. í˜„ì¬ ì½”ë“œ ìƒì—ì„œ í° ë¦¬íŒ©í† ë§ì„ ìš°ë ¤í–ˆì§€ë§Œ ìƒê°ë³´ë‹¤ëŠ” ì ì€ ìˆ˜ê³ ë¡œ ê°€ëŠ¥í•œ ë‚´ìš©ì´ì—ˆë‹¤. As-Is: structuredClone (JS) ... (1) new MessageChannel MessageChannel::postMessage (C++) ... (2) MessageChannel êµ¬í˜„ Step 1 Step 2 ... (3) ìœ„ëŠ” ê¸°ì¡´ êµ¬í˜„ë¶€ë¥¼ ë‹¨ìˆœí™”í•œ ë‚´ìš©ì´ë‹¤. PRì˜ ì•„ì´ë””ì–´ëŠ” MessageChannel ì™€ ê´€ë ¨ëœ ìœ„ì˜ (1), (2), (3) í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ ì œê±°í•œë‹¤. Step 1ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ MessageChannel ì™€ ê³µìœ í•˜ê³  Step 2 êµ¬í˜„ì„ êµ¬í˜„í•˜ì—¬ structuredCloneì˜ êµ¬í˜„ì²´ë¥¼ ë‹¨ìˆœí™” ì‹œí‚¤ëŠ” ë‚´ìš©ì´ë‹¤. Step 1transferë¥¼ í•´ì•¼í•  ê°ì²´ì˜ ë¦¬ìŠ¤íŠ¸ì—…ì„ ë‹¤ìŒ í•¨ìˆ˜ GetTransferListë¡œ ë¶„ë¦¬í•œ ë’¤ ìƒˆë¡œ native sideì—ì„œ êµ¬í˜„í•œ structuredCloneê³¼ ê¸°ì¡´ MessageChannel::postMessage()ì—ì„œ ê³µë™ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤. 123456bool GetTransferList(Environment* env, Local&lt;Context&gt; context, Local&lt;Value&gt; transfer_list_v, TransferList* transfer_list_out) &#123; ... &#125; Step 2ì´í›„ ì§ë ¬í™”&#x2F;ì—­ì§ë ¬í™”ë¥¼ ìˆ˜í–‰í•´ cloneì„ ìˆ˜í–‰í•œë‹¤. To-Be: structuredClone (JS) internalBinding(&#39;messaging&#39;).structuredClone (C++) Step 1 Step 2 123456789101112131415Local&lt;Value&gt; value = args[0];TransferList transfer_list;...// step 1GetTransferList(env, context, transfer_list_v, &amp;transfer_list)...// step 2Local&lt;Value&gt; result;if (msg-&gt;Serialize(env, context, value, transfer_list, Local&lt;Object&gt;()) .IsNothing() || !msg-&gt;Deserialize(env, context, nullptr).ToLocal(&amp;result)) &#123; return;&#125; Step 3ì§ë ¬í™”&#x2F;ì—­ì§ˆí™” ì˜ ë‚´ë¶€ ì•Œê³ ë¦¬ì¦˜ì€ V8 ë‚´ë¶€ì—ì„œ ìˆ˜í–‰í•˜ë©°, src/node_messaging.cc ì—ëŠ” Node.jsì—ì„œ ì •ì˜í•œ ê°ì²´ì— ëŒ€í•œ clonningì„ ì–´ë–»ê²Œ í• ì§€ê°€ ì •ì˜ë˜ì–´ ìˆë‹¤. ì„±ëŠ¥ì˜ í–¥ìƒ?ì´ PRì˜ ì œëª©ë§Œ ë³´ë©´ JavaScript sideì—ì„œ ìˆ˜í–‰í•˜ëŠ” Cloningì„ native sideë¡œ ì´ë™ì‹œí‚¤ë©´ì„œ ìƒë‹¹í•œ ì„±ëŠ¥ì˜ í–¥ìƒì´ ìˆì„ ê²ƒì´ë€ ìƒê°ì´ ë“¤ì—ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì‹¤ì œë¡œëŠ” MessageChannelì˜ instance ë¥¼ ìƒì„±í•˜ëŠ” ë¶€í•˜ë§Œ ì¤„ì´ëŠ” ê²ƒì´ë©° ì‹¤ì œë¡œ Cloningë˜ëŠ” ë©”ì¹´ë‹ˆì¦˜ì€ ê·¸ëŒ€ë¡œì´ë‹¤. ê·¸ë˜ì„œ structuredClone ìì²´ì˜ ì„±ëŠ¥ì€ ë” ê°œì„ í•  ë‚´ìš©ì´ ìˆëŠ” ê²ƒì´ë‹¤. GetTransferList ì•ˆì€ ReadIterableì´ êµ¬í˜„ë˜ì–´ìˆìœ¼ë©° transfer ëª©ë¡ì„ ìˆœíšŒí•˜ê¸° ìœ„í•´ iteratorë¥¼ í˜¸ì¶œí•œë‹¤. ì´ ê³¼ì •ì—ì„œ JavaScript Sideì™€ Native Sideê°„ Context Switching ì´ ì¼ì–´ë‚˜ ì†ë„ê°€ ì €í•˜ëœë‹¤. ì´ ë¶€ë¶„ì€ ì—¬ì „íˆ TODOë¡œ ë‚¨ê²¨ì¡Œë‹¤. 123456789101112131415161718192021static Maybe&lt;bool&gt; ReadIterable(Environment* env, Local&lt;Context&gt; context, // NOLINTNEXTLINE(runtime/references) TransferList&amp; transfer_list, Local&lt;Value&gt; object) &#123; if (!object-&gt;IsObject()) return Just(false); .... std::vector&lt;Local&lt;Value&gt;&gt; entries; while (env-&gt;can_call_into_js()) &#123; Local&lt;Value&gt; result; // ì´ê³³ì˜ while ë¬¸ì—ì„œ C++ -&gt; JavaScript í˜¸ì¶œì´ ë˜ë©° ì„±ëŠ¥ ì €í•˜ê°€ ì¼ì–´ë‚œë‹¤. if (!next.As&lt;Function&gt;()-&gt;Call(context, iterator, 0, nullptr) .ToLocal(&amp;result)) return Nothing&lt;bool&gt;(); transfer_list.AllocateSufficientStorage(entries.size()); std::copy(entries.begin(), entries.end(), &amp;transfer_list[0]); return Just(true);&#125; ê²°ê³¼structuredCloneì„ ìœ„í•´ MessageChannel instanceê°€ ìƒì„±ë˜ëŠ” ì‹œê°„ì„ ì¤„ì´ê³  ê¸°ì¡´ì— JavaScript sideì—ì„œ êµ¬í˜„ë˜ì–´ snapshotì— í¬í•¨ë˜ì§€ ëª»í–ˆë˜ structuredClone ê¸°ëŠ¥ì„ snapshotì— í¬í•¨í•  ìˆ˜ ìˆì—ˆë˜ ê²ƒì´ í•´ë‹¹ PRì˜ ì˜ë¯¸ë¼ê³  í•  ìˆ˜ ìˆë‹¤. 12// snapshot ìƒì„±ì‹œ í¬í•¨ë˜ë„ë¡ ë“±ë¡registry-&gt;Register(StructuredClone); í•œê°€ì§€ ì˜ë¬¸ì€ Web Spec.ì— ì˜í•˜ë©´ trasfer ëŠ” An array of transferable objects that will be moved rather than cloned to the returned object. ì´ë¼ê³  ì •ì˜ ë˜ì–´ìˆëŠ”ë° ì™œ iterableë¡œì„œ ìˆœíšŒí•´ì•¼í•˜ëŠ”ì§€ëŠ” ì˜ë¬¸ì´ë‹¤. Array ê°ì²´ë¡œì„œ ìˆœíšŒí•˜ëŠ” ê²ƒì€ V8 APIë¡œ ì¡´ì¬í•˜ê³  ìˆê¸° ë•Œë¬¸ì— iteratable interfaceì— ë”°ë¼ next() í˜¸ì¶œì„ í•´ì£¼ì§€ ì•Šì•„ë„ êµ¬í˜„ì´ ê°€ëŠ¥í•  ê²ƒ ê°™ì€ë° ë§ì´ë‹¤. ì•„ë¬´íŠ¼, iterableë¡œ ì²˜ë¦¬ë˜ì•¼í•œë‹¤ë©´ ìƒê¸° ì–¸ê¸‰í–ˆë˜ Step 1ë¥¼ JavaScript ìª½ì—ì„œ ëª©ë¡ì„ ë§Œë“¤ê³  C++ ë¡œ ë„˜ê¸¸ ìˆ˜ ìˆìœ¼ë©´ TODOë¡œ ë‚¨ê²¨ì§„ ì„±ëŠ¥ ì €í•˜ë¥¼ ê°œì„  í•  ìˆ˜ ìˆì„ ê²ƒì´ë¼ ìƒê°ëœë‹¤. ê´€ë ¨ ì»¨í…ì¸  Iteration protocols structureClone ì°¸ê³  https://github.com/nodejs/node/pull/50330","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"structureClone","slug":"article-2023-10-14-structure-clone","date":"2023-10-13T07:43:45.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-10-14-structure-clone/","link":"","permalink":"https://llnm.github.io/article/2023-10-14-structure-clone/","excerpt":"","text":"JavaScriptì—ì„œ ê°’ì„ ë³µì‚¬í• ë•ŒëŠ” í•­ìƒ ì–•ì€ ë³µì‚¬ (shallow copy)ë¥¼ ìˆ˜í–‰í•œë‹¤. ë”°ë¼ì„œ primitive data type (string, number, bigint, boolean, undefined, symbolë“±) ì´ ì•„ë‹Œ ê²½ìš° ê°ì²´ì˜ ì°¸ì¡°ë¡œ ì²˜ë¦¬ëœë‹¤. ì–•ì€ ë³µì‚¬ì˜ ë°˜ëŒ€ëŠ” ê¹Šì€ ë³µì‚¬ (deep copy)ì¸ë°, ì´ëŠ” ë³µì‚¬ ì¤‘ ë‹¤ë¥¸ ê°ì²´ë¥¼ ì°¸ì¡°ë¥¼ ì°¾ìœ¼ë©´ ì¬ê·€ì ìœ¼ë¡œ ì°¸ì¡°ì˜ ë‚´ìš©ë„ ì°¾ì•„ ë³µì‚¬ë¥¼ ìˆ˜í–‰í•œë‹¤. ì´ë ‡ê²Œ ì°¸ì¡°ê°€ ìˆëŠ” í•œ ê°ì²´ë¥¼ ê¹Šì€ ë³µì‚¬í•˜ëŠ” ê²ƒì€ ê½¤ ê¹Œë‹¤ë¡œìš´ ì¼ì´ë‹¤. ê²°ê³¼ë¬¼ì¸ ë³µì‚¬ëœ ê°ì²´ì—ì„œ ì›ë³¸ì´ ê°€ë¥´í‚¤ëŠ” ì–´ë–¤ ì°¸ì¡°ë„ ì¤‘ì²©í•˜ì—¬ ê°–ê²Œí•´ì„œëŠ” ì•ˆë˜ê¸° ë•Œë¬¸ì´ë‹¤. JavaScriptì—ì„œëŠ” ì´ëŸ¬í•œ ê¹Šì€ ë³µì‚¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ì œê³µë˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë˜ì„œ, ì˜¤ëœë™ì•ˆ JSON.stringify/parse ë¥¼ ì´ìš©í•œ ì¼ì¢…ì˜ íŠ¸ë¦­ì„ ì´ìš©í•œ ê¹Šì€ ë³µì‚¬ ë°©ë²•ì„ ì œê³µí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜ì¡´í•´ì™”ë‹¤. ê·¸ëŸ¬ë‚˜ Web Platformì—ì„œëŠ” IndexedDB ì €ì¥ì´ë‚˜, WebWorkerê°„ MessageChannel ë©”ì„¸ì§€ ì „ì†¡ë“±ì˜ Spec.ì„ êµ¬í˜„í•˜ê³ ì í• ë•Œ JavaScript ì§ë ¬í™”&#x2F;ì—­ì§ë ¬í™” ë°©ë²•ì´ í•„ìš”í•˜ì˜€ë‹¤. ì´ë¥¼ êµ¬í˜„í•œ ê²ƒì´ structuredCloneì´ë©°, í•¨ìˆ˜ ë‚´ë¶€ì ìœ¼ë¡œ ë³µì‚¬ë¥¼ ì–´ë–»ê²Œ ìˆ˜í–‰í•˜ëŠ”ì§€ëŠ” structured clone algorithmì´ë¼ê³  ë¶€ë¥´ëŠ” Spec.ì— ì˜í•´ ì •ì˜ë˜ì–´ìˆë‹¤. ëª¨ë“  íƒ€ì…ì˜ JavaScript ê°ì²´ê°€ ì´ ì•Œê³ ë¦¬ì¦˜ì— ì˜í•´ ì²˜ë¦¬ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë©°, JavaScript ì˜ Builtin Typeë¿ ì•„ë‹ˆë¼ Web Spec. ì •ì˜ëœ ì¼ë¶€ ê°ì²´ë“¤ë„ ë³µì‚¬ê°€ ê°€ëŠ¥í•˜ë„ë¡ ë˜ì–´ìˆë‹¤. APIAPIì˜ ì‚¬ìš© ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ì€ë°, ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°ê°€ ì •ì˜ë˜ì—ˆì„ ë•Œì˜ ë™ì‘ì´ ëˆˆì—¬ê²¨ ë³¼ë§Œí•˜ë‹¤. 12structuredClone(value);structuredClone(value, options); ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” structured clone algorithmì´ ì§€ì›í•˜ëŠ” íƒ€ì…ì˜ ë³µì‚¬ë³¸ì„ ë§Œë“ ë‹¤. 2ë²ˆì§¸ íŒŒë¼ë¯¸í„° optional í•œ option ê°’ì¸ë° í˜„ì¬ options.transfer : Array ë¥¼ ì§€ì›í•œë‹¤. ì´ ì˜µì…˜ì„ í†µí•´ ì „ë‹¬ë˜ëŠ” ê°’ì€ Transferable objectsì˜ ë°°ì—´ì´ ê°€ëŠ¥í•˜ë©°, Transferable objectsì˜ ëŒ€í‘œì ì¸ íƒ€ì…ìœ¼ë¡œëŠ” ArrayBuffer, Readable&#x2F;WritableStreamë“±ì´ ìˆë‹¤. ë³µì‚¬ê°€ ì•„ë‹Œ transferë¥¼ ì´ìš©í•  ë•Œì˜ ì¥ì ì€ ë‘ê°€ì§€ë¥¼ ë“¤ ìˆ˜ ìˆë‹¤. ì†Œìœ ê¶Œì˜ ì´ì „ - transfer ë˜ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ í•˜ë‚˜ì˜ JavaScript Contextì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì†Œìœ ê¶Œì„ ì œí•œí•  ìˆ˜ ìˆë‹¤. ì„±ëŠ¥ - transfer ê°ì²´ì™€ í™˜ê²½ì— ë”°ë¼ zero-copy operationì„ ì´ìš©í•˜ì—¬ ë¹ ë¥´ê²Œ ë‹¤ë¥¸ contextë¡œ ë„˜ê¸¸ ìˆ˜ ìˆë‹¤. ì´ëŠ” íŠ¹íˆ WebWorkerì™€ ê°™ì´ í•œ threadì—ì„œ ë‹¤ë¥¸ threadë¡œ ë°ì´í„°ë¥¼ ë„˜ê¸¸ë•Œ ìœ ìš©í•˜ë‹¤. 12345678const buffer1 = new ArrayBuffer(16);const object1 = &#123; buffer: buffer1,&#125;;const object2 = structuredClone(object1, &#123; transfer: [buffer1] &#125;);// Creating an array from the original buffer throws a TypeErrorconst int32View1 = new Int32Array(object1.buffer); 1234const object1 = &#123; amanita: [&#x27;muscaria&#x27;, &#x27;virosa&#x27;],&#125;;const object2 = structuredClone(object1); // cloned ì°¸ê³  https://www.proposals.es/proposals/Structured%20Clone https://developer.mozilla.org/en-US/docs/Web/API/structuredClone","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"Iteration protocols","slug":"article-2023-10-11-iteration-protocols","date":"2023-10-10T10:47:12.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-10-11-iteration-protocols/","link":"","permalink":"https://llnm.github.io/article/2023-10-11-iteration-protocols/","excerpt":"","text":"ì–´ë–¤ ê°ì²´ê°€ String, Array ê°™ì´ ìˆœíšŒ (iteration) í•  ìˆ˜ ìˆëŠ” íƒ€ì…ì´ ì•„ë‹ˆë”ë¼ë„, JavaScriptì—ì„œ ìˆœíšŒê°€ ê°€ëŠ¥í•œ (iterable) ê°ì²´ë¡œ ë§Œë“œëŠ” ë°©ë²•ì´ ìˆë‹¤. ì´ë¥¼ Iteration protocol ì´ë¼í•˜ë©° interable, iterator ë¥¼ ë§Œë“œëŠ” 2ê°œì˜ ê·œì¹™(protocol) ì„ ê¸°ìˆ í•˜ê³  ìˆë‹¤. iterable ê·œì•½ì— ìˆœì‘í•˜ëŠ” ê°ì²´ëŠ” for...of syntax, Spread syntax, destructuring syntax ë“±ì—ì„œ ì‚¬ìš©ì´ ê°€ëŠ¥í•´ì§„ë‹¤. 1. iterable ì •ì˜iterableë¡œ ì •ì˜í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ ë‚´ìš©ì„ ê°ì²´ ë˜ëŠ” prototype chainë‚´ ê°ì²´ì—ì„œ ì•„ë˜ ë‚´ìš©ì„ êµ¬í˜„í•˜ì—¬ì•¼ í•œë‹¤. [Symbol.iterator] (í˜¹ì€ @@iterator) ë€ Propertyë¡œ ë©”ì†Œë“œë¥¼ êµ¬í˜„í•´ì•¼í•œë‹¤. í•´ë‹¹ ë©”ì„œë“œëŠ” iterator ê°ì²´ë¥¼ ë°˜í™˜í•˜ì—¬ì•¼ í•œë‹¤. 2. iterator ì •ì˜iterable ì—ì„œ [Symbol.iterator] í˜¸ì¶œì— ì˜í•´ ë°˜í™˜ë˜ëŠ” iterator ìˆœíšŒí•  ë•Œ ë§ˆë‹¤ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤. ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•´ iteratorì€ ì•„ë˜ì˜ í”„ë¡œí¼í‹°ë¥¼ êµ¬í˜„í•œë‹¤. next ë€ ì´ë¦„ì˜ ë©”ì†Œë“œ êµ¬í˜„ (í•„ìˆ˜) next ë©”ì†Œë“œëŠ” 1ê°œ í˜¹ì€ 0ê°œì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬ ë°›ì„ ìˆ˜ ìˆìœ¼ë©°, IteratorResult ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¤€ìˆ˜í•˜ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. ë°˜í™˜ê°’ì´ undefinedì˜ ê²½ìš° &#123; done: false, value: undefined&#125; ì™€ ë™ì¼ return(value), throw(exception) ë©”ì†Œë“œ êµ¬í˜„ (ì˜µì…˜) return() : IteratorResult ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¤€ìˆ˜í•˜ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. ì´í›„ next ë©”ì†Œë“œëŠ” ë” í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤. throw() IteratorResult ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¤€ìˆ˜í•˜ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. í•„ìš”í•œ ê²½ìš° ì´ ë©”ì†Œë“œë¥´ í˜¸ì¶œí•˜ì—¬ iteratorì—ê²Œ ì˜¤ë¥˜ê°€ ê°ì§€ë˜ì—ˆìŒì„ ì•Œë¦°ë‹¤. 2.1 IteratorResult Interface done : true&#x2F;falseë¡œ ë°˜ë³µì´ ëë‚¬ëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ëë‚¬ìœ¼ë©´ trueë¡œ ì„¤ì • value : í˜„ì¬ ë°˜í™˜ë˜ëŠ” ê°’ì„ ì„¤ì • ì˜ˆì‹œiterable êµ¬í˜„ ì¼ë°˜1234567891011let i = 0;const iterable = &#123; [Symbol.iterator]() &#123; return this; &#125;, // i next() &#123; return i &gt; 3 ? &#123; done: true &#125; : &#123; value: i++, done: false &#125;; &#125;,&#125;;for (let n of iterable) console.log(n); // 0, 1, 2, 3 iterable ì˜ return() êµ¬í˜„1234567891011121314151617181920212223242526272829const customIterator = &#123; currentIndex: 0, [Symbol.iterator]() &#123; return this; &#125;, next() &#123; this.currentIndex++; if (this.currentIndex &lt;= 5) &#123; return &#123; done: false, value: this.currentIndex &#125;; &#125; else &#123; return &#123; done: true &#125;; &#125; &#125;, return() &#123; console.log(&#x27;Closing the iterator.&#x27;); // ì—¬ê¸°ì„œ ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ë˜ëŠ” ë§ˆë¬´ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰ return &#123; done: true &#125;; &#125;,&#125;;for (const num of customIterator) &#123; console.log(num); if (num === 3) &#123; break; // ì´í„°ë ˆì´ì…˜ì„ ì¤‘ë‹¨. ì´ë•Œ return() ë©”ì„œë“œê°€ í˜¸ì¶œë˜ê³  ì´í„°ë ˆì´ì…˜ì„ ì¢…ë£Œ &#125;&#125; Node.js ì˜ /lib/events.js ì—ì„œ êµ¬í˜„ (ì‹¤ í™œìš© ì˜ˆì œ)iteratorì˜ return() í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ í•´ì œí•˜ëŠ”ë° ì‚¬ìš©í•œë‹¤. events.jslink110311041105return() &#123; return closeHandler();&#125;, iteration ë„ì¤‘ ì˜¤ë¥˜ë¥¼ í•¸ë“¤ë§í•˜ê¸° ìœ„í•´ throw(err) í•¨ìˆ˜ë¥¼ ì •ì˜í•œë‹¤. events.jslink1107110811091110111111121113throw(err) &#123; if (!err || !(err instanceof Error)) &#123; throw new ERR_INVALID_ARG_TYPE(&#x27;EventEmitter.AsyncIterator&#x27;, &#x27;Error&#x27;, err); &#125; errorHandler(err);&#125;, iterationì„ ìœ„í•œ next() í˜¸ì¶œì´ ë ë•Œ IteratorResult í˜•ì‹ìœ¼ë¡œ í˜„ì¬ ê°’ì„ ë°˜í™˜í•œë‹¤. events.jslink1071107210731074107510761077107810791080108110821083const iterator = ObjectSetPrototypeOf(&#123; next() &#123; // First, we consume all unread events if (size) &#123; const value = unconsumedEvents.shift(); size--; if (paused &amp;&amp; size &lt; lowWatermark) &#123; emitter.resume(); paused = false; &#125; return PromiseResolve(createIterResult(value, false)); &#125; next() í˜¸ì¶œì— ëŒ€í•´ undefinedë¥¼ ë°˜í™˜í•¨ìœ¼ë¡œì¨ iterationì´ ì¢…ë£Œë˜ì—ˆìŒì„ ì•Œë¦°ë‹¤. events.jslink109410951096// If the iterator is finished, resolve to doneif (finished) return closeHandler(); ì¶œì²˜ https://tc39.es/ecma262/multipage/control-abstraction-objects.html#sec-iteration https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#the_iterator_protocol","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"ìë°”ìŠ¤í¬ë¦½íŠ¸ ì»¨í…Œì´ë„ˆ","slug":"article-2023-09-12-js-container","date":"2023-09-11T15:00:00.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-09-12-js-container/","link":"","permalink":"https://llnm.github.io/article/2023-09-12-js-container/","excerpt":"","text":"ì»¨í…Œì´ë„ˆëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ê³¼ ê·¸ ì‹¤í–‰ í™˜ê²½ì„ íŒ¨í‚¤ì§•í•˜ê³  ê²©ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ê¸°ìˆ ì´ë‹¤. ë°°í¬ë˜ëŠ” ì„œë¹„ìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ì˜ ìš´ì˜ì²´ì œ ìˆ˜ì¤€ì„ ê°€ìƒí™”í•˜ê³ , ì‘ìš© í”„ë¡œê·¸ë¨ ë° ì‹œìŠ¤í…œ ì¢…ì†ì„±ì„ í¬í•¨í•œ ëª¨ë“  ê²ƒì´ í¬í•¨ëœ ë…ë¦½ì ì¸ í™˜ê²½ì„ ì œê³µí•œë‹¤. ì´ëŸ° ë¦¬ëˆ…ìŠ¤ ì»¨í…Œì´ë„ˆë³´ë‹¤ëŠ” ì¢€ ë” ë†’ì€ ì¶”ìƒí™” ë ˆë²¨ì´ê¸´ í•˜ì§€ë§Œ ìœ ì‚¬í•œ í˜•íƒœì˜ ê²©ë¦¬í™˜ê²½ì€ ë¸Œë¼ìš°ì €ì˜ JavaScript í™˜ê²½ì´ë‹¤. ê·¸ë¦¬ê³ , ì„œë²„ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ìƒìœ„ ë ˆë²¨ ì»¨í…Œì´ë„ˆë¡œì„œ JavaScriptë¥¼ ì´ìš©í•˜ëŠ” ë°©ì‹ì´ ë– ì˜¤ë¥´ê³  ìˆë‹¤. JavaScript ì»¨í…Œì´ë„ˆJavaScript ì»¨í…Œì´ë„ˆë€ ì„œë²„ ì†Œí”„íŠ¸ì›¨ì–´ ë°°í¬ë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ìƒìœ„ ë ˆë²¨ ì»¨í…Œì´ë„ˆë¡œ, ë¦¬ëˆ…ìŠ¤ ì»¨í…Œì´ë„ˆì™€ëŠ” ë‹¤ë¥¸ ì˜ì—­ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ê²ƒì´ë‹¤. ì´ ì»¨í…Œì´ë„ˆëŠ” ë‹¨ìˆœí•¨, ë¸Œë¼ìš°ì €ì™€ì˜ í˜¸í™˜ì„±, ì›¹ì–´ì…ˆë¸”ë¦¬ì™€ì˜ ì—°ë™ ë“±ì˜ íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆë‹¤. ë³´ì•ˆë³´ì•ˆ ì¸¡ë©´ì—ì„œ ì»¨í…Œì´ë„ˆëŠ” ë…ë¦½ëœ ë©”ëª¨ë¦¬ ê³µê°„ì„ ê°€ì§€ê³  ìˆìœ¼ë©° í•œ ì»¨í…Œì´ë„ˆê°€ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì˜ ë©”ëª¨ë¦¬ ê³µê°„ì„ ì§ì ‘ì ìœ¼ë¡œ ì ‘ê·¼í•˜ëŠ” ê²ƒì€ ì œí•œëœë‹¤. ì´ê²ƒì€ ë¸Œë¼ìš°ì €ì˜ íƒ­(Tab) ì—ì„œ ì œê³µí•˜ëŠ” ìƒŒë“œë°•ì‹± (Sandboxing)ì„ ì œê³µí•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤. ë¸Œë¼ìš°ì € ìƒŒë“œë°•ì‹±ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒŒë“œë°•ìŠ¤ë‚´ ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‹¤í–‰í•¨ìœ¼ë¡œì„œ ì•…ì˜ì ì¸ ì½”ë“œë‚˜ ê³µê²©ìœ¼ë¡œë¶€í„° ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë° ì‚¬ìš©ì ì‹œìŠ¤í…œì„ ë³´í˜¸í•œë‹¤. ë©”ëª¨ë¦¬ ê²©ë¦¬ (Memory Isolation)ëª¨ë˜ ë¸Œë¼ìš°ì €ëŠ” ëŒ€ë¶€ë¶„ í”„ë¡œì„¸ìŠ¤(Process) ë‹¨ìœ„ë¡œ ë¸Œë¼ìš°ì§• ì„¸ì…˜ì„ ê²©ë¦¬í•˜ëŠ” ìƒŒë“œë°•ìŠ¤ í™˜ê²½ì„ ì œê³µí•œë‹¤. ë¸Œë¼ìš°ì €ì˜ ìœˆë„ìš°ë‚˜ íƒ­ì€ ì´ë ‡ê²Œ ë³„ë„ í”„ë¡œì„¸ìŠ¤ê°€ í• ë‹¹ëœë‹¤. ì´ì— ë¹„í•´ JavaScript ëŸ°íƒ€ì„ì€ í”„ë¡œì„¸ìŠ¤ê°€ ë‹¨ìœ„ ì•„ë‹Œ, JavaScript ì—”ì§„ì—ì„œ ì œê³µí•˜ëŠ” ë³´ì•ˆ ë§¤ì»¤ë‹ˆì¦˜ì„ í†µí•´ ê²©ë¦¬ í™˜ê²½ì„ ì œê³µí•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ V8ì˜ Isolation ê¸°ëŠ¥ì€ JavaScript VM (Virtual Machine) ë‹¨ìœ„ë¡œ í• ë‹¹ì´ ë˜ì–´ì•¼í•˜ë©°, VMê°„ ì§ì ‘ì ì¸ ë©”ëª¨ë¦¬ì˜ ì ‘ê·¼ì€ ë¶ˆê°€í•˜ë‹¤. ê¶Œí•œ ëª¨ë¸ (Permission Model)ê¸°ì¡´ì˜ JavaScript ëŸ°íƒ€ì„ì€ ì‚¬ìš©ì ìì› ì‚¬ìš©ì— ëŒ€í•œ íŠ¹ë³„í•œ ì œí•œì„ ë‘ì§€ ì•Šì•˜ë‹¤. ì‹¤í–‰ ê¶Œí•œì´ë€ ê²ƒì„ JavaScript ëŸ°íƒ€ì„ì—ì„œ ì œì–´í•˜ëŠ” ë³µì¡ì„± ëŒ€ì‹  ì‚¬ìš©ìì—ê²Œ ëŸ°íƒ€ì„ ì‹¤í–‰í™˜ê²½ì„ ì•ˆì „í•˜ê²Œ í•˜ëŠ” ì±…ì„ì„ ë„˜ê¸´ ê²ƒì´ë‹¤. ë”°ë¼ì„œ, SMACK(Simplified Mandatory Access Control Kernel) í†µí•œ ë³´ì•ˆ í†µì œë¥¼ í•˜ë˜ì§€, Docker Container ì™€ ê°™ì€ ê²©ë¦¬ í™˜ê²½ì„ ë§Œë“œëŠ” ê²ƒì€ ì‚¬ìš©ìì˜ ì±…ì„ì´ì—ˆë‹¤. JavaScript ì»¨í…Œì´ë„ˆëŠ” ìì²´ì ìœ¼ë¡œ ê¶Œí•œ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìš”ì²­ ì œí•œí•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ &quot;ìµœì†Œ ê¶Œí•œ&quot; ì›ì¹™ì„ ë”°ë¥´ëŠ”ë°, ê° êµ¬ë™ì„ ìœ„í•œ í•„ìš”í•œ ê¶Œí•œë§Œì„ ë¶€ì—¬í•˜ê³ , ë‹¤ë¥¸ ê¶Œí•œì€ ì°¨ë‹¨í•˜ëŠ” ê²ƒì„ ê¸°ë³¸ìœ¼ë¡œ í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, File Systemì´ë‚˜ Network ê¸°ëŠ¥ì„ ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ì„œëŠ” ì‚¬ìš©ìì˜ ëª…ì‹œì ì¸ ë™ì˜ê°€ í•„ìš”í•˜ë‹¤. ì„±ëŠ¥ì„œë²„ë¦¬ìŠ¤ í”Œë«í¼ ì„œë¹„ìŠ¤ë“¤ì´ SaaS ì˜ ê²½ìš° ë¦¬ëˆ…ìŠ¤ ì»¨í…Œì´ë„ˆë‚˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰ í™˜ê²½ì„ ê°€ë™í•œë‹¤. ì´ëŠ” ìì²´ ë¨¸ì‹ ì—ì„œ JavaScript ëŸ°íƒ€ì„ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒë³´ë‹¤ ê°€ë²¼ìš´ í™˜ê²½ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì„œë²„ë¦¬ìŠ¤ í”Œë«í¼ì€ í”„ë¡œì„¸ìŠ¤ë¥¼ í™•ì¥í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í™˜ê²½ êµ¬ì„±ì„ ì¤€ë¹„í•˜ê¸° ë•Œë¬¸ì— Cold Startê°€ ë°œìƒí•œë‹¤. ì´ëŸ° ê²½ìš° JavaScript í™˜ê²½ì—ì„œ ì œê³µí•˜ëŠ” ê²©ë¦¬ í™˜ê²½ì„ ì´ìš©í•˜ë©´ ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ê°€ ì—¬ëŸ¬ê°œì˜ ê²©ë¦¬í™˜ê²½ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì¦‰, Cold Startë¡œ ì¸í•œ ì§€ì—°ì„ ì¤„ì´ëŠ” í•œí¸, í”„ë¡œì„¸ìŠ¤ì— ì¶”ê°€ë˜ëŠ” ë©”ëª¨ë¦¬ ë¦¬ì†ŒìŠ¤ì˜ ì‚¬ìš©ë„ ê°œì„ ëœë‹¤. ë˜í•œ, í”„ë¡œì„¸ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ì—¬ëŸ¬ê°œì˜ ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ë˜ì–´ ìˆì„ì‹œ, ë‹¤ì–‘í•œ í”„ë¡œì„¸ìŠ¤ê°„ì— ì „í™˜ì— í•„ìš”í•œ ì‹œê°„ì´ ê±¸ë¦¬ê²Œëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ í•œ í”„ë¡œì„¸ìŠ¤ì— í•„ìš”í•œ ë©”ëª¨ë¦¬ë¥¼ ë‚´ë³´ë‚´ê³ , ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ„í•œ ë©”ëª¨ë¦¬ë¥¼ ë¡œë“œí•˜ëŠ” ë“±ì˜ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹˜(Context Switch)ê°€ ë°œìƒí•œë‹¤.ì´ëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ê°¯ìˆ˜ì— ë¹„ë¡€í•´ ì˜¤ë²„í—¤ë“œê°€ ë°œìƒí•˜ëŠ”ë°, JavaScriptë‚´ ê²©ë¦¬ í™˜ê²½ì„ ì´ìš©í•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì„±í•˜ë©´ í”„ë¡œì„¸ìŠ¤ê°„ ì „í™˜ì— ë”°ë¥¸ ì˜¤ë²„í—¤ë“œë¥¼ ì—†ì•¨ ìˆ˜ ìˆë‹¤. ë‹¨ì ì´ëŸ¬í•œ ì‹œìŠ¤í…œì€ ì„ì˜ì˜ ì»´íŒŒì¼ëœ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìœ¼ë©°, Javascriptë‚˜ WebAssemblyê°€ ì§€ì›í•˜ëŠ” ì–¸ì–´ë¡œ ì‘ì„±ë˜ì–´ì•¼í•œë‹¤. References https://blog.cloudflare.com/cloud-computing-without-containers/ http://runtimejs.org/jsconf/#/17","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[{"name":"node.js","slug":"node-js","permalink":"https://llnm.github.io/tags/node-js/"}]},{"title":"Node.js í”„ë¡œì íŠ¸ ê°œìš” 1","slug":"article-2023-09-03-nodejs-overview-1","date":"2023-09-03T02:34:04.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-09-03-nodejs-overview-1/","link":"","permalink":"https://llnm.github.io/article/2023-09-03-nodejs-overview-1/","excerpt":"","text":"ë³¸ ë¬¸ì„œëŠ” ê·¸ë™ì•ˆì˜ Node.js ê¸°ì—¬ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ Node.js í”„ë¡œì íŠ¸ë¥¼ ì²˜ìŒ ì‹œì‘í•˜ëŠ” ì‚¬ëŒë“¤ì„ ìœ„í•´ ê°„ëµí•œ ê°œìš”ë¥¼ ì „ë‹¬í•˜ê³ ì í•œë‹¤. ë¬¼ë¡  í”„ë¡œì íŠ¸ ë‚´ìš©ì€ ì§€ì†ì ìœ¼ë¡œ ë³€ê²½ë˜ê³  ìˆìœ¼ë©° í˜„ ì‹œì ì—ì„œ ìœ íš¨í•œ ë‚´ìš©ì´ë‹¤. ê·¸ëŸ¬ë‚˜ ì–´ëŠ ì •ë„ ê²¬ê³ í•˜ê²Œ í™•ì •ë˜ì–´ ì˜¤ë«ë™ì•ˆ í†µìš©ë˜ê³  ìˆëŠ” ë‚´ìš©ì— ëŒ€í•´ ì‘ì„±í•˜ê³ ì í•œë‹¤. Node.js Coreì˜ ìš©ì–´Node.js ì—ì„œì˜ ê° ìš”ì†Œë¥¼ ê°€ë¥´í‚¤ëŠ” ìš©ì–´ëŠ” ì—¬ëŸ¬ê°€ì§€ë¡œ í†µìš©ì´ ë˜ì–´ì™”ìœ¼ë‚˜ ì•„ë˜ì™€ ê°™ì´ ê³µì‹ì ìœ¼ë¡œ ì •ë¦¬ë˜ì—ˆë‹¤. Built-in(s): Node.js ëŠ” JavaScript ë¶€ë¶„ê³¼ C++ ë¶€ë¶„ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤. Node coreë¥¼ ì´ë£¨ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ JavaScript ì½”ë“œë¥¼ Builtins í˜¹ì€ Builtin module ì´ë¼ê³  ë¶€ë¥¸ë‹¤. Bindings: Builtins ì—ì„œ ì‚¬ìš©í•˜ëŠ” API ë¡œì„œ Native ìª½ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë¶€ë¶„ì„ ëœ»í•œë‹¤. Native ì½”ë“œëŠ” C++ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤. C++ ì½”ë“œê°€ ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©ì ì˜ì—­ìœ¼ë¡œ ë…¸ì¶œë˜ëŠ” ê²½ìš°ëŠ” ì—†ìœ¼ë©° JavaScript ë¶€ë¶„ì—ì„œ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë¥¼ ê±°ì³ì„œ ì‚¬ìš©ëœë‹¤. ì¼ë°˜ì ìœ¼ë¡œ JavaScript ë¶€ë¶„ì€ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë¥¼ ë…¸ì¶œí•˜ê³  Bindingsë¥¼ ë¶€ë¥´ê¸° ì „ì— ì…ë ¥ëœ Argumentsì— ëŒ€í•œ Validationì„ ì²˜ë¦¬í•œë‹¤. C++ ì½”ë“œë‚´ì—ì„œëŠ” ë³„ë„ì˜ Validationì€ ìˆ˜í–‰í•˜ì§€ ì•Šê³  ì •í•´ì§„ Argumentsê°€ ë“¤ì–´ì™”ëŠ”ì§€ì— ëŒ€í•´ì„œ Assertionì„ ìˆ˜í–‰í•œë‹¤. addons: Node.js ì— ë™ì ìœ¼ë¡œ ë§í¬ë˜ëŠ” Shared libraryë¡œ Node-API, NAN ë¥¼ í†µí•´ êµ¬ì„±ë˜ê³  APIë¥¼ ì œê³µí•œë‹¤. í”„ë¡œì íŠ¸ ì†ŒìŠ¤ êµ¬ì„±lib lib - JavaScript builtins ì— í•´ë‹¹í•˜ëŠ” ì½”ë“œê°€ í¬í•¨ëœë‹¤. lib/**/*.js í•˜ìœ„ì˜ ì½”ë“œì´ë‹¤. ëª¨ë“  ëª¨ë“ˆì€ ì™¸ë¶€ ì¸í„°í˜ì´ìŠ¤ ì˜ì—­ê³¼ internals ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰œë‹¤. ì´ëŸ¬í•œ êµ¬ë¶„ì„ í†µí•˜ì—¬ internal ì˜ì—­ì˜ ì½”ë“œê°€ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œë˜ì–´ ë³€ì¡°ë˜ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤. internal&#x2F;bootstrapê³¼ internal&#x2F;main ì€ Node.js ì˜ Builtinsë¥¼ Bootstrapí•˜ëŠ” ì½”ë“œì™€ ì˜µì…˜ë³„ Entry ì½”ë“œë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤. src src - C++ ì˜ì—­ì—ì„œ êµ¬í˜„ëœ src/node_*.cc ì˜ ì´ë¦„ìœ¼ë¡œ ëœ bindings ì½”ë“œì™€ node_api.h íŒŒì¼ì— ì •ì˜ëœ addons (Node-API)ì§€ì› ì¸í„°í˜ì´ìŠ¤ ì½”ë“œë¥¼ ì œê³µí•œë‹¤. node_main.ccëŠ” Node.js ì˜ í”„ë¡œê·¸ë¨ Entry ì´ë©°, ê° JavaScript Context ë³„ë¡œ ìƒì„±ëœ í™˜ê²½ì •ë³´ëŠ” env.cc ì˜ ì½”ë“œì—ì„œ ì •ì˜ëœ Environment í´ë˜ìŠ¤ì— ì˜í•´ ë‹¤ë£¬ë‹¤. deps deps - Node.js ê°€ ì‚¬ìš©í•˜ê³  ìˆëŠ” ì™¸ë¶€ Dependencyë“¤ì„ ë‹¤ë£¬ë‹¤. v8, libuv, http_parser, zlib, openssl ë“±ì´ ìˆë‹¤. git submoduleì´ë‚˜ subtreeë¡œ ë‹¤ë£¨ì§€ ì•Šê³  ì§ì ‘ ì½”ë“œë¥¼ copyí•˜ì—¬ ì‚¬ìš©í•œë‹¤. ë¹Œë“œë¥¼ ìœ„í•´ ê° í”„ë¡œì íŠ¸ì˜ build configë¥¼ ì§ì ‘ ë¶€ë¥´ì§€ ì•Šê³  gypë¡œ êµ¬ì„±í•œ build config ë¥¼ ê°ê°ì— ì¶”ê°€í•´ í”„ë¡œì íŠ¸ rootì˜ node.gypë¡œ ë¶€í„° ì½ëŠ”ë‹¤. dependencyê°€ ì—…ë°ì´íŠ¸ í• ë•Œ ë²„ì „ ì •ë³´ë¥¼ ë³„ë„ì˜ headerë¡œ ê´€ë¦¬í•˜ë„ë¡ ë˜ì–´ìˆë‹¤. (src/*_version.h íŒŒì¼) ì´ë¥¼ í†µí•´ Node.js ì—ì„œ ê° dependencyì˜ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•œë‹¤. ì—…ë°ì´íŠ¸ ìŠ¤í¬ë¦½íŠ¸ëŠ” tools/dep_updaters/update-*.sh ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. test test - Node Coreì— ëŒ€í•œ Testë¥¼ ë‹¤ë£¬ë‹¤. test/parallel ë‚´ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ”ë°, ë³‘ë ¬ë¡œ ì‹¤í–‰ë˜ì–´ë„ ì„œë¡œ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šì€ ì½”ë“œë¥¼ ë‹´ê³  ìˆë‹¤. ì´ì—ë¹„í•´ test/sequentialì€ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë‹¤ë£¬ë‹¤. test/cctestëŠ” gtestë¡œ êµ¬ì„±í•˜ì—¬ Node.js embedderë¥¼ ìœ„í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œ, test/addons ì€ Node-APIì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ í¬í•¨í•œë‹¤. test/wptëŠ” Node.jsì˜ Web í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ êµ¬ì„±ë˜ì–´ìˆëŠ”ë°, Web Platform Testì˜ íŠ¹ì • ë²„ì „ì„ ê°€ì ¸ì™€ ì‚¬ìš©í•œë‹¤. wpt ë²„ì „ì„ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•œ toolê³¼ Node.jsì—ì„œ WPT test harnessê°€ ë™ì‘í•˜ê¸° ìœ„í•œ í™˜ê²½ ì„¤ì •ì„ í•œë‹¤. test/common: í•´ë‹¹ í´ë”ëŠ” Node.js test êµ¬ì„±ì„ ìœ„í•œ íˆ´ì„ ë‹¤ë£¨ê³  ìˆë‹¤. í•´ë‹¹ íˆ´ì˜ ì‚¬ìš©ì€ ì„ íƒì ì¸ê²ƒì´ ì•„ë‹ˆê³  ë°˜ë“œì‹œ ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ test/common/index.jsë¥¼ í˜¸ì¶œí•´ì¤˜ì•¼í•œë‹¤. ê° í…ŒìŠ¤íŠ¸ë¥¼ Node.js ëŸ°íƒ€ì„ìœ¼ë¡œ ì§ì ‘ ì‹¤í–‰í•  ìˆ˜ë„ ìˆì§€ë§Œ ê¸°ë³¸ì ìœ¼ë¡œ Worker Threadì—ì„œ ë™ì‘í•˜ë„ë¡ ë˜ì–´ìˆë‹¤. ëŸ°íƒ€ì„ ì‹¤í–‰ì‹œ íŠ¹ë³„í•œ CLI optionì´ ì „ë‹¬ë˜ì•¼í•  ë•ŒëŠ” Flags ì»¤ë©˜íŠ¸ ë¼ì¸ì„ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì²«ì¤„ì— ì‘ì„±í•˜ì—¬ ì „ë‹¬í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤. 1// Flags: --no-warnings --expose-gc --expose-internals benchmark benchmark - ì—°ì‚°ì„±ëŠ¥ì„ ì¸¡ì •í•˜ê¸° ìœ„í•œ ì½”ë“œë¥¼ ë‹¤ë£¨ê³  ìˆë‹¤. compare.js ëŠ” ë¹„êµí•˜ê³ ì í•˜ëŠ” ë‘ê°œì˜ executableì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìœ¼ë©°, local build ë²„ì „ê³¼ globalì— ì„¤ì¹˜ëœ íŠ¹ì • Node.js ë²„ì „ì„ ì „ë‹¬í•¨ìœ¼ë¡œì„œ í•˜ë‚˜ì˜ ì½”ë“œìƒì—ì„œ ì–´ë–¤ ì„±ëŠ¥ ë³€í™”ê°€ ìˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤. ë²¤ì¹˜ë§ˆí¬ ìˆ˜í–‰ê²°ê³¼ ì½ëŠ” ë°©ë²•ë²¤ì¹˜ë§ˆí¬ì—ì„œì˜ ì„±ëŠ¥ì°¨ì´ëŠ” ì‹¤ì œ ë³€ê²½ ì‚¬í•­ ìì²´ë³´ë‹¤ ê° í™˜ê²½ì— ë”°ë¼ ë°œìƒí•˜ëŠ” ì„ì˜ì˜ ë³€ìˆ˜ë“¤ë¡œ ì¸í•´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ìˆ˜í–‰ê²°ê³¼ì˜ ì‹ ë¢°ì„± ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œë¥¼ í™•ì¸í•  í•„ìš”ê°€ ìˆë‹¤. 1234567891011 confidence improvement accuracy (*) (**) (***)util/priority-queue.js n=100000 -2.50 % Â±4.41% Â±5.87% Â±7.64%fs/bench-writeSync.js n=100000 *** 116.41 % Â±9.35% Â±12.49% Â±16.36%fs/bench-readSync.js n=100000 type=1 0.46 % Â±6.13% Â±8.16% Â±10.62%Be aware that when doing many comparisons the risk of a false-positiveresult increases. In this case, there are 1 comparisons, you can thusexpect the following amount of false-positive results: 0.05 false positives, when considering a 5% risk acceptance (*, **, ***), 0.01 false positives, when considering a 1% risk acceptance (**, ***), 0.00 false positives, when considering a 0.1% risk acceptance (***) ë²¤ì¹˜ë§ˆí¬ë¥¼ ìˆ˜í–‰í•˜ë©´ ìœ„ì™€ ê°™ì€ ê²°ê³¼ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ ë¨¼ì € í™•ì¸í•´ì•¼ í•  ê²ƒì€ confidenceë‹¤. confidenceì— ë³„í‘œ (*, **, ***) ê°€ ì—†ëŠ” ëª¨ë“  ì¤„ì€ ë¬´ì‹œí•œë‹¤. util/priority-queue.js ì¼€ì´ìŠ¤ë¥¼ í•´ì„í•˜ë©´ -2.50%-4.41%ì™€ -2.50%+4.41% ì‚¬ì´ë¼ê³  ê°€ì •í•  ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ë‚´ìš©ì€ 5%ì˜ í™•ë¥ ë¡œ í‹€ë¦° ê²°ê³¼ (False Positives) ì¼ ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤. Node.js ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë³„í‘œê°€ 2ê°œ í˜¹ì€ 3ê°œ ì •ë„ì˜ risk í—ˆìš©ë²”ìœ„ì— ìˆì„ë•Œ ê°œì„ , í‡´ë³´ ì—¬ë¶€ë¥¼ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë¼ê³  ìƒê°í•˜ê³  ìˆë‹¤. typings typings - Node.js ì½”ë“œ ì‘ì„±ì‹œ Typeì„ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ìš©ë„ë¡œ ì‘ì„±ëœ *.d.ts íŒŒì¼ì„ í¬í•¨í•œë‹¤. JavaScript ìì²´ëŠ” íƒ€ì…ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•Šì§€ë§Œ ì´ê³³ì˜ íŒŒì¼ë“¤ì´ lib í´ë”ë‚´ ëª¨ë“ˆì˜ ì™¸ë¶€ ì¸í„°í˜ì´ìŠ¤ íŒŒì¼ë“¤ê³¼ ë§¤ì¹­ëœë‹¤. vscode ì™€ ê°™ì€ íˆ´ì—ì„œ ê°œë°œì‹œ íƒ€ì…ì„ í™•ì¸ í•  ìˆ˜ ìˆê³  code complitionê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤. doc doc - API ë„íë¨¼íŠ¸ë¥¼ ë¹Œë“œí•˜ê¸° ìœ„í•œ ì›ë³¸ mdíŒŒì¼ê³¼ Node.jsì— ê¸°ì—¬ë¥¼ í•  ë•Œ ì•Œì•„ì•¼ í•  ì—¬ëŸ¬ ì •ë³´ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆë‹¤. API ë„íë¨¼íŠ¸ ë¹Œë“œë¥¼ ëª©ì ìœ¼ë¡œ í•˜ê¸° ë•Œë¬¸ì— ë”°ë¼ì•¼í•  conventionì´ ì¡´ì¬í•˜ë©° ìˆ˜ì • í›„ $ make format-md í˜¹ì€ $ tools/lint-md/lint-md.mjs ì´ìš©í•´ lint ê°€ëŠ¥í•˜ë‹¤. API ë„íë¨¼íŠ¸ì˜ APIëŠ” ì•ŒíŒŒë²³ ìˆœìœ¼ë¡œ ì‘ì„±ë˜ì•¼í•˜ë©° ë‚´ë¶€&#x2F;ì™¸ë¶€ ë§í¬ëŠ” mdì— ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³  ë¬¸ì„œì˜ ìµœí•˜ë‹¨ì— ì£¼ì„ìœ¼ë¡œ ì‘ì„±ë˜ì•¼í•œë‹¤. Node.jsì˜ CLI Optionì´ ìˆ˜ì •ë˜ë©´ doc/node.1 ì˜ íŒŒì¼ì„ ì—…ë°ì´íŠ¸ í•œë‹¤. ê·¸ë ‡ê²Œ í•¨ìœ¼ë¡œì„œ Unix ê³„ì—´ì˜ ìš´ì˜ì²´ì œì—ì„œ man ìœ í‹¸ì„ í†µí•´ ëª…ë ¹ì–´ ë¬¸ì„œì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"Node.js V8 Options","slug":"article-2023-08-21-v8-options","date":"2023-08-21T05:09:42.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-08-21-v8-options/","link":"","permalink":"https://llnm.github.io/article/2023-08-21-v8-options/","excerpt":"","text":"Node.js V8 Build Option Node.jsëŠ” ê¸°ë³¸ì ìœ¼ë¡œ JavaScript Runtimeì´ë‹¤. JavaScript Runtimeì€ JavaScriptë¥¼ ì‹¤í–‰ì‹œí‚¬ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ëœ»í•˜ë©° ì½”ë“œë¥¼ í•´ì„í•˜ê³  ì‹¤í–‰í•˜ëŠ” í•µì‹¬ ì—­í• ì„ ë‹´ë‹¹í•œë‹¤. Node.js ì—ì„œ ì—¬ëŸ¬ JavaScript ì—”ì§„ì¤‘ì—ì„œ êµ¬ê¸€ì´ ê°œë°œí•œ V8 ì—”ì§„ì„ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°, Node.js ë¹Œë“œì‹œ V8 Optionì„ ì „ë‹¬í•˜ì—¬ Customization í•  ìˆ˜ ìˆë‹¤. V8 Optionì€ Node.js Coreì½”ë“œì™€ ì§ì ‘ì ìœ¼ë¡œ ì—°ê´€ì´ ìˆëŠ” ì œì–´ ì½”ë“œ ì™¸ deps/v8 ì—ì„œ library ë¹Œë“œ ì‹œ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ìœ¼ë¡œ ë‚˜ë‰œë‹¤. Node.js OptionsLite ModeV8ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë³´ë‹¤ ì„±ëŠ¥ ê¸°ë³¸ì ìœ¼ë¡œ ì´ˆì ì„ ë§ì¶”ê³  ìˆë‹¤. ê·¸ëŸ¬í•œ ê°œë°œ ë°©í–¥ê³¼ ë‹¤ì†Œ ë°˜ëŒ€ì˜ ìƒí™©ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ìœ¼ë¡œ ê¸°ë³¸ì ì¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì´ê³  JIT (Just-In-Time) ì»´íŒŒì¼ì„ êº¼ì„œ ë©”ëª¨ë¦¬ ì†Œë¹„ë¥¼ ë”ìš± ì¤„ì¸ë‹¤. JIT(Just-In-Time) ì»´íŒŒì¼ì€ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ëŠ” ë™ì•ˆ ì‹¤ì œë¡œ í•„ìš”í•œ ì½”ë“œ ë¶€ë¶„ë§Œ ì»´íŒŒì¼í•˜ëŠ” ê¸°ìˆ ì´ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ JavaScript ì½”ë“œëŠ” í•œ ì¤„ì”© ì¸í„°í”„ë¦¬í„°ì— ì˜í•´ í•´ì„ë˜ì§€ë§Œ, JIT ì»´íŒŒì¼ëŸ¬ëŠ” ìì£¼ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ë‚˜ ë£¨í”„ ê°™ì€ í•µì‹¬ ì½”ë“œë¥¼ ë¯¸ë¦¬ ì»´íŒŒì¼í•˜ê³  ìµœì í™”í•˜ì—¬ ì‹¤í–‰ ì†ë„ë¥¼ ë†’ì¸ë‹¤. ê´€ë ¨ Configuration configure.pylink789790791792793794795parser.add_argument(&#x27;--v8-lite-mode&#x27;, action=&#x27;store_true&#x27;, dest=&#x27;v8_lite_mode&#x27;, default=False, help=&#x27;compile V8 in lite mode for constrained environments (lowers V8 &#x27;+ &#x27;memory footprint, but also implies no just-in-time compilation &#x27; + &#x27;support, thus much slower execution)&#x27;) https://v8.dev/blog/v8-lite CodeCache ê¸°ëŠ¥JavaScript ì—”ì§„ì€ CodeCache ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. CodeCacheëŠ” ì»´íŒŒì¼ëœ ì½”ë“œë¥¼ ìºì‹œë¡œ ì €ì¥í•˜ëŠ” ê³µê°„ì´ë©°, ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì½”ë“œë¥¼ ì €ì¥í•´ë‘ì–´ ë¹ ë¥¸ ì‹¤í–‰ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤. ì´ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ëŠ” ë° ë„ì›€ì´ ëœë‹¤. ê´€ë ¨ Configuration configure.pylink626627628629630parser.add_argument(&#x27;--without-node-code-cache&#x27;, action=&#x27;store_true&#x27;, dest=&#x27;without_node_code_cache&#x27;, default=None, help=&#x27;Turn off V8 Code cache integration.&#x27;) SnapshotSnapshotì€ ì´ˆê¸° ëŸ°íƒ€ì„ ìƒíƒœë¥¼ ì €ì¥í•˜ê³ , ì´ë¥¼ ë‚˜ì¤‘ì— ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. ì´ë¡œì¨ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹œì‘ ì‹œê°„ì„ ë‹¨ì¶•ì‹œí‚¤ê³  ì´ˆê¸° ë¡œë”© ì‹œê°„ì„ ìµœì í™”í•  ìˆ˜ ìˆë‹¤. ê´€ë ¨ Configuration configure.pylink612613614615616617618619620621622623624parser.add_argument(&#x27;--write-snapshot-as-array-literals&#x27;, action=&#x27;store_true&#x27;, dest=&#x27;write_snapshot_as_array_literals&#x27;, default=None, help=&#x27;Write the snapshot data as array literals for readability.&#x27; &#x27;By default the snapshot data may be written as string literals on some &#x27; &#x27;platforms to speed up compilation.&#x27;)parser.add_argument(&#x27;--without-node-snapshot&#x27;, action=&#x27;store_true&#x27;, dest=&#x27;without_node_snapshot&#x27;, default=None, help=&#x27;Turn off V8 snapshot integration. Currently experimental.&#x27;) configure.pylink823824825826827parser.add_argument(&#x27;--v8-enable-snapshot-compression&#x27;, action=&#x27;store_true&#x27;, dest=&#x27;v8_enable_snapshot_compression&#x27;, default=None, help=&#x27;Enable the built-in snapshot compression in V8.&#x27;) Pointer CompressionV8 ì—”ì§„ì´ JavaScript ê°ì²´ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ì €ì¥í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ë©”ëª¨ë¦¬ë¥¼ ì¤„ì´ê¸° ìœ„í•œ ìµœì í™” ê¸°ëŠ¥ì´ë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ V8ëŠ” 64ë¹„íŠ¸ í¬ì¸í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ì§€ë§Œ, Pointer Compressionì„ í™œì„±í™”í•˜ë©´ ê°ì²´ í¬ì¸í„°ë¥¼ ë” ì‘ì€ í¬ê¸° (32ë¹„íŠ¸)ì˜ í¬ì¸í„°ë¡œ ì••ì¶•í•˜ì—¬ ë©”ëª¨ë¦¬ë¥¼ ì ˆì•½í•  ìˆ˜ ìˆë‹¤. ì‘ì€ í¬ì¸í„° í¬ê¸°ëŠ” í™˜ê²½ì— ë”°ë¼ì„œ CPU ìºì‹œì—ì„œ ê°ì²´ë¥¼ ë¡œë“œí•˜ëŠ” ë° ë” íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìœ¼ë©°, ì´ë¡œ ì¸í•´ ë” ë¹ ë¥¸ ì‹¤í–‰ ì†ë„ë¥¼ ì–»ì„ ìˆ˜ë„ ìˆë‹¤. ë‹¤ë§Œ ì´ ì˜µì…˜ì„ í¬ë©´ ì£¼ì†Œê³µê°„ì´ 4GBë¡œ ì œí•œë˜ë©° ë”°ë¼ì„œ max heap í¬ê¸°ë„ ê·¸ í¬ê¸°ë¡œ í•œì •ëœë‹¤. ê´€ë ¨ Configuration configure.pylink488489490491492parser.add_argument(&#x27;--experimental-enable-pointer-compression&#x27;, action=&#x27;store_true&#x27;, dest=&#x27;enable_pointer_compression&#x27;, default=None, help=&#x27;[Experimental] Enable V8 pointer compression (limits max heap to 4GB and breaks ABI compatibility)&#x27;) Runtime V8 OptionsNode.js ì‹¤í–‰ì‹œì ì—ë„ V8 ë™ì‘ì— ê´€í•œ ì„¸ë¶€ ì„¤ì •ì„ í•  ìˆ˜ ìˆëŠ”ë° ì´ëŸ¬í•œ ì˜µì…˜ì„ ë¹Œë“œ ì‹œì ì— defaultë¡œ ì ìš©í•  ìˆ˜ ë„ ìˆë‹¤. ì „ì²´ì˜µì…˜ì„ ë³´ê³ ì‹¶ë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì‹¤í–‰í•˜ë©´ ëœë‹¤. 1node --v8-options ê´€ë ¨ Configuration configure.pylink500501502503parser.add_argument(&#x27;--v8-options&#x27;, action=&#x27;store&#x27;, dest=&#x27;v8_options&#x27;, help=&#x27;v8 options to pass, see `node --v8-options` for examples.&#x27;) References https://v8.dev/blog/improved-code-caching https://www.geeksforgeeks.org/what-is-the-relationship-between-node-js-and-v8/ https://joyeecheung.github.io/blog/2022/04/14/fixing-snapshot-support-of-class-fields-in-v8/","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"V8 Fast APIì— ëŒ€í•˜ì—¬ 2","slug":"article-2023-08-14-fast-api-2","date":"2023-08-13T15:30:20.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-08-14-fast-api-2/","link":"","permalink":"https://llnm.github.io/article/2023-08-14-fast-api-2/","excerpt":"","text":"V8 Fast API ì‚¬ìš©ì´ì „ Postì— ì´ì–´ ë³¸ í˜ì´ì§€ì—ì„œëŠ” V8 Fast API ë¥¼ ì½”ë“œ ìƒì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ” í™•ì¸í•˜ê³  ì–´ë–»ê²Œ ê¸°ì¡´ APIì™€ ë‹¤ë¥¸ì§€ í™•ì¸í•´ë³¸ë‹¤. 1. Add functions for Fast APISlow APIì˜ ê²½ìš° FunctionCallbackInfoë¥¼ ì¸ìë¡œ ë°›ëŠ”ê²ƒì— ë¹„í•´ Fast APIëŠ” ì…ë ¥ê°’ ìì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ”ë‹¤. 12345678910static double FastDivide(const int32_t a, const int32_t b, v8::FastApiCallbackOptions&amp; options) &#123; if (b == 0) &#123; options.fallback = true; return 0; &#125; else &#123; return a / b; &#125;&#125; 2. Fallback Slow APIFallback APIëŠ” ì‚¬ìš©ì ì§€ì • ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ê±°ë‚˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•´ì•¼ í•  ë•Œì™€ ê°™ì´ ëŠë¦° ê²½ë¡œë¡œ ì „í™˜í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•œ ê²½ìš°ì— ëŒ€ë¹„í•´ í´ë°±ì„ ì§€ì›í•œë‹¤. Fallback ë©”ì»¤ë‹ˆì¦˜ì€ Fast API í•¨ìˆ˜ ì„ ì–¸ì˜ C++ êµ¬í˜„ì—ì„œ í™œì„±í™” ë° ë³€ê²½í•  ìˆ˜ ìˆëŠ”ë°, V8ì—ì„œ FastApiCallbackOptions ì„ trueë¡œ ì „ë‹¬í•œë‹¤. 123456789101112131415static void SlowDivide(const FunctionCallbackInfo&lt;Value&gt;&amp; args) &#123; Environment* env = Environment::GetCurrent(args); CHECK_GE(args.Length(), 2); CHECK(args[0]-&gt;IsInt32()); CHECK(args[1]-&gt;IsInt32()); auto a = args[0].As&lt;v8::Int32&gt;(); auto b = args[1].As&lt;v8::Int32&gt;(); if (b-&gt;Value() == 0) &#123; return node::THROW_ERR_INVALID_STATE(env, &quot;Error&quot;); &#125; double result = a-&gt;Value() / b-&gt;Value(); args.GetReturnValue().Set(v8::Number::New(env-&gt;isolate(), result));&#125; ì´ë ‡ê²Œ ì§€ì •ëœ APIëŠ” ì•„ë˜ì™€ ê°™ì´ JavaScriptë¥¼ ì‹¤í–‰í–ˆì„ë•Œ ê°ê° Fast, Slow Pathë¥¼ ë”°ë¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤. 12divide(2, 2); // calls fast pathdivide(2, 0); // calls fallback (slow path) ê¸°ì¡´ì—, SetMethod ë‚˜ SetMethodNoSideEffect ë¥¼ í†µí•´ ê°ì²´ì— binding APIë¥¼ ë“±ë¡í–ˆë˜ê²ƒê³¼ ë‹¤ë¥´ê²Œ SetFastMethod ë¥¼ ì´ìš©í•˜ì—¬ Fast APIë¥¼ ë“±ë¡í•œë‹¤. 4ë²ˆì§¸ ì¸ìë¡œ Fallback APIë¥¼ ì „ë‹¬í•œë‹¤. 12345678910CFunction fast_divide_(CFunction::Make(FastDivide));static void Initialize(Local&lt;Object&gt; target, Local&lt;Value&gt; unused, Local&lt;Context&gt; context, void* priv) &#123; // SetMethodNoSideEffect(context, target, &quot;divide&quot;, SlowDivide); SetFastMethod(context, target, &quot;divide&quot;, SlowDivide, &amp;fast_divide_);&#125; 3. Snapshotì„ ìœ„í•œ ë“±ë¡ì–´ë–¤ APIë¥¼ Snapshotìœ¼ë¡œ ë§Œë“¤ì–´ì•¼í• ì§€ ì§ì ‘ ì½”ë“œìƒì—ì„œ ë“±ë¡í•´ì•¼í•œë‹¤. 123456// Snapshotvoid RegisterExternalReferences(ExternalReferenceRegistry* registry) &#123; registry-&gt;Register(SlowDivide); registry-&gt;Register(FastDivide); registry-&gt;Register(fast_divide_.GetTypeInfo());&#125; Reference buffer: use v8 fast API calls for Buffer.byteLength with sequential one-byte strings timers: use V8 fast API calls adding-v8-fast-api.md","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"V8 Fast APIì— ëŒ€í•˜ì—¬ 1","slug":"article-2023-08-06-fast-api-1","date":"2023-08-06T05:09:42.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-08-06-fast-api-1/","link":"","permalink":"https://llnm.github.io/article/2023-08-06-fast-api-1/","excerpt":"","text":"V8 Fast API V8 JavaScript ì—”ì§„ì€ JIT ì»´íŒŒì¼ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” JavaScript ì—”ì§„ì´ë‹¤. ê·¸ëŸ°ë°, ì´ëŸ° JITì—ì„œ ì–»ì„ ìˆ˜ ìˆëŠ” ìµœì í™” ì¥ì ì´ C++ Bindingì—ëŠ” ì ìš©ë˜ê¸° ì–´ë µë‹¤. ê·¸ë˜ì„œ ë§¤ë²ˆ C++ ê³¼ JSë¥¼ ì˜¤ê°€ë©° ë³€í™˜, ì„¤ì • ê³¼ì •ì´ ìˆ˜ë°˜ë˜ëŠ” Callì„ ë¶ˆëŸ¬ì•¼í–ˆë‹¤. ê·¸ë¡œì¸í•œ ì„±ëŠ¥ì˜ ì €í•˜ê°€ ìˆì—ˆë‹¤. JIT(Just-In-Time) ì»´íŒŒì¼ì€ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ëŠ” ë™ì•ˆ ì‹¤ì œë¡œ í•„ìš”í•œ ì½”ë“œ ë¶€ë¶„ë§Œ ì»´íŒŒì¼í•˜ëŠ” ê¸°ìˆ ì´ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ JavaScript ì½”ë“œëŠ” í•œ ì¤„ì”© ì¸í„°í”„ë¦¬í„°ì— ì˜í•´ í•´ì„ë˜ì§€ë§Œ, JIT ì»´íŒŒì¼ëŸ¬ëŠ” ìì£¼ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ë‚˜ ë£¨í”„ ê°™ì€ í•µì‹¬ ì½”ë“œë¥¼ ë¯¸ë¦¬ ì»´íŒŒì¼í•˜ê³  ìµœì í™”í•˜ì—¬ ì‹¤í–‰ ì†ë„ë¥¼ ë†’ì¸ë‹¤. Fast API ëŠ” C++ ë°”ì¸ë”© ì½”ë“œì— ëŒ€í•´ì„œë„ IR ì½”ë“œë¡œ ì „í™˜ë  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. í–¥í›„ C++ ì½”ë“œë¥¼ ë¶€ë¥´ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¹ ë¥¼ ìˆ˜ ë°–ì— ì—†ë‹¤. ê·¸ëŸ¬ë‚˜ ëª¨ë“  V8 ëª¨ë“  C++ API ì— ëŒ€í•´ì„œ ì§€ì›í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆê³  ì‚¬ìš©ì— ë”°ë¥¸ ì œì•½ì´ ì¡´ì¬í•œë‹¤. ì œì•½ì‚¬í•­Fast APIê°€ ë„ì…ë˜ì—ˆë˜ ì‹œê¸°ì˜ ì œì•½ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ì•˜ë‹¤. í˜„ì¬ì—ëŠ” ì–´ë–»ê²Œ ë‹¬ë¼ì¡ŒëŠ”ì§€ í™•ì¸í•´ë³¼ê²ƒì´ì§€ë§Œ ì•„ë§ˆ í•µì‹¬ì ì¸ ì»¨ì…‰ì€ ë³€ê²½ë˜ì§€ ì•Šì„ ê²ƒì´ë‹¤. 1. JS Heapì— í• ë‹¹ë˜ì„œëŠ” ì•ˆëœë‹¤JS Heapì€ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì— ì˜í•´ ê´€ë¦¬ë˜ëŠ”ë° ì´ëŠ” ì„±ëŠ¥ì— ë¶€ë‹´ì„ ì¼ìœ¼í‚¬ìˆ˜ ìˆëŠ” ì‘ì—…ì´ê³  ë©”ëª¨ë¦¬ í• ë‹¹ ë˜í•œ ë§ˆì°¬ê°€ì§€ë‹¤. ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•œ ì œì•½ì¡°ê±´ìœ¼ë¡œ ë³´ì—¬ì§„ë‹¤. ì‹¤ ì˜ˆë¡œ ë”°ì§€ë©´ v8::Array::Get() or v8::Number::New() ì™€ ê°™ì€ ì‘ì—…ì„ í•  ìˆ˜ ì—†ë‹¤. 2. JS ì½”ë“œë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•´ì„œëŠ” ì•ˆëœë‹¤C++ ì½”ë“œê°€ ë‹¤ì‹œ JS ì½”ë“œë¥¼ í˜¸ì¶œí•˜ë©´ ì•ˆëœë‹¤. JIT ì»´íŒŒì¼ëŸ¬ê°€ ìƒì„±í•œ ìµœì í™”ëœ ì½”ë“œ ë‚´ì—ì„œ ë‹¤ì‹œ JavaScript ì½”ë“œë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜ ì‹¤í–‰í•˜ë©´ ì•ˆ ëœë‹¤ëŠ” ì›ì¹™ì„ ë‚˜íƒ€ë‚¸ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, JIT ì»´íŒŒì¼ëŸ¬ê°€ ì¼ë¶€ ì½”ë“œë¥¼ ìµœì í™”í•˜ê³  ê¸°ê³„ ì½”ë“œë¥¼ ìƒì„±í•˜ì˜€ëŠ”ë°, ê·¸ ì¤‘ì— JavaScript í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì´ ìˆë‹¤ê³  ê°€ì •í•´ë³´ì. ì´ë ‡ê²Œ ë˜ë©´ ê¸°ê³„ ì½”ë“œ ë‚´ì—ì„œ JavaScript ì—”ì§„ì˜ ì‹¤í–‰ íë¦„ì„ ë”°ë¼ê°€ì•¼ í•˜ë¯€ë¡œ ìµœì í™”ëœ ì½”ë“œì˜ ì„±ëŠ¥ í–¥ìƒ íš¨ê³¼ê°€ ìƒì‡„ë  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ Fast API ì½”ë“œ ë‚´ì—ì„œ JavaScript ì½”ë“œ í˜¸ì¶œì„ í—ˆìš©í•˜ì§€ ì•Šê³ , ìˆœìˆ˜í•œ ê¸°ê³„ ì½”ë“œë¡œë§Œ êµ¬ì„±ë˜ë„ë¡ ë³´ì¥í•œë‹¤. ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ ìµœì í™”ëœ ì½”ë“œì˜ ì„±ëŠ¥ ê°œì„  íš¨ê³¼ë¥¼ ìœ ì§€í•˜ë©´ì„œ ì˜ˆì¸¡ ê°€ëŠ¥í•˜ê³  ì•ˆì •ì ì¸ ì‹¤í–‰ì„ ë³´ì¥í•œë‹¤. 3. ì—ëŸ¬ë¥¼ Throw í•˜ëŠ” ê²ƒë„ í—ˆìš©ë˜ì§€ ì•ŠëŠ”ë‹¤ë§ˆì°¬ê°€ì§€ë¡œ Error ì²˜ë¦¬í•˜ëŠ”ë° ì†ë„ë¬¸ì œê°€ ìˆì„ê²ƒìœ¼ë¡œ ìƒê°ëœë‹¤. Fast APIë¥¼ ë“±ë¡í• ë•Œ, fallback ë„ ë“±ë¡í•˜ê²Œ ë˜ëŠ”ë°, Error Throwingì´ í•„ìš”í•œ ê²½ìš° fallback api (Slow API) ì—ì„œ ì‘ì—…í•˜ë©´ ëœë‹¤. 4. ëª¨ë“  Input typeê³¼ return type ì§€ì›í•˜ëŠ”ê²ƒì´ ì•„ë‹ˆë‹¤í˜„ì¬ ì§€ì›í•˜ëŠ” ì½”ë“œì— ëŒ€í•´ì„œëŠ” ì•„ë˜ì˜ ì½”ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. v8-fast-api-calls.hlink150151152153154155156157158159160161162163164165166* Currently supported return types:* - void* - bool* - int32_t* - uint32_t* - float32_t* - float64_t* Currently supported argument types:* - pointer to an embedder type* - JavaScript array of primitive types* - bool* - int32_t* - uint32_t* - int64_t* - uint64_t* - float32_t* - float64_t Related links 46619 - add SetFastMethodNoSideEffect() 46616 - buffer: use v8 fast API calls for Buffer.byteLength with sequential one-byte strings","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"Split strings containing Korean and English into tokens","slug":"article-2023-08-02-tokenize-multi-lang","date":"2023-08-01T15:00:00.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-08-02-tokenize-multi-lang/","link":"","permalink":"https://llnm.github.io/article/2023-08-02-tokenize-multi-lang/","excerpt":"","text":"How can we tokenize a string into a list based on language? For example, if the string is &quot;hi ì•ˆë…•í•˜ì„¸ìš” ë°˜ê°€ì›Œìš” hello&quot;, the resulting list should be [&quot;hi&quot;, &quot;ì•ˆë…•í•˜ì„¸ìš” ë°˜ê°€ì›Œìš”&quot;, &quot;hello&quot;]. To tokenize a string to a list by language, we can use a similar approach as before using regular expressions to tokenize the text based on the Unicode character properties. Here&#39;s an example code snippet that tokenizes a string to a list by language using regular expressions: 1234567891011121314151617181920import re# set the input stringinput_string = &#x27;hi ì•ˆë…•í•˜ì„¸ìš” ë°˜ê°€ì›Œìš” hello&#x27;# detect the language of the input stringif re.search(&#x27;[\\u3131-\\u3163\\uac00-\\ud7a3]+&#x27;, input_string): language = &#x27;korean&#x27;else: language = &#x27;english&#x27;# tokenize the input string using the appropriate regular expressionif language == &#x27;korean&#x27;: tokens = re.findall(&#x27;[^\\s]+&#x27;, input_string) tokens = [re.sub(r&#x27;([^\\w\\s]|_)+&#x27;, &#x27;&#x27;, token) for token in tokens]else: tokens = re.findall(r&#x27;\\w+&#x27;, input_string)# output the resulting list of tokensprint(tokens) This will output the following list of tokens: [&#39;hi&#39;, &#39;ì•ˆë…•í•˜ì„¸ìš” ë°˜ê°€ì›Œìš”&#39;, &#39;hello&#39;]. Note that for Korean text, we use the regular expression [^\\s]+ to match any sequence of non-whitespace characters, which includes punctuation symbols such as period and comma. We then use the re.sub function to remove any remaining punctuation from each token.","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[]},{"title":"Mechanism over Policy","slug":"talk-2023-07-29-mechanism-over-policy","date":"2023-07-29T04:18:44.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"talk/2023-07-29-mechanism-over-policy/","link":"","permalink":"https://llnm.github.io/talk/2023-07-29-mechanism-over-policy/","excerpt":"","text":"Node.jsì˜ dotenv ê¸°ëŠ¥ê³¼ ê´€ë ¨ëœ ìµœê·¼ Pull Request ë¦¬ë·°ë¥¼ ì§„í–‰í•˜ë‹¤ Ben Noordhuisì˜ ê²¬í•´ë¡œë¶€í„° ì‘ì€ ê¹¨ë‹¬ìŒì„ ì–»ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŠ” í•´ë‹¹ ê¸°ëŠ¥ì´ ì •ì±…ì— ê³¼ë„í•œ ì´ˆì ì„ ë‘ë©´ì„œ ìœ ì—°ì„±ì„ ìƒì„ ìˆ˜ ìˆë‹¤ê³  ìš°ë ¤í–ˆìŠµë‹ˆë‹¤. ì²˜ìŒì—ëŠ” ê·¸ì˜ ì˜ê²¬ì„ ì™„ì „íˆ ì´í•´í•˜ê¸° ì–´ë ¤ì› ì§€ë§Œ, ì ì°¨ ê³ ë¯¼í•´ë³´ë©´ì„œ ê·¸ì˜ ì˜ë„ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ ë””ìì¸ ë‹¨ê³„ì—ì„œ &quot;ì •ì±… ìš°ì„  ë©”ì»¤ë‹ˆì¦˜&quot;ê³¼ &quot;ë©”ì»¤ë‹ˆì¦˜ ìš°ì„  ì •ì±…&quot;ì´ë¼ëŠ” ë‘ ê°€ì§€ ì ‘ê·¼ë²• ê°„ì˜ ëŒ€ë¦½ì„ ìì£¼ ë§ˆì£¼í•˜ê²Œ ë©ë‹ˆë‹¤. ì „ìëŠ” ì •ì±…ì„ ë¨¼ì € ê²°ì •í•˜ê³  ê·¸ì— ë”°ë¼ ì‹œìŠ¤í…œì„ ì„¤ê³„í•˜ëŠ” ë°©ì‹ì´ë©°, í›„ìëŠ” ì‹œìŠ¤í…œì˜ ê¸°ë³¸ ë©”ì»¤ë‹ˆì¦˜ì„ ë¨¼ì € êµ¬ì¶•í•œ ë‹¤ìŒ ì •ì±…ì„ ë‚˜ì¤‘ì— ì¡°ì •í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì‹œìŠ¤í…œì„ ê°œë°œí•  ë•Œ ì •ì±…ì„ ìš°ì„  ê²°ì •í•˜ë©´ ì´ˆê¸°ë¶€í„° ì œí•œëœ í‹€ ì•ˆì—ì„œ ì‘ì—…í•´ì•¼ í•©ë‹ˆë‹¤. ì •ì±…ì´ ë³€ê²½ë˜ë©´ ì‹œìŠ¤í…œ ì „ì²´ë¥¼ ë‹¤ì‹œ ì„¤ê³„í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ &quot;ë©”ì»¤ë‹ˆì¦˜ ìš°ì„  ì •ì±…&quot;ì˜ ì ‘ê·¼ë²•ì€ ë” ìœ ì—°í•œ ë°©ì‹ì„ ì œê³µí•©ë‹ˆë‹¤. ë¬¼ë¡  ëª¨ë“  ìƒí™©ì—ì„œ ë©”ì»¤ë‹ˆì¦˜ì˜ ìœ ì—°ì„±ì„ ìš°ì„ ì‹œí•  ìˆ˜ ì—†ì§€ë§Œ, ì†Œí”„íŠ¸ì›¨ì–´ í™˜ê²½ì€ ì§€ì†ì ìœ¼ë¡œ ë³€í™”í•˜ê¸° ë•Œë¬¸ì— ì´ˆê¸°ì— ì •ì±…ì„ ê²°ì •í•˜ê³  ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹œìŠ¤í…œì„ ì„¤ê³„í•˜ëŠ” ê²ƒì´ ë‚˜ì¤‘ì— ë³€ê²½í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒì„ ë¯¸ë¦¬ ì¸ì‹í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤ëŠ” ê·¸ì˜ ì˜ê²¬ì— ê³µê°í–ˆìŠµë‹ˆë‹¤. ì•ìœ¼ë¡œ ì‹œìŠ¤í…œì„ ì„¤ê³„í•  ë•Œ í•­ìƒ ì´ë¥¼ ì—¼ë‘ì— ë‘ì–´ì•¼ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. ê´€ë ¨ PR: https://github.com/nodejs/node/pull/48890","categories":[{"name":"talk","slug":"talk","permalink":"https://llnm.github.io/categories/talk/"}],"tags":[]},{"title":"Transferable ê°ì²´ì˜ ìƒˆë¡œìš´ ì •ì˜ ë°©ë²•","slug":"article-2023-07-24-node-transferable","date":"2023-07-23T15:00:00.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-07-24-node-transferable/","link":"","permalink":"https://llnm.github.io/article/2023-07-24-node-transferable/","excerpt":"","text":"ì»¨í…ìŠ¤íŠ¸ ê°„ ì‚¬ìš©ì ì •ì˜ ê°ì²´ ì „ë‹¬MessagePortëŠ” ì„œë¡œ ë‹¤ë¥¸ ì»¨í…ìŠ¤íŠ¸ ê°„ì— ë©”ì‹œì§€ë¥¼ êµí™˜í•˜ê¸° ìœ„í•œ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. V8 ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì€ ê¸°ë³¸ ê°ì²´ë“¤ì˜ ì»¨í…ìŠ¤íŠ¸ ê°„ ì´ë™ ì‹œ ì§ë ¬í™”ì™€ ì—­ì§ë ¬í™” ë°©ë²•ì„ ì œê³µí•˜ë©°, ì‚¬ìš©ì ê°ì²´ì— ëŒ€í•´ì„œë„ ì§ë ¬í™”ì™€ ì—­ì§ë ¬í™”ë¥¼ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ V8ì´ ê¸°ì¡´ì— ì œê³µí•˜ë˜ ì´ëŸ¬í•œ ì¸í„°í˜ì´ìŠ¤ì—ëŠ” ë¬¸ì œì ì´ ìˆì–´, Web í˜¸í™˜ì„± API ë“±ì˜ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ë•Œ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ì— ëŒ€í•œ ê°œì„ ì„ ìœ„í•œ ì œì•ˆì´ ë“±ì¥í•˜ì—¬ í•´ë‹¹ ì œì•ˆì„ ê²€í† í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ê¸°ì¡´ ë°©ë²•Transferable objectsTransferable objectëŠ” í•œ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë‹¤ë¥¸ ì»¨í…ìŠ¤íŠ¸ë¡œ ì „ì†¡ ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤ë¥¼ í¬í•¨í•˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤. ì´ ê°ì²´ëŠ” ì „ì†¡í•˜ëŠ” ì»¨í…ìŠ¤íŠ¸ë¥¼ ë²—ì–´ë‚œ í›„ì—ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë©°, ë‹¤ë¥¸ ì»¨í…ìŠ¤íŠ¸ì—ì„œë§Œ í™œìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ê°ì²´ë¥¼ ì „ì†¡í•œ í›„ì—ëŠ” í•´ë‹¹ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë” ì´ìƒ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë©°, ì „ì†¡ëœ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë ¤ê³  ì‹œë„í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ArrayBufferë¥¼ ì „ì†¡í•˜ëŠ” ê²½ìš° ë‚´ë¶€ ë²„í¼ê°€ ë¶„ë¦¬ë˜ì–´ ì „ì†¡ë˜ë©°, ì´í›„ì— í•´ë‹¹ ë²„í¼ì— ì ‘ê·¼í•˜ë ¤ê³  í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 12345let ab = new ArrayBuffer(1);worker.postMessage(ab, [ab]);if (ab.byteLength == 0) &#123; // ab is transferred.&#125; ì˜ˆ: ArrayBuffer, MessagePort, ReadableStream, WritableStream, TransformStream, and so on. HTML Structured clone algorithmpostMessage() í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ê°ì²´ë¥¼ ì „ì†¡í•  ë•Œì—ëŠ” structured clone algorithmë¥¼ ì´ í˜¸ì¶œë©ë‹ˆë‹¤. ì´ ì•Œê³ ë¦¬ì¦˜ì´ ì§€ì›í•˜ëŠ” ê°ì²´ëŠ” ì¼ë°˜ ë°˜ ê°ì²´ë¡œ í•œì •í•˜ì—¬ ì²˜ë¦¬í•˜ë©°, ì‚¬ìš©ìê°€ ë³„ë„ë¡œ ì •ì˜í•œ Classì™€ ê°™ì€ ê°ì²´ëŠ” ì „ì†¡ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Transferable in Node.jsì´ ì•Œê³ ë¦¬ì¦˜ì„ ë”°ë¼ ì¼ê´€ëœ í˜•ì‹ìœ¼ë¡œ ê°ì²´ë¥¼ ì „ì†¡ ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ì‚¬ìš©ì ì •ì˜ ê°ì²´ë¥¼ Host Objectë¡œ ì·¨ê¸‰ë˜ê²Œ í•´ì•¼ í•©ë‹ˆë‹¤. ê°ì²´ê°€ Host Objectë¡œ ì¸ì‹ë˜ë©´ V8 ì—”ì§„ì€ ì‚¬ìš©ìê°€ ì œê³µí•œ Serialize&#x2F;Deserialize ëŒ€ë¦¬ìë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ë¬¸ì œëŠ” Native ê³„ì¸µì—ì„œëŠ” ê°ì²´ë¥¼ Host Objectë¡œ ì¸ì‹ì‹œí‚¤ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ì§€ë§Œ, JavaScript ê³„ì¸µì—ì„œëŠ” ì´ë¥¼ ìˆ˜í–‰í•  ë°©ë²•ì´ ì—†ì—ˆìŠµë‹ˆë‹¤. ì´ì— ë”°ë¼, Native ì¸µì—ì„œ JSTransferable í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ì´ë¥¼ JavaScript ê°ì²´ í”„ë¡œí† íƒ€ì… ì²´ì¸ì˜ ìƒìœ„ì— ë“±ë¡í•˜ì—¬ Host Objectë¡œ ì¸ì‹ë˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  í•´ë‹¹ í´ë˜ìŠ¤ì— Private Symbol ([kTransfer], [kClone], [kDeserialize])ì„ ì´ìš©í•œ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ì—¬ Serialize ë° Deserialize ì‘ì—…ì´ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ëŒ€ë¦¬ìë¡œ í˜¸ì¶œë˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ë˜ ë‹¤ë¥¸ ë¬¸ì œëŠ” WritableStream ë° ReadableStreamê³¼ ê°™ì€ Web APIê°€ í‘œì¤€ì—ì„œ ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ë„ë¡ ì •ì˜ë˜ì–´ ìˆì§€ ì•Šì•„, JSTransferableë¡œ ì´ëŸ¬í•œ í´ë˜ìŠ¤ë¥¼ í™•ì¥í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ makeTransferableì´ë¼ëŠ” ì¼ì¢…ì˜ í•´í‚¹ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì† ê´€ê³„ë¥¼ ì¡°ì‘í–ˆìŠµë‹ˆë‹¤. ì´ ë°©ì‹ì€ í‘œì¤€ì„ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì´ê¸´ í•˜ì§€ë§Œ, ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë  ë•Œë§ˆë‹¤ makeTransferable í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ ì¸¡ë©´ì—ì„œëŠ” ì¢‹ì§€ ì•Šì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 12345678910111213141516function makeTransferable(obj) &#123; // If the object is already transferable, skip all this. if (obj instanceof JSTransferable) return obj; const inst = ReflectConstruct(JSTransferable, [], obj.constructor); const properties = ObjectGetOwnPropertyDescriptors(obj); const propertiesValues = ObjectValues(properties); for (let i = 0; i &lt; propertiesValues.length; i++) &#123; // We want to use null-prototype objects to not rely on globally mutable // %Object.prototype%. ObjectSetPrototypeOf(propertiesValues[i], null); &#125; ObjectDefineProperties(inst, properties); ObjectSetPrototypeOf(inst, ObjectGetPrototypeOf(obj)); return inst;&#125; ìƒˆë¡œìš´ ë°©ë²•markTransferModeì•ì—ì„œ ì–¸ê¸‰í•œ ì„±ëŠ¥ ë¬¸ì œë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ íŒ¨ì¹˜ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. JavaScript ê°ì²´ì— ëŒ€í•´ì„œë„ Host Objectë¡œ ì¸ì‹í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•´ transfer_mode_private_symbolì„ ì´ìš©í•˜ëŠ” ë°©ë²•ì´ ë„ì…ë˜ì—ˆìŠµë‹ˆë‹¤. ë˜í•œ, V8 ì—”ì§„ì—ì„œ ê¸°ì¡´ì— Host Objectë¥¼ íŒë‹¨í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ EmbedderFieldCountë¥¼ í™•ì¸í•˜ë˜ ê²ƒì„ ëª…ì‹œì ìœ¼ë¡œ íŒë‹¨í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•´ IsHostObject() ì¸í„°í˜ì´ìŠ¤ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// node/lib/internal/worker/js_transferable.js/** * Mark an object as being transferable or customized cloneable in * `.postMessage()`. * This should only applied to host objects like Web API interfaces, Node.js&#x27; * built-in objects. * Objects marked as cloneable and transferable should implement the method * `@@kClone` and `@@kTransfer` respectively. Method `@@kDeserialize` is * required to deserialize the data to a new instance. * * Example implementation of a cloneable interface (assuming its located in * `internal/my_interface.js`): * * ``` * class MyInterface &#123; * constructor(...args) &#123; * markTransferMode(this, true); // &lt;-- * this.args = args; * &#125; * [kDeserialize](data) &#123; * this.args = data.args; * &#125; * [kClone]() &#123; * return &#123; * data: &#123; args: this.args &#125;, * deserializeInfo: &#x27;internal/my_interface:MyInterface&#x27;, * &#125; * &#125; * &#125; * * module.exports = &#123; * MyInterface, * &#125;; * ``` * @param &#123;object&#125; obj Host objects that can be either cloned or transferred. * @param &#123;boolean&#125; [cloneable] if the object can be cloned and `@@kClone` is * implemented. * @param &#123;boolean&#125; [transferable] if the object can be transferred and * `@@kTransfer` is implemented. */function markTransferMode(obj, cloneable = false, transferable = false) &#123; if ((typeof obj !== &#x27;object&#x27; &amp;&amp; typeof obj !== &#x27;function&#x27;) || obj === null) return; // This object is a primitive and therefore already untransferable. let mode = kDisallowCloneAndTransfer; if (cloneable) mode |= kCloneable; if (transferable) mode |= kTransferable; obj[transfer_mode_private_symbol] = mode; // &lt;--&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879// src/node_messaging.cc// staticbool JSTransferable::IsJSTransferable(Environment* env, v8::Local&lt;v8::Context&gt; context, v8::Local&lt;v8::Object&gt; object) &#123; return object-&gt;HasPrivate(context, env-&gt;transfer_mode_private_symbol()) // &lt;-- .ToChecked();&#125;// Provide a wrapper class created when a built-in JS classes that being// transferable or cloneable by postMessage().// See e.g. FileHandle in internal/fs/promises.js for an example.class JSTransferable : public BaseObject &#123; public: static JSTransferable* Wrap(Environment* env, v8::Local&lt;v8::Object&gt; target); static bool IsJSTransferable(Environment* env, v8::Local&lt;v8::Context&gt; context, v8::Local&lt;v8::Object&gt; object);&#125;// This tells V8 how to serialize objects that it does not understand// (e.g. C++ objects) into the output buffer, in a way that our own// DeserializerDelegate understands how to unpack.class SerializerDelegate : public ValueSerializer::Delegate &#123; ... bool HasCustomHostObject(Isolate* isolate) override &#123; return true; &#125; Maybe&lt;bool&gt; IsHostObject(Isolate* isolate, Local&lt;Object&gt; object) override &#123; if (BaseObject::IsBaseObject(object)) &#123; return Just(true); &#125; return Just(JSTransferable::IsJSTransferable(env_, context_, object)); // &lt;-- &#125; Maybe&lt;bool&gt; WriteHostObject(Isolate* isolate, Local&lt;Object&gt; object) override &#123; if (BaseObject::IsBaseObject(object)) &#123; return WriteHostObject( BaseObjectPtr&lt;BaseObject&gt; &#123; Unwrap&lt;BaseObject&gt;(object) &#125;); &#125; if (JSTransferable::IsJSTransferable(env_, context_, object)) &#123; JSTransferable* js_transferable = JSTransferable::Wrap(env_, object); return WriteHostObject(BaseObjectPtr&lt;BaseObject&gt;&#123;js_transferable&#125;); &#125; ... &#125;&#125;// This is used to tell V8 how to read transferred host objects, like other// `MessagePort`s and `SharedArrayBuffer`s, and make new JS objects out of them.class DeserializerDelegate : public ValueDeserializer::Delegate &#123; ... MaybeLocal&lt;Object&gt; ReadHostObject(Isolate* isolate) override &#123; // Identifying the index in the message&#x27;s BaseObject array is sufficient. uint32_t id; if (!deserializer-&gt;ReadUint32(&amp;id)) return MaybeLocal&lt;Object&gt;(); if (id != kNormalObject) &#123; CHECK_LT(id, host_objects_.size()); Local&lt;Object&gt; object = host_objects_[id]-&gt;object(isolate); if (env_-&gt;js_transferable_constructor_template()-&gt;HasInstance(object)) &#123; return Unwrap&lt;JSTransferable&gt;(object)-&gt;target(); &#125; else &#123; return object; &#125; &#125; ... &#125;&#125; V812345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697// deps/v8/include/v8-value-serializer.h/** * Value serialization compatible with the HTML structured clone algorithm. * The format is backward-compatible (i.e. safe to store to disk). */class V8_EXPORT ValueSerializer &#123; /** * The embedder overrides this method to enable custom host object filter * with Delegate::IsHostObject. * * This method is called at most once per serializer. */ virtual bool HasCustomHostObject(Isolate* isolate); /** * The embedder overrides this method to determine if an JS object is a * host object and needs to be serialized by the host. */ virtual Maybe&lt;bool&gt; IsHostObject(Isolate* isolate, Local&lt;Object&gt; object);&#125;;// deps/v8/src/api/api.ccbool ValueSerializer::Delegate::HasCustomHostObject(Isolate* v8_isolate) &#123; return false;&#125;Maybe&lt;bool&gt; ValueSerializer::Delegate::IsHostObject(Isolate* v8_isolate, Local&lt;Object&gt; object) &#123; i::Isolate* i_isolate = reinterpret_cast&lt;i::Isolate*&gt;(v8_isolate); i::Handle&lt;i::JSObject&gt; js_object = i::Handle&lt;i::JSObject&gt;::cast(Utils::OpenHandle(*object)); return Just&lt;bool&gt;( i::JSObject::GetEmbedderFieldCount(js_object-&gt;map(i_isolate)));&#125;// deps/v8/src/objects/value-serializer.ccValueSerializer::ValueSerializer(Isolate* isolate, v8::ValueSerializer::Delegate* delegate) : isolate_(isolate), delegate_(delegate), zone_(isolate-&gt;allocator(), ZONE_NAME), id_map_(isolate-&gt;heap(), ZoneAllocationPolicy(&amp;zone_)), array_buffer_transfer_map_(isolate-&gt;heap(), ZoneAllocationPolicy(&amp;zone_)) &#123; if (delegate_) &#123; v8::Isolate* v8_isolate = reinterpret_cast&lt;v8::Isolate*&gt;(isolate_); has_custom_host_objects_ = delegate_-&gt;HasCustomHostObject(v8_isolate); &#125;&#125;// ì´ì „ì— Host Objectë¥¼ êµ¬ë³„í•˜ëŠ” ë°©ë²•ì´ EmbedderFieldCountë¥¼ í™•ì¸í•˜ëŠ” ë°©ë²•ì´ì—ˆë‹¤ë©´// ëª…ì‹œì ìœ¼ë¡œ ì´ë¥¼ í™•ì¸í•˜ëŠ” ë°©ë²•ì„ ì¶”ê°€í•˜ì˜€ë‹¤.Maybe&lt;bool&gt; ValueSerializer::WriteJSReceiver(Handle&lt;JSReceiver&gt; receiver) &#123; ... HandleScope scope(isolate_); switch (instance_type) &#123; case JS_ARRAY_TYPE: return WriteJSArray(Handle&lt;JSArray&gt;::cast(receiver)); ... case JS_API_OBJECT_TYPE: &#123; Handle&lt;JSObject&gt; js_object = Handle&lt;JSObject&gt;::cast(receiver); // if (JSObject::GetEmbedderFieldCount(js_object-&gt;map(isolate_))) &#123; // - Maybe&lt;bool&gt; is_host_object = IsHostObject(js_object); // + if (is_host_object.IsNothing()) &#123; // + return is_host_object; // + &#125; // + if (is_host_object.FromJust()) &#123; // + return WriteHostObject(js_object); &#125; else &#123; return WriteJSObject(js_object); &#125; &#125; &#125;&#125;Maybe&lt;bool&gt; ValueSerializer::IsHostObject(Handle&lt;JSObject&gt; js_object) &#123; if (!has_custom_host_objects_) &#123; return Just&lt;bool&gt;( JSObject::GetEmbedderFieldCount(js_object-&gt;map(isolate_))); &#125; DCHECK_NOT_NULL(delegate_); v8::Isolate* v8_isolate = reinterpret_cast&lt;v8::Isolate*&gt;(isolate_); Maybe&lt;bool&gt; result = delegate_-&gt;IsHostObject(v8_isolate, Utils::ToLocal(js_object)); // &lt;-- RETURN_VALUE_IF_SCHEDULED_EXCEPTION(isolate_, Nothing&lt;bool&gt;()); DCHECK(!result.IsNothing()); if (V8_UNLIKELY(out_of_memory_)) return ThrowIfOutOfMemory(); return result;&#125; References make JSTransferables based on private symbols Userland transferable&#x2F;cloneable objects makeTransferable https://github.com/nodejs/performance/issues/82#issuecomment-1613378037 https://developer.chrome.com/blog/transferable-objects-lightning-fast/","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[{"name":"node.js","slug":"node-js","permalink":"https://llnm.github.io/tags/node-js/"}]},{"title":"Automated semantic versioning based on commits.","slug":"article-2023-07-16-automated-semver","date":"2023-07-15T15:00:00.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-07-16-automated-semver/","link":"","permalink":"https://llnm.github.io/article/2023-07-16-automated-semver/","excerpt":"","text":"I wondered if there was a way to automatically update the patch version of SemVer when a commit is made. I tried to make it using the commit hook in python. Create a version.py file with a variable to store the version: 12# version.py__version__ = &#x27;0.1.0&#x27; Add a pre-commit hook script that updates the version in the version.py file: 12345678910111213141516# .git/hooks/pre-commit#!/bin/bash# Get the current version from version.pyVERSION=$(sed -nE &#x27;s/^__version__ = (\\x27|\\&quot;)(.*)\\1$/\\2/p&#x27; version.py)# Increment the patch numberPATCH=$(echo $VERSION | awk -F. &#x27;&#123;print $3&#125;&#x27;)NEW_PATCH=$(expr $PATCH + 1)NEW_VERSION=$(echo $VERSION | awk -F. -v new_patch=&quot;$NEW_PATCH&quot; &#x27;&#123;$3=new_patch; OFS=&quot;.&quot;; print $1,$2,$3&#125;&#x27;)# Update the version in version.pysed -i &#x27;&#x27; -E &quot;s/^__version__ = (\\x27|\\&quot;).*(\\x27|\\&quot;)/__version__ = \\&#x27;$NEW_VERSION\\&#x27;/&quot; version.py# Stage the updated version.py file for commitgit add version.py This script gets the current version number from the version.py file, increments the patch number, updates the version in version.py, and stages the file for commit. Make the pre-commit hook script executable: 1chmod +x .git/hooks/pre-commit Now, when you make a commit, the pre-commit hook script will automatically update the version in version.py. You can use the __version__ variable in your Python code to refer to the current version number. For example: 1234# main.pyimport versionprint(&#x27;MyApp version &#123;&#125;&#x27;.format(version.__version__)) This will output MyApp version 0.1.1 if the latest commit incremented the patch number.","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[{"name":"python","slug":"python","permalink":"https://llnm.github.io/tags/python/"}]},{"title":"Linux I/O ì„±ëŠ¥ í˜ì‹  - io_uring","slug":"article-2023-07-14-io-uring","date":"2023-07-13T15:00:00.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-07-14-io-uring/","link":"","permalink":"https://llnm.github.io/article/2023-07-14-io-uring/","excerpt":"","text":"2019ë…„ì— ì†Œê°œëœ io_uringì€ Linux ì»¤ë„ì„ ìœ„í•œ ë¹„ë™ê¸° I&#x2F;O ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤. ê¸°ì¡´ ì¸í„°í˜ì´ìŠ¤ì¸ epoll&#x2F;kqueueì™€ aio ëŒ€ë¹„í•˜ì—¬ ë›°ì–´ë‚œ ì„±ëŠ¥ê³¼ ê°„ê²°í•˜ê³  ì§ê´€ì ì¸ API ì‚¬ìš©ì„±ì„ ì œê³µí•©ë‹ˆë‹¤. io_uringì€ ë¹„ë™ê¸° I&#x2F;O, ì‹œìŠ¤í…œ ì½œì˜ ë‹¤ì¤‘ ë°°ì¹˜ ì²˜ë¦¬, ìœ ì—°í•œ ë²„í¼ ê´€ë¦¬ ë“±ì„ í†µí•´ Linux I&#x2F;O ëª¨ë¸ì˜ ì¤‘ìš”í•œ ë°œì „ ì¤‘ í•˜ë‚˜ë¡œ ì¸ì •ë°›ê³  ìˆìŠµë‹ˆë‹¤. ì£¼ìš” íŠ¹ì§•ë™ì‘ ì›ë¦¬io_uringì€ ì‚¬ìš©ìì™€ ì»¤ë„ ê°„ì˜ ê³µìœ  ë©”ëª¨ë¦¬ ë‚´ì— ì›í˜• í (queue rings)ë¥¼ í™œìš©í•©ë‹ˆë‹¤. ì œì¶œí (Submission Queue)ì™€ ì™„ë£Œí (Completion Queue)ë¡œ êµ¬ì„±ëœ ì´ëŸ¬í•œ íë¥¼ í†µí•´ ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ê°œì˜ I&#x2F;O ì‘ì—…ì„ ìŠ¤ì¼€ì¤„ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì»¤ë„ì€ ìŠ¤ì¼€ì¤„ëœ ì‘ì—…ì„ ì²˜ë¦¬í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ì™„ë£Œíì— ë°˜í™˜í•˜ì—¬ ì‚¬ìš©ìê°€ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. ìš°ìˆ˜í•œ ì„±ëŠ¥io_uringì€ ì‚¬ìš©ìì™€ ì»¤ë„ ê°„ì˜ ê³µìœ  ë©”ëª¨ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ Zero-Copy I&#x2F;Oë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ë˜í•œ ì‚¬ìš©ìê°€ I&#x2F;O ì‘ì—…ì„ ìŠ¤ì¼€ì¤„ë§í•  ë•Œ í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ì»¤ë„ì— ì „ë‹¬í•˜ê³  ì»¤ë„ ë‚´ì—ì„œ ì‘ì—… ì™„ë£Œë¥¼ ê´€ë¦¬í•¨ìœ¼ë¡œì¨ ì¶”ê°€ì ì¸ ì‚¬ìš©ì&#x2F;ì»¤ë„ ê°„ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­(context switching)ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤. ì´ë¡œì¨ ì „í†µì ì¸ ë™ê¸° I&#x2F;Oì— ë¹„í•´ ë” ë‚®ì€ ì˜¤ë²„í—¤ë“œë¥¼ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤. ê°„ê²°í•œ ì¸í„°í˜ì´ìŠ¤ê¸°ì¡´ì˜ epollì—ì„œëŠ” ì—¬ëŸ¬ ê°œì˜ ì…ì¶œë ¥ ì‘ì—…(multiplexing)ì„ ìœ„í•´ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ì˜ ìƒíƒœë¥¼ í•„í„°ë§í•´ì•¼ í–ˆìŠµë‹ˆë‹¤. ë°˜ë©´ io_uringì€ ë” ê°„ê²°í•œ ì‚¬ìš© ë°©ì‹ì„ ì œê³µí•©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” io_uring_enter() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì‹œìŠ¤í…œ ì½œì„ ì»¤ë„ì— ìŠ¤ì¼€ì¤„ë§í•˜ê³  ê²°ê³¼ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë°©ì‹ì€ Pollingê³¼ Interrupt-driven I&#x2F;Oë¥¼ ëª¨ë‘ ì§€ì›í•©ë‹ˆë‹¤. epollì„ ì‚¬ìš©í•œ ì„¤ì •123456789101112131415161718...int epoll_fd = epoll_create1(0);struct epoll_event event;event.events = EPOLLIN; // ì½ê¸° ì´ë²¤íŠ¸ ì„¤ì •event.data.fd = sockfd; // ê´€ì‹¬ ìˆëŠ” íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì„¤ì •epoll_ctl(epoll_fd, EPOLL_CTL_ADD, sockfd, &amp;event);struct epoll_event events[MAX_EVENTS];int ready_fds = epoll_wait(epoll_fd, events, MAX_EVENTS, timeout);for (int i = 0; i &lt; ready_fds; i++) &#123; int fd = events[i].data.fd; if (events[i].events &amp; EPOLLIN) &#123; // ì½ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬ // ... &#125;&#125; io_uringì„ ì‚¬ìš©í•œ ì„¤ì •123456789101112131415161718192021#include &lt;liburing.h&gt;...struct io_uring ring;io_uring_queue_init(QUEUE_DEPTH, &amp;ring, 0);struct io_uring_sqe *sqe = io_uring_get_sqe(&amp;ring);io_uring_prep_read(sqe, sockfd, buf, buflen, offset);io_uring_submit(&amp;ring);struct io_uring_cqe *cqe;int ret = io_uring_wait_cqe(&amp;ring, &amp;cqe);if (ret &gt;= 0) &#123; if (cqe-&gt;res &gt;= 0) &#123; // ì„±ê³µ &#125; else &#123; // ì—ëŸ¬ &#125; io_uring_cqe_seen(&amp;ring, cqe);&#125; ìƒê°libuvì—ì„œë„ io uring APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” íŒŒì¼ ì—°ì‚°ì— í•œì •ë˜ì–´ ìˆì§€ë§Œ, io_uringì„ ì§€ì›í•˜ëŠ” ì»¤ë„ì˜ ê²½ìš° íŒŒì¼ ì—°ì‚° ì²˜ë¦¬ëŸ‰ì´ ìµœëŒ€ 8ë°°ê¹Œì§€ ì¦ê°€í•˜ëŠ” ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. íŒŒì¼ ì—°ì‚°ì´ ë§ê±°ë‚˜ íŒŒì¼ê³¼ ë„¤íŠ¸ì›Œí¬ I&#x2F;O ì›Œí¬ë¡œë“œê°€ í˜¼í•©ëœ ì‹œìŠ¤í…œì—ì„œëŠ” io_uringì˜ ì‚¬ìš©ìœ¼ë¡œ ë¹„ì•½ì ì¸ ì„±ëŠ¥ í–¥ìƒì´ ê°€ëŠ¥í•  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ì ì¬ë ¥ì„ ê³ ë ¤í•˜ì—¬ io_uringì„ í™œìš©í•˜ëŠ” ê²ƒì´ ìœ ìš©í•  ê²ƒì…ë‹ˆë‹¤. References deps: upgrade to libuv 1.46.0 New kernel polling interface for Linux 4.18 (io_uring)?","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[{"name":"node.js","slug":"node-js","permalink":"https://llnm.github.io/tags/node-js/"}]},{"title":"Node.js í™œìš© ì‚¬ë¡€ - Netflix","slug":"article-2023-07-07-nodejs-usecase-netflix","date":"2023-07-07T01:31:10.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"article/2023-07-07-nodejs-usecase-netflix/","link":"","permalink":"https://llnm.github.io/article/2023-07-07-nodejs-usecase-netflix/","excerpt":"","text":"2009ë…„ Node.jsê°€ ë“±ì¥í•œ ì´ë˜ Node.jsëŠ” í˜„ëŒ€ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì—ì„œ ë§¤ìš° ì¤‘ìš”í•œ ì—­í• ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬í•œ ì—­í• ì€ ì‚°ì—… ì „ë°˜ì˜ ë‹¤ì–‘í•œ í™œìš© ì‚¬ë¡€ë¥¼ í†µí•´ ì…ì¦ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê¸€ì€ ê·¸ í™œìš© ì‚¬ë¡€ì¤‘ í•œ ë„ì… ì‚¬ë¡€ë¥¼ í•œ ë°œ ë” ê¹Šì´ ì—°êµ¬í•´ë´…ë‹ˆë‹¤. ë¬´ì—‡ì´ ë¬¸ì œì˜€ëŠ”ì§€, ê·¸ë¦¬ê³  ê·¸ ë¬¸ì œ í•´ê²°ì— ì–´ë–»ê²Œ ë„ì›€ì´ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ ë´„ìœ¼ë¡œì„œ Node.jsì˜ ê°€ì¹˜ë¥¼ ì¢€ ë” ê°€ëŠ í•´ ë³´ë ¤í•©ë‹ˆë‹¤. ë°°ê²½ë„·í”Œë¦­ìŠ¤ëŠ” 2015ë…„ê²½ë¶€í„° ìì‚¬ì˜ ì•± ìŠ¤íƒì— Node.jsë¥¼ ì ìš©í•˜ëŠ”ë° ê·¸ ë‹¹ì‹œ NetflixëŠ” ì‚¬ìš©ì ì‚¬ìš© ì•±ì˜ &#39;ìµí„°ë™í‹°ë¸Œ ì‹œê°„&#39; (TTI: Time To Interactive) ë¥¼ ì¤„ì´ê³ ì í•˜ëŠ” ëª©í‘œë¥¼ ê°€ì§€ê³  ìˆì—ˆìŠµë‹ˆë‹¤. &#39;ìµí„°ë™í‹°ë¸Œ ì‹œê°„&#39; ì´ë€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ìµœì´ˆ ì‹œì‘ ì‹œì ë¶€í„° UI ê°€ ì‚¬ìš©ìì— ì˜í•´ ìƒí˜¸ì‘ìš©ì´ ê°€ëŠ¥í•œ ì‹œê°„ê¹Œì§€ì˜ ì²« ì‹œì ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ TTIë¼ëŠ” ì§€í‘œë¥¼ ì›í•˜ëŠ” ìˆ˜ì¹˜ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ê°œì„ ì— ì§‘ì¤‘í•œ ì˜ì—­ì€ ì•„ë˜ì™€ ê°™ì•˜ìŠµë‹ˆë‹¤. ì„œë²„ ëœë”ë§ - í´ë¼ì´ì–¸íŠ¸ ë Œë”ë§, ê·¸ë¦¬ê³  Universal Javascriptì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‘ì„±í• ë•Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íŠ¹ì„±ê³¼ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ì„œë²„ í˜¹ì€ í´ë¼ì´ì–¸íŠ¸ ë Œë”ë§ì„ ê³ ë ¤í•´ ì„¤ê³„í•©ë‹ˆë‹¤. ì„œë²„ ë Œë”ë§(Server-side rendering)ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ í™”ë©´ì„ êµ¬ì„±í•˜ëŠ” ëŒ€ì‹  ì„œë²„ì—ì„œ HTMLì„ ìƒì„±í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì œê³µí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì´ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ í™”ë©´ì„ ë™ì ìœ¼ë¡œ ë Œë”ë§í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë Œë”ë§(Client-side rendering)ê³¼ ëŒ€ì¡°ì ì¸ ë°©ë²•ì…ë‹ˆë‹¤. ì„œë²„ ë Œë”ë§ì€ ì„œë²„ ì¸¡ì—ì„œ ë§ˆí¬ì—…ì„ ìƒì„±í•˜ë¯€ë¡œ ì´ˆê¸° ë¡œë”© ì†ë„ê°€ ê°œì„ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ì´ˆê¸° í˜ì´ì§€ ë¡œë“œ í›„ì— ì¦‰ì‹œ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìœ¼ë©°, ê²€ìƒ‰ ì—”ì§„ ìµœì í™” (SEO)ì—ë„ ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ ë Œë”ë§ì€ JavaScriptë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì ì¸ UIë¥¼ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìƒí˜¸ì‘ìš©ì— ë”°ë¼ ì¦‰ê°ì ì¸ ì—…ë°ì´íŠ¸ì™€ ìƒíƒœ ë³€ê²½ì´ ê°€ëŠ¥í•˜ë©°, ë” ë‚˜ì€ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë²„ ë Œë”ë§, í´ë¼ì´ì–¸íŠ¸ ë Œë”ë§ì€ í”„ë¡œì íŠ¸ì˜ ëª©í‘œ, ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­, ê°œë°œì ê²½í—˜ ë° ìœ ì§€ ë³´ìˆ˜ ë“±ì„ ê³ ë ¤í•˜ì—¬ ê²°ì •í•´ì•¼í•˜ë‚˜ ë„·í”Œë¦­ìŠ¤ê°€ Node.js ë„ì…ì‹œ ê°€ì¡Œë˜ ë¬¸ì œëŠ” ì´ëŸ¬í•œ ì„œë²„ ë Œë”ë§ê³¼ í´ë¼ì´ì–¸íŠ¸ ë Œë”ë§ì„ ìœ ì—°í•˜ê²Œ ì„¤ê³„í•˜ëŠ” ê²ƒì´ ì–´ë ¤ì› ë˜ ê²ƒì´ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·¸ ì–´ë ¤ì›€ì˜ ê°€ì¥ í° ì´ìœ ê°€ ì–‘ì¸¡ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì–¸ì–´ê°€ ì„œë¡œ ë‹¤ë¥¸ ì ì´ì—ˆìŠµë‹ˆë‹¤. ë‘ ì–¸ì–´ë¥¼ ìƒí˜¸ ì „í™˜í•˜ëŠ” ë°ì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¹„ìš©ì„ ìˆ˜ë°˜í•˜ë©°, ë Œë”ë§ì„ ìœ ì—°í•˜ê¸° ìœ„í•´ ë§ˆí¬ì—…ì„ ê°œì„ í•˜ê¸° ìœ„í•´ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì™€ ë„ˆë¬´ ë§ì€ ì§ì ‘ì ì¸ ì»¤í”Œë§ì´ ë°œìƒí•©ë‹ˆë‹¤. ì´ì— ëŒ€í•œ ì—¬ëŸ¬ ì†”ë£¨ì…˜ì´ ìˆìœ¼ë‚˜ ì–‘ìª½ì´ ê°™ì€ ì–¸ì–´ë¥¼ ì‚¬ìš©í–ˆì„ë•Œ ì–¸ì–´ì˜ ë‹¤ë¦„ìœ¼ë¡œ ì¸í•´ ë Œë”ë§ ê²°ê³¼ì˜ ë¯¸ì„¸í•œ ì°¨ì´ê°€ ë°œìƒ í•  ìˆ˜ ìˆëŠ” ìˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í•˜ì˜€ìœ¼ë©° ì´ë¡œ ì¸í•´ ëª¨ë“  ë§ˆí¬ì—…ì´ ë™ì¼ ì–¸ì–´ì—ì„œ ì œê³µí•˜ëŠ” í•œ APIë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ì´ìƒì ì´ë‹¤ë¼ê³  íŒë‹¨í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. Monolithic ì•„í‚¤í…ì³ì—ì„œ Service ê¸°ë°˜ ì•„í‚¤í…ì³ë¡œMonolithic ì€ &quot;í•˜ë‚˜ë¡œ í†µí•©ëœ&quot; ì´ë¼ëŠ” ì˜ë¯¸ë¥¼ ê°€ì§€ë©°, ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë“  êµ¬ì„± ìš”ì†Œê°€ ë‹¨ì¼í•œ ì‹¤í–‰ ê°€ëŠ¥í•œ ë‹¨ìœ„ë¡œ êµ¬ì„±ë˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ë‹¨ì¼ ì½”ë“œë² ì´ìŠ¤ë¡œ êµ¬ì„±ë˜ë©°, ëª¨ë“  ê¸°ëŠ¥ê³¼ ì„œë¹„ìŠ¤ê°€ í•˜ë‚˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì— ì¡´ì¬í•©ë‹ˆë‹¤. NetflixëŠ” ê¸°ì¡´ ì•±ì€ Monolithic í•œ í˜•íƒœë¡œ ì„¤ê³„ë˜ì–´ ìˆì—ˆìœ¼ë©° [[Java EE]] (ìë°” ì—”í„°í”„ë¼ì´ì¦ˆ ì—ë””ì…˜) ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤. ì—”í„°í”„ë¼ì´ì¦ˆ ìë°”(Enterprise Java)ëŠ” ê¸°ì—… í™˜ê²½ì—ì„œ ëŒ€ê·œëª¨ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ê°œë°œí•˜ê³  êµ¬ì¶•í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ìë°” ê¸°ë°˜ì˜ ê¸°ìˆ ê³¼ í”Œë«í¼ì„ ê°€ë¦¬í‚µë‹ˆë‹¤. ì—”í„°í”„ë¼ì´ì¦ˆ ìë°”ëŠ” ìë°” ì—”í„°í”„ë¼ì´ì¦ˆ ì—ë””ì…˜(Java EE) ìŠ¤í™ì˜ ì¼ë¶€ë¡œ ì œê³µë˜ë©°, ê¸°ì—…ê¸‰ ì‹œìŠ¤í…œì—ì„œ ì•ˆì •ì„±, í™•ì¥ì„±, ë³´ì•ˆì„± ë“±ì˜ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±ì‹œí‚¤ê¸° ìœ„í•œ ë‹¤ì–‘í•œ ê¸°ëŠ¥ê³¼ ë„êµ¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ë˜ ìì²´ ë°ì´í„° ì„œë²„ë¥¼ ê°€ì§€ê³  ìˆì–´ ì„œë²„, ìŠ¤í† ë¦¬ì§€, ë„¤íŠ¸ì›Œí¬ ì¥ë¹„ ë“±ì„ ì§ì ‘ ê´€ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë°ì´í„° ì„œë²„ ìœ ì§€ ë° ìŠ¤ì¼€ì¼ë§ì— ëŒ€í•œ ê´€ë¦¬ ë¹„ìš©ì„ íš¨ìœ¨í™”í•˜ê³ ì, ì¸í„°ë„· ì»´í“¨í„° ë¦¬ì†ŒìŠ¤ì¸ í´ë¼ìš°ë“œë¥¼ í™œìš©í•˜ê¸°ë¡œ ê²°ì •í•˜ì˜€ìŠµë‹ˆë‹¤. Monolithic ì•„í‚¤í…ì²˜ëŠ” ì „ì²´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë‹¨ì¼ ë‹¨ìœ„ë¡œ ë°°í¬í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œëŠ” ê¸°ëŠ¥ì˜ ë…ë¦½ì ì¸ í™•ì¥ì´ ì–´ë µê³ , ì „ì²´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ í™•ì¥í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ì´ ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜ ê°œë°œ ë° ë°°í¬ê°€ ì–´ë µê³ , ì¥ì• ë°œìƒì‹œ íšŒë³µì‹œí‚¤ê±°ë‚˜ ì¥ì• ë¥¼ ê²©ë¦¬í•˜ê¸°ê°€ ì–´ë µìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì´ìœ ë¡œì¸í•´ NetflixëŠ” ê¸°ì¡´ì˜ Monolithic Java ì„œë¹„ìŠ¤ ì˜€ë˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë” ì‘ì€ ì§‘í•© (Microservice)ìœ¼ë¡œ í•´ì²´í•˜ê³ ì í•˜ì˜€ìŠµë‹ˆë‹¤. Node.js ì™€ React.jsìƒê¸° ë‘ ê°œì„  ì˜ì—­ì„ í•´ê²°í•˜ê³ ì ë„·í”Œë¦­ìŠ¤ëŠ” Node.jsì™€ React.jsë¥¼ ë„ì…í•˜ì˜€ìŠµë‹ˆë‹¤. Node.js ëŸ°íƒ€ì„ë‚´ React.jsë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì˜ ë Œë”ë§ ë¡œì§ì„ ê³µìœ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, React ì»´í¬ë„ŒíŠ¸ë¥¼ ì„œë²„ ì¸¡ì—ì„œ ë Œë”ë§í•˜ì—¬ ì´ˆê¸° ë§ˆí¬ì—…ì„ ìƒì„±í•œ í›„, í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°€ì ¸ì™€ ìƒí˜¸ì‘ìš©ì„ ì²˜ë¦¬í•˜ê³  ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ì— ë Œë”ë§ ë¡œì§ì„ ê³µìœ í•˜ì—¬ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê³  ê°œë°œ ìœ ì—°ì„±, ìƒì‚°ì„±ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜ Monolithic Java ì„œë¹„ìŠ¤ë¥¼ í•´ì²´í•˜ì—¬ êµ¬ë™í•˜ëŠ”ë° Node.jsë¥¼ í™œìš©í•˜ì˜€ëŠ”ë°, ê·¸ ì´ìœ ì¤‘ í•˜ë‚˜ëŠ” Node.js ê°€ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ êµ¬ì¶•ì— ì í•©í•œ ì†”ë£¨ì…˜ì´ì˜€ê¸° ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤. Node.jsëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œ ì´ë²¤íŠ¸ íë¡œ êµ¬ì„±ëœ &#39;Event-Driven&#39; ì•„í‚¤í…ì³ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ êµ¬ì¡°ëŠ” ë¹„ë™ê¸° I&#x2F;O ì²˜ë¦¬ë¥¼ ìœ„í•´ ë§ì€ ìˆ˜ì˜ ë™ì‹œ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë‚˜ ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ ìƒí˜¸ì‘ìš©ì„ ë‹¨ìˆœí™” í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Java ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ëŒ€ë¹„ ì‹œìŠ¤í…œ êµ¬ë™, í†µì‹ ë“±ì— ìˆì–´ ìì› ì‚¬ìš© ë° ì˜¤ë²„í—¤ë“œê°€ ì ë‹¤ëŠ” ê²ƒë„ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ê°„ ë¹ˆë²ˆí•œ ìƒí˜¸ì‘ìš©ê³¼ ë¹ ë¥¸ ì‘ë‹µì„±ì—ë„ ìœ ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤. ê²°ë¡ í™œìš©ì‚¬ë¡€ë¥¼ ì¡°ì‚¬í•´ë³´ë©° í•´ë‹¹ ê¸°ì—…ì´ Node.jsë¥¼ ë„ì…í•˜ê³ ì í–ˆë˜ ë¬¸ì œì™€ ê°€ì¹˜ë¥¼ ì¢€ ë” ì˜ ì´í•´í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë¹„ìŠ·í•œ ë¬¸ì œë¥¼ ê°€ì§„ í”„ë¡œì íŠ¸ì™€ ê¸°ì—…ì—ì„œë„ Node.jsë¥¼ ì†”ë£¨ì…˜ìœ¼ë¡œì„œ ê³ ë ¤í•´ ë³¼ ìˆ˜ ìˆì„ê²ƒ ì…ë‹ˆë‹¤. ë˜í•œ ì–´ë–¤ í•œ ì†”ë£¨ì…˜ì´ í”„ë¡œë•ì…˜ ë ˆë²¨ì˜ ê¸°ìˆ  ìŠ¤íƒìœ¼ë¡œ ì‚¬ìš©ë˜ê¸° ìœ„í•´ì„œëŠ” ì—¬ëŸ¬ ê°€ì§€ ì‹ ë¢°ì„±ê³¼ ê´€ë ¨ëœ ì˜ë¬¸ì„ í•´ê²°í•´ì•¼ í•˜ëŠ”ë°, ì¡°ì‚¬ë¥¼ í•˜ë©° Netflixë¥¼ ë¹„ë¡¯í•˜ì—¬ ì´ë¯¸ ë§ì€ íšŒì‚¬ì—ì„œ Node.jsë¥¼ ìì‚¬ ì„œë¹„ìŠ¤ êµ¬ì¡°ì˜ ì£¼ìš” ì¶•ìœ¼ë¡œì„œ ì„±ê³µì ìœ¼ë¡œ ì ìš©í•œ ì‚¬ë¡€ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” í˜„ì¬ Javascript ëŸ°íƒ€ì„ì´ ë‹¤ì–‘í•˜ê²Œ ë“±ì¥í•˜ê³  ìˆëŠ” ì‹œëŒ€ì— ìˆì–´ì„œ ì†”ë£¨ì…˜ ì„ íƒì— ìˆì–´ì„œ ì¤‘ìš”í•œ ì§€í‘œê°€ ë  ìˆ˜ ìˆë‹¤ê³  ìƒê°ë©ë‹ˆë‹¤. ì•„ë˜ ë‹¤ë¥¸ ì ìš© ì‚¬ë¡€ì— ëŒ€í•œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì²¨ë¶€í•©ë‹ˆë‹¤ NASA: https://openjsf.org/wp-content/uploads/sites/84/2020/02/Case_Study-Node.js-NASA.pdf Uber: https://www.uber.com/en-IN/blog/uber-tech-stack-part-two/ ebay: https://clinejj.medium.com/building-with-node-js-at-ebay-9bbdf7d79b82 Paypal: https://medium.com/paypal-tech/node-js-at-paypal-4e2d1d08ce4f","categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"}],"tags":[{"name":"node.js","slug":"node-js","permalink":"https://llnm.github.io/tags/node-js/"}]},{"title":"ChatGPT","slug":"talk-2023-07-03-chatgpt","date":"2023-07-02T15:00:00.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"talk/2023-07-03-chatgpt/","link":"","permalink":"https://llnm.github.io/talk/2023-07-03-chatgpt/","excerpt":"","text":"ìµœê·¼ ChatGPTê°€ ë„ˆë¬´ë‚˜ ì¶©ê²©ì ì´ì–´ì„œ ë‚˜ì˜ ì–¸ì–´ë¡œ ì´ê²ƒì´ ë¬´ì—‡ì¸ì§€ ê¸°ìˆ í•´ë³´ê¸°ë¡œ í–ˆë‹¤. ì•„ë˜ëŠ” ë‚´ê°€ ì •ë¦¬í•´ë³¸ ë‚´ìš©ì´ë‹¤. ChatGPTëŠ” OpenAIì—ì„œ ê°œë°œí•œ ëŒ€í™”í˜• ì¸ê³µì§€ëŠ¥ ëª¨ë¸ì¸ GPTë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì±—ë´‡ì…ë‹ˆë‹¤. GPT ëª¨ë¸ì€ ìì—°ì–´ ì²˜ë¦¬ ê¸°ìˆ ì„ í™œìš©í•˜ì—¬ ë‹¤ì–‘í•œ ì–¸ì–´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, ê·¸ ì¤‘ì—ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” ë˜í•œ í¬í•¨ëœë‹¤. í˜„ì¬ ìµœì‹  ëª¨ë¸ì€ GPT-4ì´ë‹¤. ì´ ëª¨ë¸ì„ í•™ìŠµì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” ë§ì€ ì–‘ì˜ í…ìŠ¤íŠ¸ ë°ì´í„°ê°€ í•„ìš”í•˜ë‹¤. ì´ëŸ¬í•œ ë°ì´í„°ëŠ” ì¸í„°ë„·ì—ì„œ ìˆ˜ì§‘ëœ ëŒ€í™”, ì†Œì„¤, ë‰´ìŠ¤ ê¸°ì‚¬, ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ë“±ì„ í¬í•¨í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ëŠ” ì—†ê³  ë°ì´í„°ë¥¼ ëª¨ë¸ í•™ìŠµì— ìš©ì´í•˜ë„ë¡ ê°€ê³µí•˜ê³  ë³€í™˜í•´ì•¼í•œë‹¤. ê·¸ í›„ì— ëª¨ë¸ì€ ì´ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ì…ë ¥ìœ¼ë¡œ í™œìš©í•˜ì—¬ ë°˜ë³µì ìœ¼ë¡œ í•™ìŠµì‹œí‚¨ë‹¤. ì—¬ê¸°ì„œ í•™ìŠµì€ ëª¨ë¸ì´ ì…ë ¥ê³¼ ì¶œë ¥ ê°„ì˜ ê´€ê³„ë¥¼ í•™ìŠµí•˜ì—¬ ì£¼ì–´ì§„ ì…ë ¥ì— ëŒ€í•œ ì ì ˆí•œ ì¶œë ¥ì„ ìƒì„±í•˜ë„ë¡ ì¡°ì •í•˜ëŠ” ê³¼ì •ì„ ì˜ë¯¸í•œë‹¤. ëª¨ë¸ì€ ì´ì „ ë¬¸ì¥ì„ ë¶„ì„í•˜ì—¬ ë§¥ë½ì„ ì´í•´í•˜ê³ , ê·¸ì— ê¸°ë°˜í•˜ì—¬ ë¬¸ì¥ì„ ìƒì„±í•˜ëŠ”ë°, ìƒì„±ëœ ë¬¸ì¥ì˜ ì˜¤ë¥˜ë¥¼ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ ëª¨ë¸ì€ ì§€ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ë©°, ì´ëŸ¬í•œ ê³¼ì •ì—ì„œ ëŒ€ìš©ëŸ‰ì˜ ë°ì´í„°ê°€ í™œìš©ëœë‹¤. í•™ìŠµì´ ì–´ë ¤ìš´ ê²½ìš°ì—ëŠ” ì¸ê°„ì˜ ì§€ì‹ê³¼ ê²½í—˜ì„ í™œìš©í•˜ì—¬ ëª¨ë¸ì˜ ì„±ëŠ¥ì„ ê°œì„ í•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ê°•í™”í•™ìŠµ(RLHF)ì„ í™œìš©í•˜ê¸°ë„ í•œë‹¤. ê·¸ëŸ¬ë‚˜ ëŒ€ë¶€ë¶„ì˜ ê²½ìš° GPT ëª¨ë¸ì€ ì§€ë„í•™ìŠµì„ ê¸°ë°˜ìœ¼ë¡œ í•™ìŠµëœë‹¤. ê°•í™”í•™ìŠµ: ëª¨ë¸ì´ ìƒì„±í•œ ë¬¸ì¥ì„ í‰ê°€í•˜ê³  ìì—°ìŠ¤ëŸ¬ì›€ì´ë‚˜ ì˜ë¯¸ì  ì¼ê´€ì„±ê³¼ ê°™ì€ ì¸¡ë©´ì—ì„œ í‰ê°€ ì ìˆ˜ë¥¼ ë¶€ì—¬. í‰ê°€ ì ìˆ˜ëŠ” ëª¨ë¸ì´ ë³´ìƒìœ¼ë¡œ ë°›ê²Œ ë˜ë©°, ëª¨ë¸ì€ ì´ ë³´ìƒì„ ìµœëŒ€í™”í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ë¬¸ì¥ ìƒì„±ì„ ì¡°ì •. ì§€ë„í•™ìŠµ: ì…ë ¥ê³¼ ê·¸ì— ëŒ€ì‘í•˜ëŠ” ì¶œë ¥ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ í•™ìŠµí•˜ëŠ” ë°©ë²•ìœ¼ë¡œ, ì£¼ì–´ì§„ ì…ë ¥ ë°ì´í„°ì™€ ê·¸ì— ëŒ€í•œ ì •ë‹µ(ë¼ë²¨)ì„ í™œìš©í•˜ì—¬ ëª¨ë¸ì„ í›ˆë ¨ì‹œí‚¤ëŠ” í”„ë¡œì„¸ìŠ¤. ChatGPTëŠ” ë‹¤ì–‘í•œ ë¶„ì•¼ì—ì„œ í™œìš©ë  ìˆ˜ ìˆë‹¤. íŠ¹íˆ ìì—°ì–´ ì²˜ë¦¬ ë¶„ì•¼ì—ì„œ ë›°ì–´ë‚œ ì„±ëŠ¥ì„ ë°œíœ˜í•˜ì—¬ ê°€ìƒ ë¹„ì„œì™€ ê°™ì€ ì±—ë´‡ì„ ê°œë°œí•˜ëŠ” ë° ë§¤ìš° ì í•©í•˜ë‹¤. ë˜í•œ ë‰´ìŠ¤ ê¸°ì‚¬ ìš”ì•½, ë¬¸ì„œ ìƒì„±, ì–¸ì–´ ë²ˆì—­, ì½”ë”© ë“± ë‹¤ì–‘í•œ ìì—°ì–´ ê´€ë ¨ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°ì—ë„ í™œìš©ë  ìˆ˜ ìˆë‹¤.","categories":[{"name":"talk","slug":"talk","permalink":"https://llnm.github.io/categories/talk/"}],"tags":[{"name":"ai","slug":"ai","permalink":"https://llnm.github.io/tags/ai/"}]},{"title":"Blog ë§Œë“¤ë©° í™•ì¸í•œ ê²ƒë“¤","slug":"talk-2023-07-01-things-about-blogging","date":"2023-07-01T03:49:02.000Z","updated":"2023-11-29T13:01:56.524Z","comments":true,"path":"talk/2023-07-01-things-about-blogging/","link":"","permalink":"https://llnm.github.io/talk/2023-07-01-things-about-blogging/","excerpt":"","text":"í•„ìš”í•œ ìë£Œë‚˜ ìƒê°ì„ ì •ë¦¬í•˜ëŠ” ê²ƒì€ ê°œì¸ì ìœ¼ë¡œ obsidianì„ ì´ìš©í•˜ê³  ìˆë‹¤. ëŒ€ë¶€ë¶„ì€ ì •ë¦¬ì— ê·¸ì¹˜ê³  ìˆê³  íŠ¹ë³„íˆ ì •ì œëœ í¬ë§·ì˜ ê¸€ë¡œ ì‘ì„±í•´ë³¸ ì ì€ ì—†ì—ˆë‹¤. ë§ˆì¹¨ ê¸°ìˆ  ë¸”ë¡œê·¸ê°€ í•„ìš”í•  ìˆ˜ë„ ìˆëŠ” ì‘ì€ ì·¨ë¯¸ ìƒí™œì„ í•˜ê²Œë˜ì–´ ì´ë²ˆ ê¸°íšŒì— í•˜ë‚˜ ë§Œë“¤ì–´ë³´ë ¤ í–ˆë‹¤. ì œì•½ì‚¬í•­ì€ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í–ˆë‹¤. í˜¸ìŠ¤íŒ…ì€ Github pageë¥¼ ì‚¬ìš©í•œë‹¤. Static Sites Rendering íˆ´ì„ ì‚¬ìš©í•œë‹¤. 2.1. ì»¨í…ì¸  ê°±ì‹ ì„ ì‰½ê²Œí•œë‹¤. 2.2. ë ˆì´ì•„ì›ƒ, ìŠ¤íƒ€ì¼ ë³€ê²½ì„ í†µí•´ ì•½ê°„ì˜ ì‚¬ì´íŠ¸ ê°œì¸í™”ê°€ ê°€ëŠ¥í•˜ë‹¤. Jekyll2.1, 2.2ë¥¼ ìœ„í•œ í›„ë³´ë¡œ Jekyllì„ ìƒê°í–ˆë‹¤. ì¥ì ì€ Githubì—ì„œ Jekyllê¸°ë°˜ ë Œë”ë§ì„ ì§€ì›í•˜ë‹ˆ ë³„ë„ì˜ Local Jekyll ì„œë²„ë¥¼ ë‘ì§€ ì•Šì•„ë„ ë Œë”ë§ì´ ê°€ëŠ¥í•˜ë‹¤. ê·¸ëŸ¬ë‚˜ 2.2ë¥¼ ìœ„í•´ ìˆ˜ì •ë•Œë§ˆë‹¤ ë§¤ë²ˆ deployë¥¼ í•´ì•¼í•˜ëŠ” ê²ƒì€ ë‹¹ì—°íˆ ë¶ˆí¸í•œ ì¼ì¼ ê²ƒì´ë‹¤. ê²°êµ­ ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ í•„ìš”í–ˆë‹¤. Jekyllì˜ ë¡œì»¬í™˜ê²½ì„ ë§Œë“¤ë•Œ ë§ˆì§€ë§‰ ë Œë”ë§ì„ Githubì— ë§¡ê¸´ë‹¤ë©´ Github dependency versionsì— ë§ì¶° ë¡œì»¬í™˜ê²½ì„ ë§ì¶°ì•¼í•œë‹¤. ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ Portableí•˜ê²Œ ë§Œë“œëŠ” ê²Œ ì¢‹ì„ ê²ƒ ê°™ì•„ Dockerë¥¼ ì´ìš©í•´ë³´ì•˜ë‹¤. ë§¥ì—ì„œëŠ” Ruby&#x2F;Gemì´ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ì§€ë§Œ ë‚˜ëŠ” Linux&#x2F;WSL2ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— í•„ìš”í–ˆë‹¤. (Jekyll ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •ì€ ë³¸ë¬¸ ì•„ë˜ì—ì„œ ë‹¤ë£¬ë‹¤.) ê·¸ëŸ¬ë‚˜ Jekyll í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì¶•í•´ ë³´ë‹¤ë³´ë‹ˆ Gemê³¼ Jekyll ì‚¬ì´ì˜ dependency ê´€ë¦¬ê°€ ì¢€ ë³„ë¡œì¸ ë¶€ë¶„ì´ ìˆì—ˆë‹¤. êµ³ì´ ë Œë”ë§ì„ Githubì— ë§¡ê²¨ì•¼í•˜ëŠ”ì§€ì— ëŒ€í•œ ì˜ë¬¸ì´ ë“¤ì—ˆë‹¤. Githubë¥¼ ì´ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ Github dependencyë¥¼ ë§ì¶°ì•¼í•œë‹¤ëŠ” ë‹¨ì ë„ ì—†ê³ , ì‚¬ì´íŠ¸ ìƒì„±ì„ ìœ„í•œ ì½”ë“œë“¤ë„ ê³µê°œí•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì¥ì ì´ ìˆë‹¤. ì´ëŸ° ìƒê°ê¹Œì§€ ë¯¸ì¹˜ë‹ˆ ì–´ì°¨í”¼ ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ë§Œë“¤ê³  Static renderingì„ í•  ê²ƒì´ë©´ Jekyllì´ êµ³ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤ê³  ìƒê°ë˜ì—ˆë‹¤. ê·¸ë˜ì„œ ë‹¤ë¥¸ í›„ë³´ë¥¼ ì°¾ì•„ë³´ë‹ˆ Hexoì™€ Hugoê°€ ìˆì—ˆë‹¤. ì¢€ ë” ìµìˆ™í•œ Node.js ê¸°ë°˜ì˜ Hexoë¥¼ í…ŒìŠ¤íŠ¸ í•´ë³´ê²Œ ë˜ì—ˆë‹¤. HexoJavaScript Runtime ê¸°ë°˜ìœ¼ë¡œ ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ë§Œë“¤ìˆ˜ ìˆë‹¤ ê²ƒì´ ê°€ì¥ í° í¸ì˜ì„±ì´ë‹¤. Docker Container ë³´ë‹¤ ë¹ ë¥´ê²Œ ì‹œì‘í•  ìˆ˜ ìˆë‹¤. Jekyll ë³´ë‹¤ í›„ì— ê°œë°œë˜ì—ˆê¸° ë•Œë¬¸ì— ë¬¸ë²•ë„ ë‹¤ì†Œ í˜„ëŒ€ì‹ì´ê³  ë” í•©ë¦¬ì ì¸ê²ƒ ê°™ë‹¤. ë‹¨ì ì€ ì‚¬ìš©ì ì»¤ë®¤ë‹ˆí‹°ì—ì„œ Non-Englishê°€ Majorë¼ëŠ” ê²ƒì´ë‹¤. themeì—ì„œ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ CSS Preprocessorê°€ SCSSê°€ ì•„ë‹Œ Stylusë¼ëŠ”ê²Œ ë‹¤ì†Œ ì˜ì•„í•˜ê¸´í–ˆë‹¤. ë¬¼ë¡  ë³€ê²½ë„ ê°€ëŠ¥í•˜ë‚˜ Themeì€ ë³´í†µ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ êµ¬ì„±ë˜ë‹ˆ ë³€ê²½í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ì„ íƒì€ ì•„ë‹ ìˆ˜ ìˆë‹¤. ê¸°íƒ€ ì‚¬ì´íŠ¸ ìƒì„±ì‹œ Decorationì„ ìœ„í•´ í•„ìš”í–ˆë˜ ì™¸ë¶€ ì„œë¹„ìŠ¤ëŠ” ì•„ë˜ê°€ ìˆì—ˆë‹¤. Text ê¸°ë°˜ ì´ë¯¸ì§€ ìƒì„± (AI Generator ì•„ë‹˜) ì‹¤í–‰ì— í° ë¬¸ì œê°€ ì—†ì—ˆê³  í•„ìš”í•œ í”ŒëŸ¬ê·¸ì¸ë„ í¬ê²Œ ë¶€ì¡±í•¨ì´ ì—†ì—ˆë‹¤. Github Actionì„ ì´ìš©í•´ Deployí•˜ëŠ” ì„¤ì •ì€ ì•„ë˜ ì„¹ì…˜ì— ì‘ì„±í•˜ì˜€ë‹¤. Jekyll ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½Dockerë¥¼ í†µí•´ interactiveí•˜ê²Œ Jekyllì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì•„ë˜ì™€ ê°™ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í–ˆë‹¤. WSL2 í™˜ê²½ì—ì„œ dockerd ì‹¤í–‰ ì—¬ë¶€ë„ í™•ì¸í•œë‹¤. 123456789101112131415#!/bin/bash# .env# MY_VOLUME=./docsif [[ $(cat /proc/version) == *&quot;WSL2&quot;* ]]; then docker_status=$(sudo service docker status) if [[ $docker_status = *&quot;Docker is not running&quot;* ]]; then sudo service docker start fifidocker compose --env-file .env up -ddocker compose exec jekyll /bin/bashdocker compose down 1234567891011121314151617# docker-compose.ymlversion: &#x27;3.8&#x27;services: jekyll: image: jekyll/jekyll volumes: - $&#123;MY_VOLUME&#125;/:/srv/jekyll - ./vendor/bundle:/usr/local/bundle ports: - &#x27;4000:4000&#x27; - &#x27;35729:35729&#x27; environment: - TZ=Asia/Seoul command: /bin/bash tty: true stdin_open: true Docker í™˜ê²½ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ ì‹¤í–‰í•œë‹¤. 12bundle installbundle exec jekyll serve --host 0.0.0.0 --livereload Github Actionì„ ì´ìš©í•œ Hexo DeployGithub Pageë¡œì˜ DeployëŠ” Github Action ì´ìš©í•˜ì—¬ ìˆ˜í–‰í•˜ë„ë¡ ì„¤ì •í•˜ì˜€ë‹¤. 123456789101112131415161718192021222324252627282930313233343536373839404142name: Deploy blog - JITon: push: branches: - jitjobs: build: runs-on: ubuntu-latest strategy: matrix: node-version: [20.x] steps: - uses: actions/checkout@v3 - name: Use Node.js $&#123;&#123; matrix.node-version &#125;&#125; uses: actions/setup-node@v3 with: node-version: $&#123;&#123; matrix.node-version &#125;&#125; - name: Restore cache uses: actions/cache@v3 id: node-cache with: path: &#x27;**/node_modules&#x27; key: $&#123;&#123; runner.os &#125;&#125;-node-$&#123;&#123; hashFiles(&#x27;**/package-lock.json&#x27;) &#125;&#125; restore-keys: | $&#123;&#123; runner.os &#125;&#125;-node- - name: npm install if: steps.node-cache.outputs.cache-hit != &#x27;true&#x27; run: npm install - name: Setup Environment env: GH_TOKEN: $&#123;&#123; secrets.GH_TOKEN &#125;&#125; GIT_NAME: $&#123;&#123; vars.GIT_NAME &#125;&#125;&#125; GIT_EMAIL: $&#123;&#123; vars.GIT_EMAIL &#125;&#125;&#125; run: | git config --global user.name $&#123;GIT_NAME&#125; git config --global user.email $&#123;GIT_EMAIL&#125; sed -i &quot;s/\\$&#123;GH_TOKEN&#125;/$&#123;GH_TOKEN&#125;/&quot; _config.yml - name: Generate and Deploy Site run: | npx hexo deploy -g ìƒê°ë§¥OSê°€ ì•„ë‹Œ í™˜ê²½ì—ì„œ ë¸”ë¡œê·¸ ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ í•„ìš”í•˜ë©´ Hexoë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ OSì—ì„œ Portableí•˜ê²Œ ë¸”ë¡œê¹…ì„ ì‹œì‘í•  ìˆ˜ ìˆë‹¤. Hexoë¡œ í™˜ê²½ì„ êµ¬ì¶•í•˜ê³ , ë¡œì»¬ì´ë‚˜ CIí™˜ê²½ì„ ì´ìš©í•´ ë¹Œë“œí•˜ê³ , ê·¸ ê²°ê³¼ë¥¼ Deploy í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•´ë´ë„ ì¢‹ì„ ê²ƒì´ë‹¤. Refs: https://futurecreator.github.io/categories/Hexo","categories":[{"name":"talk","slug":"talk","permalink":"https://llnm.github.io/categories/talk/"}],"tags":[]}],"categories":[{"name":"article","slug":"article","permalink":"https://llnm.github.io/categories/article/"},{"name":"talk","slug":"talk","permalink":"https://llnm.github.io/categories/talk/"}],"tags":[{"name":"node.js","slug":"node-js","permalink":"https://llnm.github.io/tags/node-js/"},{"name":"python","slug":"python","permalink":"https://llnm.github.io/tags/python/"},{"name":"ai","slug":"ai","permalink":"https://llnm.github.io/tags/ai/"}]}